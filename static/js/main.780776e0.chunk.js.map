{"version":3,"sources":["tools/groupByProduct.ts","cart/Cart.ts","CurrentUser.ts","CBase.ts","home/VSearchHeader.tsx","home/VSiteHeader.tsx","home/VSlider.tsx","home/VHome.tsx","home/CHome.tsx","cart/VCartLabel.tsx","tools/minusPlusWidget.tsx","cart/VCart.tsx","cart/CCart.tsx","tools/productImage.tsx","product/VProductView.tsx","product/VProduct.tsx","product/VProductList.tsx","mainSubs/loader.ts","tools/productChemical.ts","product/itemLoader.ts","product/VProductDelivery.tsx","product/VChemicalInfo.tsx","product/CProduct.tsx","cartenv.ts","order/VCreateOrder.tsx","order/Order.ts","order/OrderSuccess.tsx","customer/VContactList.tsx","tools/inputValidations.ts","customer/VContact.tsx","customer/VAddress.tsx","customer/CAddress.tsx","customer/CSelectContact.tsx","order/VMyOrders.tsx","order/VOrderDetail.tsx","customer/VInvoiceInfo.tsx","customer/CInvoiceInfo.tsx","coupon/Coupon.ts","order/COrder.tsx","productCategory/VRootCategory.tsx","productCategory/VCategory.tsx","productCategory/CProductCategory.tsx","member/VMember.tsx","member/CMember.tsx","me/about.tsx","me/contactUs.tsx","me/EditMeInfo.tsx","me/loginTop.tsx","tvs/common.tsx","tvs/product.tsx","tvs/customer.tsx","configuration.ts","tvs/index.tsx","tvs/warehouse.tsx","tvs/order.tsx","me/aboutThisApp.tsx","me/VMe.tsx","me/EditMeInfoFirstOrder.tsx","pointMarket/VPointProduct.tsx","pointMarket/VExchangeOrder.tsx","pointMarket/VPointRule.tsx","pointMarket/VMyPoint.tsx","pointMarket/OrderSuccess.tsx","pointMarket/pointOrder.ts","pointMarket/VExchangeHistoryDetail.tsx","pointMarket/VExchangeHistory.tsx","pointMarket/VReceivePointSuccess.tsx","pointMarket/VPlatformOrderPoint.tsx","pointMarket/CPointProduct.tsx","me/VLoginState.tsx","me/CMe.tsx","tools/browser.ts","ui/main.tsx","coupon/VVIPCard.tsx","coupon/VSharedCoupon.tsx","coupon/VCouponAvailable.tsx","coupon/VVIPCardDiscount.tsx","coupon/CCoupon.tsx","CApp.ts","App.tsx","serviceWorker.ts","index.tsx","images/logo.png","images/AnalyticalChemistry.png","images/LabSupplies.png","images/LifeScience.png","images/MaterialScience.png","images/OrganicChemistry.png","mainSubs/mainSubs.tsx","mainSubs/render.tsx","mainSubs/index.ts","images/pig.png"],"names":["groupByProduct","packItems","result","sort","a","b","price","packItem","product","pack","quantity","retail","currency","packRow","id","cpi","find","e","undefined","packs","push","Cart","cApp","cartStore","disposer","cartItems","count","observable","box","amount","calcSum","cp","$isSelected","$isDeleted","pi","Number","NaN","set","parseFloat","toFixed","add","cartItemExists","Tuid","equ","createdate","Date","now","splice","packExists","added","index","length","unshift","storeCart","this","data","list","autorun","isLogined","uqs","currentSalesRegion","CartRemote","CartLocal","load","cartData","PriceX","promises","forEach","obj","salesRegion","Promise","all","prices","priceMap","v","discountinued","expireDate","cartDataGrouped","i","productId","packId","cpp","findIndex","filter","rows","pe","cartItemIndex","cartItem","removeFromCart","CartStore","order","GetCart","page","ret","$page","SetCart","submit","param","map","RemoveFromCart","productTuid","packTuid","ProductX","div","cartstring","localStorage","getItem","JSON","parse","cartDataBoxed","productbox","boxId","packbox","removeItem","TuidDiv","setItem","stringify","WebUser","name","nick","icon","guest","token","gender","salutation","departmentName","telephone","email","fax","address","addressString","zipCode","_user","webUserSettings","setUser","user","loadWebUser","currentCustomer","buyerAccount","organizationName","invoiceInfo","shippingContact","invoiceContact","firstName","mobile","webUserTuid","webuser","WebUserContact","WebUserSetting","WebUserCustomer","WebUserBuyerAccount","webUser","contact","value","Customer","customer","init","query","accountValue","buyerAccounts","WebUserContacts","table","contactId","arr1","Contact","save","newContact","newContactId","addContact","newContactBox","setDefaultShippingContact","del","saveDefaultSettings","invoiceTypeId","invoiceInfoId","invoiceType","webUserContact","getPoints","computed","customerSettings","Contractor","CustomerContacts","CustomerSetting","customerContactorMap","contractor","setDefaultSettings","积分商城","CUqBase","_cApp","_uqs","CBase","CUqApp","CSub","type","c","CAppBase","VSearchHeader","onSearch","key","controller","cProduct","topKey","nav","popTo","start","size","className","placeholder","View","VSiteHeader","left","src","logo","alt","style","height","width","right","renderSearchHeader","VSlider","banners","random","Math","floor","path","VHome","header","pageContent","renderCategoryRootList","siteHeader","renderVm","openPage","VPage","CHome","PageItems","homeSections","sectionTuid","renderView","cProductCategory","renderRootList","getSlideShow","webBuilder","GetSlideShow","tab","openVPage","VCartLabel","showCart","content","observer","badge","onClick","pointer","cart","get","classNames","keys","MinusPlusWidget","minusClick","getValue","setValue","plusClick","ref","input","p","parentElement","tagName","disabled","renderContent","renderTemplet","cn","hasError","itemSchema","required","cursorPointer","minusColor","plusColor","hasFocus","hasAction","readOnly","hasValue","isNaN","minus","invisible","defaultValue","onChange","onKeyDown","onFocus","evt","onBlur","maxLength","plus","renderErrors","UpdownWidget","cartSchema","arr","VCart","CheckOutButton","checkOut","renderCartItem","item","onProductClick","renderCartProduct","packsRow","tv","renderDeliveryTime","uiSchema","selectable","deletable","restorable","items","widget","Templet","ArrContainer","label","RowContainer","RowSeperator","WidgetClass","onChanged","onQuantityChanged","cartForm","schema","formData","params","footer","empty","React","CCart","selectedCartItems","tabPage","context","prev","parentData","onRowStateChanged","selected","deleted","alert","loginCallback","currentUser","loginCallBack","closePage","doFirstOrderChecking","isDeleted","showProductDetail","getSelectedItems","showLogin","cMe","allowOrdering","openMeInfoFirstOrder","onlyRequired","caption","note","actionButton","action","doCheckOut","cOrder","createOrderFromCart","altimagePath","ProductImage","props","chemicalId","substr","altImage","PointProductImage","pointProductImagePath","VCartProuductView","brand","description","descriptionC","origin","imageUrl","productPropItem","renderChemicalInfoInCart","renderBrand","VProuductView","renderProduct","productBox","getProudct","getProductAndDiscount","discount","VProductPrice","vipPrice","promotionPrice","minPrice","visible","initPrices","salesRegionId","getProductPrice","priceUI","SalesRegionId","renderPrice","retailUI","min","Infinity","VProductWithPrice","renderProductPrice","captionClass","capClass","valClass","CAS","purity","molecularFomula","molecularWeight","VProduct","arrTemplet","renderPack","cHome","cartLabel","cCart","renderCartLabel","viewProduct","ViewMainSubs","model","render","productData","VProductList","searchKey","onScrollBottom","scroller","scrollToBottom","productsPager","more","none","before","Loader","entities","schemaLoaded","loadSchemas","initData","loadToData","LoaderProductChemical","ProductChemical","productChemical","chemical","LoaderBrand","brandId","Brand","LoaderProductWithChemical","_","merge","brandLoader","productChemicalLoader","packx","LoaderProductChemicalWithPrices","main","subs","customerDiscount","promotion","productLoader","currentLanguage","hasCustomer","GetDiscount","discountSetting","currentSalesRegionId","element","round","getQuantity","GetPromotionPack","language","results","VProductDelivery","initInventoryAllocation","inventoryAllocation","getInventoryAllocation","initFutureDeliveryTimeDescription","futureDeliveryTimeDescription","getFutureDeliveryTimeDescription","warehouse","deliveryTimeDescription","values","packObj","owner","VChemicalInfoInCart","chemicalInfo","chemicalInfoContainer","getChemicalInfo","CProduct","loader","renderProductWithPrice","priceSet","GetInventoryAllocation","cacheId","futureDeliveryTimeDescriptionContainer","GetFutureDeliveryTime","futureDeliveryTime","minValue","maxValue","unit","searchByKey","QueryPager","SearchProduct","first","keyWord","category","SearchProductByCategory","productCategoryId","productCategory","GLOABLE_PRODUCTION","CHINA","CHINESE","SALESREGION_CN","ROOTCATEGORY","47","OrganicChemistry","labelColor","470","AnalyticalChemistry","1013","LifeScience","1219","MaterialScience","1545","LabSupplies","TIPDISPLAYTIME","ANDROIDAPPADDRESS","PIRVACYURL","CONTENTSITE","GLOABLE_TEST","7","430","986","1214","GLOABLE","env","testing","VCreateOrder","nullContact","priceInit","renderOrderItem","orderItem","renderOrderItemProduct","orderItemKey","renderCoupon","couponAppliedData","hasAnyCoupon","tip","offsetUI","remittedUI","noOffsetUI","code","types","couponOffsetAmount","couponRemitted","point","onBuyerAccountChanged","renderBuyerAccount","organization","o","renderBuyerAccounts","onSelect","onSubmit","orderData","shippingAddressIsBlank","setTimeout","useShippingAddress","invoiceAddressIsBlank","invoiceIsBlank","submitOrder","onSelectShippingContact","onSelectInvoiceContact","onInvoiceInfoEdit","onCouponEdit","backgroundColor","fontSize","chevronRight","shippingAddressBlankTip","invoiceAddressBlankTip","divInvoiceContact","invoiceContactUI","defaultChecked","currentTarget","checked","invoiceBlankTip","invoiceInfoUI","title","freightFeeUI","freightFeeRemittedUI","freightFee","freightFeeRemitted","couponUI","orderItems","productAmount","Order","comments","oi","pk","subAmount","coupon","orderitems","reduce","pv","cv","subListAmount","OrderItem","OrderSuccess","orderCreateResult","back","no","VContactList","onContactRender","onEditContact","onContactSelected","onNewContact","userContacts","contactList","telephoneValidation","test","mobileValidation","emailValidation","faxValidation","addressDetailValidation","zipCodeValidation","organizationNameValidation","nameValidation","VContact","userContactData","form","rules","pickId","pickAddress","addressValue","country","province","city","county","chineseName","isDefault","onSaveContact","buttonClick","onFormButtonClick","saveContact","onDelContact","vCall","VConfirmDeleteContact","delContact","buttonDel","contactData","clone","defaultOrganizationName","defaultName","defaultMobile","fromOrderCreation","onButtonClick","fieldLabelSize","onConfirm","returnCall","onCancel","top","VAddress","provinceId","cityId","countyId","backLevel","provinces","renderPCC","onProvinceClick","pcc","border","marginRight","marginBottom","getProvinceCities","cities","len","onCityClick","openPageElement","saveAddress","getCityCounties","counties","onCountyClick","getCountryProvince","CAddress","countryId","common","GetCountryProvinces","GetProvinceCities","GetCityCounties","Address","newAddress","addressId","CSelectContact","userContact","userContactId","getSetting","userSetting","getIsDefault","setDefaultContact","contactTuid","contactBox","backPage","cAddress","newC","call","getContacts","userContactMaps","CSelectShippingContact","CSelectInvoiceContact","setDefaultInvoiceContact","color","VMyOrders","currentState","tabs","renderOrder","openOrderDetail","date","discription","flow","getMyOrders","state","TabCaptionComponent","isSelected","tabPosition","VOrderDetail","brief","invoiceTemplate","invoiceTypeUI","taxNo","bank","accountNo","regArr","j","commonRequired","valueAddedRequired","commonVisible","valueAddedVisible","VInvoiceInfo","saveTip","invoiceInfoData","invoice","saveInvoiceInfo","showTip","onSaveInvoice","onInvoiceTypeClick","event","parseInt","frm","buildForm","tipUI","role","htmlFor","origInvoice","assure","requiredFields","visibleFields","CInvoiceInfo","InvoiceInfo","newInvoiceInfo","newInvoiceInfoId","invoiceBox","InvoiceType","setDefaultInvoice","CouponBase","expiredDate","isValid","codeShow","String","getTime","createOrderPriceStrategy","couponData","preferential","validitydate","Coupon","CouponSale","VIPCard","Credits","isAvaliable","salesTask","uqsProduct","BottomDiscount","brandDiscountMap","lastDiscount","discountPrice","thisDiscountSetting","COrder","removeCoupon","hasCoupons","buyerAccountQResult","getDefaultShippingContact","getDefaultInvoiceContact","getDefaultInvoiceType","getDefaultInvoiceInfo","FREIGHTFEEFIXED","defaultSetting","contact0","getDataForSave","orderId","couponId","nowDate","usedDate","getFullYear","getMonth","getDay","WebUserCoupon","couponType","WebUserCouponUsed","WebUserCredits","credits","WebUserCreditsUsed","cSelect","cCoupon","applyCoupon","currentUserId","getValidCreditsForWebUser","getValidCouponsForWebUser","validCoupons","validationResult","applyTo","openMyOrders","GetPendingPayment","mySheets","presult","concat","valueOf","cInvoiceInfo","newInvoice","getSheet","orderItemsGrouped","contactArr","getDefaultSetting","getContact","VRootCategory","categoryClick","categoryWapper","parent","openMainPage","renderRootCategory","children","productCategoryID","renderSubCategory","subsub","total","renderThirdCategory","rootCategories","root","console","log","VCategory","instruction","childWapper","instructionUi","instr","$","addClass","dangerouslySetInnerHTML","__html","innerHTML","CProductCategory","getCategoryInstruction","categoryId","window","fetch","res","ok","text","ProductCategory","stopCache","GetRootCategory","secend","third","buildCategories","parentCategoryId","GetChildrenCategory","firstCategory","secendCategory","catId","f","pcid","categoryWaper","getCategoryChildren","rootCategory","searchByCategory","stylePig","backgroundImage","pig","backgroundSize","opacity","position","VMember","recommendationCodeRef","member","recommendationCode","im","inviteCode","divPoints","pointThisWeek","pointAll","fansTitle","fansDetail","current","setReferrer","CMember","referrer","pop","internalStart","MemberAction","MemberRecommender","fans","About","marked","sections","post","phones","number","Row","ContactUs","href","phone","phoneIndex","eIndex","EditMeInfo","onItemChanged","newValue","preValue","userApi","userSetProp","saveLocalUser","onWebUserChanged","webUserData","changeWebUser","onWebUserContactChanged","webUserContactData","changeWebUserContact","webUserSchema","webUserUiSchema","webUserContactSchema","webUserContactUiSchema","tvAddress","tvCountry","tvCurrency","tvProduct","tvContact","appConfig","appName","version","tvs","productx","radiox","radioy","loginTop","oem","privacy","AboutThisApp","VMe","about","contactUs","openPrivacy","aboutThisApp","changePassword","openContactList","openInvoice","openMyPoint","meInfo","userSpan","orderStates","os","aboutRows","component","iconClass","logOutRows","bk","exit","showLogout","EditMeInfoFirstOrder","options","webUserContacts","addContactFromAccount","tips","onCompleted","tipsUI","schemaArr","VPointProduct","renderPointProduct","pointProduct","openExchangeOrder","pointToExchanging","myEffectivePoints","productIsNull","pointIsEnough","pointProducts","productIsNullTip","pointIsEnoughTip","VExchangeOrder","pointProductsSelected","pointsSum","VPointRule","VMyPoint","openPointProduct","openExchangeHistory","openPointDrawing","pointRules","myPointTobeExpired","myTotalPoints","dateYear","nowPoint","nowPointTip","actions","pointOrder","exchangeItems","exchangeitems","VExchangeHistoryDetail","renderexchangeItem","VExchangeHistory","exchangeHistory","renderExchangeHistory","VReceivePointSuccess","VPlatformOrderPoint","couponInput","currentCredits","openPlatformOrderPoint","tryApplyCoupon","userInfoCompletedChecking","IsCouponCanUse","getLastPlatformOrder","receivePoint","addUsedCoupon","refreshMypoint","replace","retCoupon","platformOrder","renderPlatformOrder","PlatformOrder","CPointProduct","myPoints","effectiveLeftPoint","totalLeftPoint","pointYear","getPointsProducts","PointExchangeSheet","GetPointProduct","IsContain","nowQuantity","GetLastPlatFormOrder","platformOrderId","getPlatFormOrder","GetPlatFormOrder","couponCode","IsCanUseCoupon","AddPlatformOrderPoint","rtn","openMeInfoOptions","AddUsedCoupon","VLoginState","renderCarLabel","CMe","pick","cPointProduct","showPrivacyPage","getCommonText","textId","CommonText","browser","u","navigator","userAgent","appVersion","trident","indexOf","presto","webKit","gecko","match","ios","android","uc","iPhone","iPad","webApp","html5Plus","VMain","downloadApp","open","faceTabs","notify","headerClassName","tabsProps","VCoupon","renderRight","renderCardDescription","cardDescription","discountShow","vipCardType","getCodeShow","p1","p2","couponUi","COUPONBASE","invalidTip","getTips","VVIPCard","showDiscountSetting","vipCardId","stopPropagation","VCredits","VSharedCoupon","products","drawCouponUI","sharedCouponValidationResult","couponDrawed","loginWhenDrawCoupon","renderCouponBase","VCoupleAvailable","vipCardForWebUser","coupons","applySelectedCoupon","vipCardUI","couponsForWebUser","creditsForWebUser","VVIPCardDiscount","vipCard","renderVIPCardDiscountSetting","CCoupon","couponPager","getCouponValidationResult","getCouponDiscountSetting","getValidVipCardForWebUser","WebUserVIPCard","validCouponsForWebUser","validCreditsForWebUser","VIPCardDiscount","showSharedVIPCard","vipCardCode","vipcard","productids","autoDrawCouponBase","getProducts","showSharedCoupon","showSharedCredits","couponBaseCode","drawCoupon","split","creditsId","creditsCode","createDate","getDate","validVIPCardForWebUser","CApp","cMember","SalesRegion","Language","document","location","search","qs","toLowerCase","showMain","prouductBoxId","initTabName","getElementById","renderLoginState","elements","aId","innerText","hello","bId","cId","n","hookElements","onfocus","dispose","setSettings","App","onLogined","notLogined","Boolean","hostname","elRoot","createElement","display","body","append","ReactDOM","serviceWorker","ready","then","registration","unregister","module","exports","ViewBase","sub","renderSubs","subsContainer","renderSubItems","subViews"],"mappings":"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","file":"static/js/main.780776e0.chunk.js","sourcesContent":["import { CartPackRow } from \"cart/Cart\";\r\n\r\nexport function groupByProduct(packItems: any[]) {\r\n    let result: any[] = [];\r\n    for (let packItem of packItems.sort((a, b) => a.price - b.price)) {\r\n        let { product, pack, quantity, price, retail, currency } = packItem;\r\n        let packRow: CartPackRow = {\r\n            pack: pack,\r\n            price: price,\r\n            retail: retail,\r\n            quantity: quantity,\r\n            currency: currency && currency.id\r\n        }\r\n        let cpi = result.find(e => e.product.id === product.id);\r\n        if (cpi === undefined) {\r\n            cpi = { product: product, packs: [] };\r\n            result.push(cpi);\r\n        }\r\n        cpi.packs.push(packRow);\r\n    }\r\n    return result;\r\n}","import { observable, autorun, IReactionDisposer } from 'mobx';\r\nimport { Action, Query, TuidDiv, BoxId, Tuid } from 'tonva';\r\n//import { CCartApp } from '../CCartApp';\r\nimport { PackRow } from 'product/Product';\r\nimport { groupByProduct } from 'tools/groupByProduct';\r\nimport { CApp } from '../CApp';\r\n\r\nexport interface CartItem2 {\r\n    product: BoxId;\r\n    packs: CartPackRow[];\r\n    $isSelected?: boolean;\r\n    $isDeleted?: boolean;\r\n    createdate: number;\r\n}\r\n\r\nexport interface CartPackRow extends PackRow {\r\n    /**\r\n     * 销售成交价（在购物车中是目录价或市场活动价或协议价的最小值），订单中还会经过券的计算\r\n     */\r\n    price: number;\r\n\r\n    /**\r\n     * 订单中的初始销售成交价（订单中应用折扣券之前的价格）\r\n     */\r\n    priceInit?: number;\r\n    /**\r\n     * 订单中目录价\r\n     */\r\n    retail: number;\r\n    currency: any;\r\n}\r\n\r\nexport class Cart {\r\n    cApp: CApp;\r\n\r\n    private cartStore: CartStore;\r\n    private disposer: IReactionDisposer;\r\n\r\n    @observable data: any = {\r\n        list: observable<CartItem2>([]),\r\n    };\r\n    cartItems: CartItem2[];\r\n    count = observable.box<number>(0);\r\n    amount = observable.box<number>(0);\r\n\r\n    constructor(cApp: CApp) {\r\n        this.cApp = cApp;\r\n        this.cartItems = this.data.list;\r\n        this.disposer = autorun(this.calcSum);\r\n    }\r\n\r\n    dispose() {\r\n        this.disposer();\r\n    }\r\n\r\n    protected calcSum = () => {\r\n        let count = 0, amount = 0;\r\n        for (let cp of this.cartItems) {\r\n            let { $isSelected, $isDeleted, packs } = cp;\r\n            if ($isDeleted === true || !($isSelected === true)) continue;\r\n            for (let pi of packs) {\r\n                let { price, quantity } = pi;\r\n                count += quantity;\r\n                if (price === Number.NaN || quantity === Number.NaN) continue;\r\n                amount += quantity * price;\r\n            }\r\n        }\r\n        this.count.set(count);\r\n        this.amount.set(parseFloat(amount.toFixed(2)));\r\n    }\r\n\r\n    async init(): Promise<void> {\r\n        let { isLogined, uqs, currentSalesRegion } = this.cApp;\r\n        if (isLogined)\r\n            this.cartStore = new CartRemote(this.cApp);\r\n        else\r\n            this.cartStore = new CartLocal(this.cApp);\r\n        let cartData = await this.cartStore.load();\r\n\r\n        // 初始化购物车中产品的目录价\r\n        let { product } = uqs;\r\n        let { PriceX } = product;\r\n        let promises: PromiseLike<void>[] = [];\r\n        cartData.forEach((e: any) => promises.push(PriceX.obj({ product: e.product, pack: e.pack, salesRegion: currentSalesRegion })));\r\n        let prices = await Promise.all(promises);\r\n        for (let index = cartData.length - 1; index >= 0; index--) {\r\n            let e: any = cartData[index];\r\n            let priceMap: any = prices.find((v: any) => Tuid.equ(v.product, e.product)\r\n                && Tuid.equ(v.pack, e.pack) && v.discountinued === 0 && v.expireDate > Date.now());\r\n            if (priceMap && priceMap.retail) {\r\n                e.retail = priceMap.retail;\r\n            } else {\r\n                cartData.splice(index, 1);\r\n            }\r\n        }\r\n\r\n        let cartDataGrouped = groupByProduct(cartData);\r\n        if (cartDataGrouped && cartDataGrouped.length > 0) {\r\n            for (let i = 0; i < cartDataGrouped.length; i++) {\r\n                let { product, packs, createdate } = cartDataGrouped[i];\r\n                this.cartItems.push({\r\n                    product: product,\r\n                    packs: packs,\r\n                    $isSelected: true,\r\n                    $isDeleted: false,\r\n                    createdate: createdate,\r\n                })\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n    private mergeToRemote(localItems: any[]) {\r\n        let originLength = localItems.length;\r\n        let nowLength = this.items.length;\r\n        if (originLength > 0) {\r\n            if (nowLength > 0) {\r\n                // 合并，谁覆盖谁？\r\n                for (let i = 0; i < originLength; i++) {\r\n                    let { product: tempProduct, pack: tempPack } = localItems[i];\r\n                    let cartItemExits = this.items.find(v => v.product === tempProduct && v.pack === tempPack);\r\n                    if (cartItemExits) {\r\n                        // 如果本地购物车中的产品已经过期，则要删除\r\n                    } else {\r\n                        this.items.push(localItems[i]);\r\n                    }\r\n                }\r\n            } else {\r\n                this.items.push(...localItems);\r\n            }\r\n            // 保存到远程\r\n        }\r\n    }\r\n    */\r\n\r\n    getQuantity(productId: number, packId: number): number {\r\n        let cp = this.cartItems.find(v => v.$isDeleted !== true && Tuid.equ(v.product, productId));\r\n        if (!cp) return 0;\r\n        let cpp = cp.packs.find(v => v.pack.id === packId);\r\n        return cpp === undefined ? 0 : cpp.quantity;\r\n    }\r\n\r\n    isDeleted(productId: number): boolean {\r\n        let i = this.cartItems.findIndex(v => v.$isDeleted === true && Tuid.equ(v.product, productId));\r\n        return i !== -1;\r\n    }\r\n\r\n    getSelectedItems(): CartItem2[] {\r\n        return this.cartItems.filter(v => {\r\n            let { $isSelected, $isDeleted } = v;\r\n            return $isSelected === true && $isDeleted !== true;\r\n        });\r\n    }\r\n\r\n    /**\r\n     *\r\n     */\r\n    add = async (product: BoxId, pack: BoxId, quantity: number, price: number, retail: number, currency: any) => {\r\n        let cartItemExists = this.cartItems.find((e) => Tuid.equ(e.product, product));\r\n        if (!cartItemExists) {\r\n            cartItemExists = {\r\n                product: product,\r\n                packs: [{ pack: pack, quantity: quantity, price: price, retail: retail, currency: currency }],\r\n                $isSelected: true,\r\n                $isDeleted: false,\r\n                createdate: Date.now()\r\n            };\r\n            this.cartItems.push(cartItemExists);\r\n        }\r\n        else {\r\n            let { $isDeleted, packs } = cartItemExists;\r\n            if ($isDeleted === true)\r\n                packs.splice(0);\r\n\r\n            let packExists: CartPackRow = packs.find(e => Tuid.equ(e.pack, pack));\r\n            if (packExists === undefined) {\r\n                let added = false;\r\n                for (let index = packs.length - 1; index >= 0; index--) {\r\n                    if (packs[index].price < price) {\r\n                        packs.splice(index + 1, 0, { pack: pack, quantity: quantity, price: price, retail: retail, currency: currency });\r\n                        added = true;\r\n                        break;\r\n                    }\r\n                }\r\n                if (!added)\r\n                    packs.unshift({ pack: pack, quantity: quantity, price: price, retail: retail, currency: currency })\r\n                // packs.push();\r\n            }\r\n            else {\r\n                packExists.quantity = quantity;\r\n                packExists.price = price;\r\n                packExists.currency = currency;\r\n            }\r\n            cartItemExists.$isSelected = true;\r\n            cartItemExists.$isDeleted = false;\r\n            cartItemExists.createdate = Date.now();\r\n        }\r\n\r\n        await this.cartStore.storeCart(product, pack, quantity, price, currency);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param rows\r\n     */\r\n    async removeFromCart(rows: [{ productId: number, packId: number }]) {\r\n        if (rows && rows.length > 0) {\r\n            rows.forEach(pe => {\r\n                let cartItemIndex = this.cartItems.findIndex(e => e.product.id === pe.productId);\r\n                if (cartItemIndex >= 0) {\r\n                    let cartItem = this.cartItems[cartItemIndex];\r\n                    let i = cartItem.packs.findIndex(e => e.pack.id === pe.packId)\r\n                    if (i >= 0) {\r\n                        cartItem.packs.splice(i, 1);\r\n                        if (cartItem.packs.length === 0) {\r\n                            this.cartItems.splice(cartItemIndex, 1);\r\n                        }\r\n                    }\r\n                }\r\n            })\r\n            this.cartStore.removeFromCart(rows);\r\n        }\r\n    }\r\n\r\n    /*\r\n    setDeletedMark(productId: number, packId: number) {\r\n        let cp = this.items.find(v => v.$isDeleted !== true && v.product === productId && v.pack === packId);\r\n        if (cp !== undefined)\r\n            cp.$isDeleted = true;\r\n    }\r\n\r\n    async removeDeletedItem() {\r\n        let rows: { product: number, packItem: CartPackRow }[] = [];\r\n        for (let cp of this.items) {\r\n            let { quantity, $isDeleted } = cp;\r\n            if ($isDeleted === true || quantity === 0) {\r\n                // TODO:\r\n            }\r\n        }\r\n        if (rows.length === 0) return;\r\n        await this.cartStore.removeFromCart(rows);\r\n\r\n        // 下面是从本地数据结构中删除\r\n        for (let cp of this.items) {\r\n            let { packs } = cp;\r\n            let packIndexes: number[] = [];\r\n            let len = packs.length;\r\n            for (let i = 0; i < len; i++) {\r\n                if (packs[i].quantity === 0) packIndexes.push(i);\r\n            }\r\n            for (let i = packIndexes.length - 1; i >= 0; i--) packs.splice(packIndexes[i], 1);\r\n        }\r\n\r\n        let itemIndexes: number[] = [];\r\n        let len = this.items.length;\r\n        for (let i = 0; i < len; i++) {\r\n            let { $isDeleted, packs } = this.items[i];\r\n            if ($isDeleted === true || packs.length === 0) itemIndexes.push(i);\r\n        }\r\n        for (let i = itemIndexes.length - 1; i >= 0; i--) this.items.splice(itemIndexes[i], 1);\r\n    }\r\n\r\n    async clear() {\r\n        this.items.forEach(v => v.$isDeleted = true);\r\n        await this.removeDeletedItem();\r\n    }\r\n    */\r\n\r\n}\r\n\r\nabstract class CartStore {\r\n\r\n    protected cApp: CApp;\r\n    constructor(cApp: CApp) {\r\n        this.cApp = cApp;\r\n    }\r\n    abstract get isLocal(): boolean;\r\n    abstract async load(): Promise<CartItem2[]>;\r\n    abstract async storeCart(product: BoxId, pack: BoxId, quantity: number, price: number, currency: any): Promise<void>;\r\n    abstract async removeFromCart(rows: [{ productId: number, packId: number }]): Promise<void>;\r\n}\r\n\r\nclass CartRemote extends CartStore {\r\n    //private getCartQuery: Query;\r\n    //private setCartAction: Action;\r\n    //private removeFromCartAction: Action;\r\n\r\n    get isLocal(): boolean { return false }\r\n\r\n    /*\r\n    constructor(cApp: CApp) {\r\n        super(cApp);\r\n\r\n        let { cUqOrder } = this.cApp;\r\n        this.getCartQuery = cUqOrder.query('getcart')\r\n        this.setCartAction = cUqOrder.action('setcart');\r\n        this.removeFromCartAction = cUqOrder.action('removefromcart');\r\n    }\r\n    */\r\n\r\n    async load(): Promise<CartItem2[]> {\r\n        let ret = await this.cApp.uqs.order.GetCart.page(undefined, 0, 100);\r\n        return ret && ret.$page as any;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param product\r\n     * @param pack\r\n     * @param quantity\r\n     * @param price\r\n     * @param currency\r\n     */\r\n    async storeCart(product: BoxId, pack: BoxId, quantity: number, price: number, currency: any) {\r\n        await this.cApp.uqs.order.SetCart.submit({\r\n            product: product.id,\r\n            pack: pack.id,\r\n            price: price,\r\n            currency: currency,\r\n            quantity: quantity\r\n        });\r\n    }\r\n\r\n    async removeFromCart(rows: [{ productId: number, packId: number }]) {\r\n        let param = rows.map(e => { return { product: e.productId, pack: e.packId } });\r\n        await this.cApp.uqs.order.RemoveFromCart.submit({ rows: param });\r\n    }\r\n}\r\n\r\nconst LOCALCARTNAME: string = \"cart\";\r\nclass CartLocal extends CartStore {\r\n\r\n    private cartData: any[] = [];\r\n    private productTuid: Tuid;\r\n    private packTuid: TuidDiv;\r\n    constructor(cApp: CApp) {\r\n        super(cApp);\r\n\r\n        this.productTuid = this.cApp.uqs.product.ProductX;\r\n        this.packTuid = this.productTuid.div('packx');\r\n    }\r\n\r\n    get isLocal(): boolean { return true }\r\n\r\n    async load(): Promise<CartItem2[]> {\r\n        try {\r\n            let cartstring = localStorage.getItem(LOCALCARTNAME);\r\n            if (cartstring === null) return [];\r\n            this.cartData = JSON.parse(cartstring);\r\n            let cartDataBoxed = [];\r\n            for (let i = 0; i < this.cartData.length; i++) {\r\n                let { product, pack, quantity, price, currency } = this.cartData[i];\r\n                let productbox = this.productTuid.boxId(product);\r\n                let packbox = this.packTuid.boxId(pack);\r\n                cartDataBoxed.push({\r\n                    product: productbox,\r\n                    pack: packbox,\r\n                    quantity: quantity,\r\n                    price: price,\r\n                    currency: currency\r\n                } as any)\r\n            }\r\n            return cartDataBoxed;\r\n        }\r\n        catch (e) {\r\n            localStorage.removeItem(LOCALCARTNAME);\r\n            this.cartData = [];\r\n            return this.cartData;\r\n        }\r\n    }\r\n\r\n    async storeCart(product: BoxId, pack: BoxId, quantity: number, price: number, currency: any) {\r\n        let cartItemExists = this.cartData.find(e => Tuid.equ(e.product, product) && TuidDiv.equ(e.pack, pack));\r\n        if (cartItemExists !== undefined) {\r\n            cartItemExists.quantity = quantity;\r\n            cartItemExists.price = price;\r\n            cartItemExists.currency = currency && currency.id;\r\n        } else\r\n            this.cartData.push({ product: product.id, pack: pack.id, quantity: quantity, price: price, currency: currency && currency.id });\r\n        localStorage.setItem(LOCALCARTNAME, JSON.stringify(this.cartData));\r\n    }\r\n\r\n    async removeFromCart(rows: [{ productId: number, packId: number }]) {\r\n\r\n        rows.forEach(e => {\r\n            let i = this.cartData.findIndex(v => v.product = e.productId && v.pack === e.packId);\r\n            if (i >= 0)\r\n                this.cartData.splice(i, 1);\r\n        })\r\n        localStorage.setItem(LOCALCARTNAME, JSON.stringify(this.cartData));\r\n    }\r\n}","import { User } from 'tonva';\r\nimport { BoxId } from 'tonva';\r\nimport { observable, computed } from 'mobx';\r\nimport { UQs } from './uqs';\r\n\r\nexport class WebUser {\r\n\r\n    id: number;\r\n    name: string;\r\n    nick?: string;\r\n    icon?: string;\r\n    guest: number;\r\n    token: string;\r\n\r\n    @observable firstName: string;\r\n    gender: string;\r\n    salutation: string;\r\n    @observable organizationName: string;\r\n    departmentName: string;\r\n\r\n    get defaultOrganizationName(): string {\r\n        return this.organizationName ||\r\n            (this.webUserSettings &&\r\n                (\r\n                    (this.webUserSettings.invoiceInfo && this.webUserSettings.invoiceInfo.obj['title'])\r\n                    || (this.webUserSettings.shippingContact && this.webUserSettings.shippingContact.obj['organizationName'])\r\n                    || (this.webUserSettings.invoiceContact && this.webUserSettings.invoiceContact.obj['organizationName'])\r\n                )\r\n            );\r\n    }\r\n\r\n    get defaultName(): string {\r\n        return this.firstName ||\r\n            (this.webUserSettings &&\r\n                ((\r\n                    this.webUserSettings.shippingContact && this.webUserSettings.shippingContact.obj['name'])\r\n                    || (this.webUserSettings.invoiceContact && this.webUserSettings.invoiceContact.obj['name'])\r\n                )\r\n            );\r\n    }\r\n\r\n    get defaultMobile(): string {\r\n        return this.mobile ||\r\n            (this.webUserSettings &&\r\n                ((\r\n                    this.webUserSettings.shippingContact && this.webUserSettings.shippingContact.obj['mobile'])\r\n                    || (this.webUserSettings.invoiceContact && this.webUserSettings.invoiceContact.obj['mobile'])\r\n                )\r\n            );\r\n    }\r\n\r\n    telephone: string;\r\n    @observable mobile: string;\r\n    email: string;\r\n    fax: string;\r\n    address: BoxId;\r\n    addressString: string;\r\n    zipCode: string;\r\n    @computed get allowOrdering() {\r\n        // 这个地方要改成相关账号吧？\r\n        return this.currentCustomer !== undefined ||\r\n            (this.mobile && this.firstName && this.organizationName);\r\n    }\r\n\r\n    private _user: User;\r\n\r\n    private webUserSettings: any;\r\n\r\n    private uqs: UQs;\r\n\r\n\r\n    constructor(uqs: UQs) {// cUsqWebUser: CUq, cUsqCustomer: CUq) {\r\n        this.uqs = uqs;\r\n    }\r\n\r\n    setUser = async (user: User) => {\r\n        if (user !== undefined) {\r\n            this._user = user;\r\n            this.id = user.id;\r\n            this.name = user.name;\r\n            this.nick = user.nick;\r\n            this.icon = user.icon;\r\n            this.guest = user.guest;\r\n            this.token = user.token;\r\n\r\n            await this.loadWebUser();\r\n        }\r\n    }\r\n\r\n    private async loadWebUser() {\r\n        let { id, _user } = this;\r\n        if (this._user !== undefined) {\r\n            let { webuser: webUserTuid } = this.uqs;\r\n            let { WebUser, WebUserContact, WebUserSetting, WebUserCustomer, WebUserBuyerAccount } = webUserTuid;\r\n            let webUser = await WebUser.load(this.id);\r\n            if (webUser) {\r\n                let { firstName, gender, salutation, organizationName, departmentName } = webUser;\r\n                this.firstName = firstName;\r\n                this.gender = gender;\r\n                this.salutation = salutation;\r\n                this.organizationName = organizationName;\r\n                this.departmentName = departmentName;\r\n            }\r\n\r\n            let contact = await WebUserContact.obj({ \"webUser\": id });\r\n            if (contact) {\r\n                let { telephone, mobile, email, fax, address, addressString, zipCode } = contact;\r\n                this.telephone = telephone;\r\n                this.mobile = mobile;\r\n                this.email = email;\r\n                this.fax = fax;\r\n                this.address = address;\r\n                this.addressString = addressString;\r\n                this.zipCode = zipCode;\r\n            }\r\n\r\n            this.webUserSettings = await WebUserSetting.obj({ webUser: id }) || { webUser: id };\r\n\r\n            let value = await WebUserCustomer.obj({ webUser: id });\r\n            if (value !== undefined) {\r\n                this.currentCustomer = new Customer(value.customer, this.uqs);\r\n                await this.currentCustomer.init();\r\n            }\r\n            let accountValue = await WebUserBuyerAccount.query({ webUser: id });\r\n            let { ret: buyerAccounts } = accountValue;\r\n            if (buyerAccounts && buyerAccounts.length > 0) {\r\n                // TODO: 暂时不考虑有多个相关账号的情况\r\n                this.buyerAccount = buyerAccounts[0].buyerAccount;\r\n            }\r\n        }\r\n    }\r\n\r\n    get isLogined(): boolean {\r\n        return this._user !== undefined;\r\n    }\r\n    get hasCustomer(): boolean {\r\n        return this.currentCustomer !== undefined;\r\n    }\r\n    currentCustomer: Customer;\r\n    buyerAccount: any;\r\n\r\n    async getContacts(): Promise<any[]> {\r\n        /*\r\n        if (this.currentCustomer !== undefined) {\r\n            return await this.currentCustomer.getContacts()\r\n        }\r\n        */\r\n        return await this.uqs.webuser.WebUserContacts.table({ webUser: this.id });\r\n    }\r\n\r\n    async addContact(contactId: number) {\r\n        /*\r\n        if (this.currentCustomer !== undefined) {\r\n            await this.currentCustomer.addContact(contactId);\r\n            return;\r\n        }\r\n        */\r\n        await this.uqs.webuser.WebUserContacts.add({ webUser: this.id, arr1: [{ contact: contactId }] });\r\n    }\r\n\r\n    async addContactFromAccount() {\r\n        let { firstName, organizationName, mobile, telephone, email, address, addressString } = this;\r\n        if (firstName && organizationName && mobile && address && addressString) {\r\n            let newContact = await this.uqs.customer.Contact.save(undefined, {\r\n                name: firstName,\r\n                organizationName: organizationName,\r\n                mobile: mobile,\r\n                telephone: telephone,\r\n                email: email,\r\n                address: address,\r\n                addressString: addressString\r\n            })\r\n            if (newContact) {\r\n                let { id: newContactId } = newContact;\r\n                await this.addContact(newContactId);\r\n                let newContactBox = this.uqs.customer.Contact.boxId(newContactId);\r\n                this.setDefaultShippingContact(newContactBox);\r\n            }\r\n        }\r\n    }\r\n\r\n    async delContact(contactId: number) {\r\n        /*\r\n        if (this.currentCustomer !== undefined) {\r\n            await this.currentCustomer.delContact(contactId);\r\n            return;\r\n        }\r\n        */\r\n        await this.uqs.webuser.WebUserContacts.del({ webUser: this.id, arr1: [{ contact: contactId }] });\r\n    }\r\n\r\n    async getSetting() {\r\n        /*\r\n        if (this.currentCustomer !== undefined) {\r\n            return this.currentCustomer.getSetting();\r\n        }\r\n        */\r\n        return this.webUserSettings;\r\n    }\r\n\r\n    async setDefaultShippingContact(contactId: BoxId) {\r\n        /*\r\n        if (this.currentCustomer !== undefined) {\r\n            await this.currentCustomer.setDefaultShippingContact(contactId);\r\n            return;\r\n        }\r\n        */\r\n        this.webUserSettings.shippingContact = contactId;\r\n        this.saveDefaultSettings();\r\n    }\r\n\r\n    async setDefaultInvoiceContact(contactId: BoxId) {\r\n        /*\r\n        if (this.currentCustomer !== undefined) {\r\n            await this.currentCustomer.setDefaultInvoiceContact(contactId);\r\n            return;\r\n        }\r\n        */\r\n        this.webUserSettings.invoiceContact = contactId;\r\n        this.saveDefaultSettings();\r\n    }\r\n\r\n    async setDefaultInvoice(invoiceTypeId: BoxId, invoiceInfoId: BoxId) {\r\n        /*\r\n        if (this.currentCustomer !== undefined) {\r\n            await this.currentCustomer.setDefaultInvoice(invoiceTypeId, invoiceInfoId);\r\n            return;\r\n        }\r\n        */\r\n        // await this.webUserSettingMap.add({ webUser: this.id, arr1: [{ invoiceType: invoiceTypeId, invoiceInfo: invoiceInfoId }] });\r\n        this.webUserSettings.invoiceType = invoiceTypeId;\r\n        this.webUserSettings.invoiceInfo = invoiceInfoId;\r\n        this.saveDefaultSettings();\r\n    }\r\n\r\n    async saveDefaultSettings() {\r\n        await this.uqs.webuser.WebUserSetting.add(this.webUserSettings);\r\n    }\r\n\r\n\r\n    async changeWebUser(webUser: any) {\r\n        await this.uqs.webuser.WebUser.save(this.id, webUser);\r\n        await this.loadWebUser();\r\n    }\r\n\r\n    async changeWebUserContact(webUserContact: any) {\r\n        webUserContact.webUser = this.id;\r\n        await this.uqs.webuser.WebUserContact.add(webUserContact);\r\n        await this.loadWebUser();\r\n    }\r\n\r\n    async getPoints() {\r\n        if (this.currentCustomer !== undefined) {\r\n            return await this.currentCustomer.getPoints();\r\n        }\r\n        return [];\r\n    }\r\n};\r\n\r\nexport class Customer {\r\n    private readonly uqs: UQs;\r\n    id: number;\r\n\r\n    private customerSettings: any;\r\n    Contractor: any;\r\n\r\n    constructor(customer: BoxId, uqs: UQs) {\r\n        this.id = customer.id;\r\n        this.uqs = uqs;\r\n    };\r\n\r\n    async getContacts(): Promise<any[]> {\r\n        return await this.uqs.customer.CustomerContacts.table({ customer: this.id });\r\n    }\r\n\r\n    async addContact(contactId: number) {\r\n        await this.uqs.customer.CustomerContacts.add({ customer: this.id, arr1: [{ contact: contactId }] });\r\n    }\r\n\r\n    async delContact(contactId: number) {\r\n        await this.uqs.customer.CustomerContacts.del({ customer: this.id, arr1: [{ contact: contactId }] });\r\n    }\r\n\r\n    async init() {\r\n        this.customerSettings = await this.uqs.customer.CustomerSetting.obj({ customer: this.id }) || { customer: this.id };\r\n        let customerContactorMap: any = await this.uqs.customer.CustomerContacts.obj({ customer: this.id });\r\n        if (customerContactorMap)\r\n            this.Contractor = customerContactorMap.contractor;\r\n    }\r\n\r\n    getSetting() {\r\n        return this.customerSettings;\r\n    }\r\n\r\n    async setDefaultShippingContact(contactId: BoxId) {\r\n        this.customerSettings.shippingContact = contactId;\r\n        await this.setDefaultSettings();\r\n    }\r\n\r\n    async setDefaultInvoiceContact(contactId: BoxId) {\r\n        this.customerSettings.invoiceContact = contactId;\r\n        await this.setDefaultSettings();\r\n    }\r\n\r\n    async setDefaultInvoice(invoiceTypeId: BoxId, invoiceInfoId: BoxId) {\r\n        this.customerSettings.invoiceType = invoiceTypeId;\r\n        this.customerSettings.invoiceInfo = invoiceInfoId;\r\n        await this.setDefaultSettings();\r\n    }\r\n\r\n    async setDefaultSettings() {\r\n        await this.uqs.customer.CustomerSetting.add(this.customerSettings);\r\n    }\r\n\r\n    async getPoints() {\r\n        return await this.uqs.积分商城.getPoints.table({ customer: this.id });\r\n    }\r\n\r\n}","import { CSub, CBase, CAppBase, IConstructor } from 'tonva';\r\nimport { UQs } from './uqs';\r\nimport { CApp } from './CApp';\r\n\r\nexport abstract class CUqBase extends CBase {\r\n    get cApp(): CApp { return this._cApp; }\r\n    protected get uqs(): UQs { return this._uqs as UQs };\r\n}\r\n\r\nexport abstract class CUqSub extends CSub {\r\n    get cApp(): CApp { return this.cApp; }\r\n    protected get uqs(): UQs { return this._uqs as UQs };\r\n    protected get owner(): CUqBase { return this._owner as CUqBase }\r\n}\r\n\r\nexport abstract class CUqApp extends CAppBase {\r\n    get uqs(): UQs { return this._uqs };\r\n\r\n    protected newC<T extends CUqBase>(type: IConstructor<T>): T {\r\n\t\tlet c = new type(this);\r\n\t\tc.init();\r\n\t\treturn c;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { View, nav } from 'tonva';\r\nimport { CHome } from './CHome';\r\nimport { SearchBox } from 'tonva';\r\n\r\nexport class VSearchHeader extends View<CHome> {\r\n\r\n    private onSearch = async (key: string, param: 'home' | 'insearch' | 'productdetail') => {\r\n        let { cProduct, topKey } = this.controller.cApp;\r\n        if (param !== 'home') {\r\n            nav.popTo(topKey);\r\n        }\r\n\r\n        cProduct.start(key);\r\n    }\r\n\r\n    render(param: 'home' | 'insearch' | 'productdetail') {\r\n        let size: any = param === 'home' ? \"md\" : 'sm';\r\n        return <SearchBox className=\"w-100\"\r\n            size={size}\r\n            onSearch={(key: string) => this.onSearch(key, param)}\r\n            placeholder=\"搜索品名、编号、CAS、MDL等\" />\r\n    }\r\n}","import * as React from 'react';\r\nimport { LMR, FA, View } from 'tonva';\r\nimport logo from '../images/logo.png';\r\nimport { CHome } from './CHome';\r\n\r\nexport class VSiteHeader extends View<CHome> {\r\n    render() {\r\n        let currentSalesRegion = <FA name=\"globe\" />\r\n        let left = <img className=\"m-1 ml-2\" src={logo} alt=\"logo\" style={{ height: \"3rem\", width: \"2.5rem\" }} />;\r\n        //let cart = this.controller.cApp.cCart.renderCartLabel();\r\n        let right = undefined;\r\n        /*\r\n        <div className=\"d-flex flex-row mr-1 align-items-center\">\r\n            {currentSalesRegion} &nbsp;\r\n            <button onClick={()=>nav.start()}>Try</button>\r\n        </div>;*/\r\n        return <LMR\r\n            className=\"mb-1 align-items-center bg-white\"\r\n            left={left} right={right}>\r\n            <div className=\"px-3 py-4\">\r\n                {this.controller.renderSearchHeader('md')}\r\n            </div>\r\n        </LMR>\r\n        //<div className=\"h4 px-3 mb-0\">百灵威科技</div>\r\n    }\r\n}","import React from 'react';\r\nimport { View } from 'tonva';\r\nimport { CHome } from './CHome';\r\nimport Slider from \"react-slick\";\r\nimport \"slick-carousel/slick/slick.css\";\r\nimport \"slick-carousel/slick/slick-theme.css\";\r\n\r\nconst sliderSetting = {\r\n    dots: false,\r\n    infinite: true,\r\n    speed: 500,\r\n    autoplay: true,\r\n    slidesToShow: 1,\r\n    slidesToScroll: 1,\r\n    arrows: false,\r\n    isArrows: true,\r\n    isDots: true\r\n};\r\n\r\nexport class VSlider extends View<CHome> {\r\n\r\n    public render(param: any) {\r\n\r\n        let { banners } = this.controller;\r\n        let random = Math.floor(Math.random() * 10 % banners.length);\r\n        return <img src={banners[random].path} className=\"d-block w-100\" alt=\"...\"></img>\r\n\r\n        /**\r\n        return <Slider {...sliderSetting} className=\"bg-white\" >\r\n            {this.controller.banners.map((banner, index) => <div key={index} >\r\n                <img src={banner.path} className=\"d-block w-100\" alt=\"...\"></img>\r\n            </div>)}\r\n        </Slider>\r\n        **/\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { Page, View, VPage } from 'tonva';\r\nimport { CHome } from './CHome';\r\nimport { VSiteHeader } from './VSiteHeader';\r\nimport { VSlider } from './VSlider';\r\n\r\nexport class VHome extends VPage<CHome> {\r\n\r\n    async open(param?: any) {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    render(param: any): JSX.Element {\r\n        return <this.pageContent />\r\n    }\r\n\r\n    private page = () => {\r\n        return <Page header={false}>\r\n            <this.pageContent />\r\n        </Page>;\r\n    };\r\n\r\n    private pageContent = () => {\r\n        let { controller } = this;\r\n        let { renderCategoryRootList } = controller;\r\n        let siteHeader = this.renderVm(VSiteHeader);\r\n        return <>\r\n            {siteHeader}\r\n            <div className=\"mb-3\">\r\n                {this.renderVm(VSlider)}\r\n            </div>\r\n            {renderCategoryRootList()}\r\n        </>\r\n    };\r\n}","import { Tuid } from 'tonva';\r\nimport { PageItems } from 'tonva';\r\nimport { CUqBase } from '../CBase';\r\nimport { VSearchHeader } from './VSearchHeader';\r\nimport { VHome } from './VHome';\r\n\r\nclass HomeSections extends PageItems<any> {\r\n\r\n    private sectionTuid: Tuid;\r\n\r\n    constructor(sectionTuid: Tuid) {\r\n        super();\r\n        this.firstSize = this.pageSize = 13;\r\n        this.sectionTuid = sectionTuid;\r\n    }\r\n\r\n    protected async loadResults(param: any, pageStart: any, pageSize: number): Promise<{ [name: string]: any[] }> {\r\n        let ret = await this.sectionTuid.search(\"\", pageStart, pageSize);\r\n        return { $page: ret };\r\n    }\r\n    protected async load(param: any, pageStart: any, pageSize: number): Promise<any[]> {\r\n        if (pageStart === undefined) pageStart = 0;\r\n        let ret = await this.sectionTuid.search(\"\", pageStart, pageSize);\r\n        return ret;\r\n    }\r\n\r\n    protected setPageStart(item: any): any {\r\n        if (item === undefined) return 0;\r\n        return item.id;\r\n    }\r\n}\r\n\r\nexport class CHome extends CUqBase {\r\n\r\n    homeSections: HomeSections;\r\n    sectionTuid: Tuid;\r\n\r\n    banners: any[] = [];\r\n    async internalStart(param: any) {\r\n\r\n        let { cProductCategory } = this.cApp;\r\n        await cProductCategory.start();\r\n        this.openVPage(VHome);\r\n    }\r\n\r\n    renderSearchHeader = (size?: string) => {\r\n        return this.renderView(VSearchHeader, size);\r\n    }\r\n\r\n    renderCategoryRootList = () => {\r\n        let { cProductCategory } = this.cApp;\r\n        return cProductCategory.renderRootList();\r\n    }\r\n\r\n    getSlideShow = async () => {\r\n        let list = await this.uqs.webBuilder.GetSlideShow.table({});\r\n        list.forEach(v => {\r\n            this.banners.push({ path: v.path, src: v.src });\r\n        })\r\n    }\r\n\r\n    tab = () => this.renderView(VHome);\r\n}","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { View } from 'tonva';\r\nimport { CCart } from './CCart';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VCartLabel extends View<CCart> {\r\n\r\n    private showCart = async () => {\r\n        this.controller.start();\r\n    }\r\n\r\n    render(param: any): JSX.Element {\r\n        return <this.content />\r\n    };\r\n\r\n    private content = observer(() => {\r\n        let { cart } = this.controller.cApp;\r\n        let count: any = cart.count.get();\r\n        let badge, onClick, pointer;\r\n        if (count > 0) {\r\n            onClick = this.showCart;\r\n            pointer = 'cursor-pointer';\r\n            if (count < 100) badge = <u>{count}</u>;\r\n            else badge = <u>99+</u>;\r\n        }\r\n        return <div className={classNames('jk-cart ml-1 mr-2', pointer)} onClick={onClick}>\r\n            <div>\r\n                <span className=\"fa-stack\">\r\n                    <i className=\"fa fa-square fa-stack-2x text-white\"></i>\r\n                    <i className=\"fa fa-shopping-cart fa-stack-1x text-info\"></i>\r\n                </span>\r\n                {badge}\r\n            </div>\r\n        </div>\r\n    });\r\n}","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport { UpdownWidget } from 'tonva';\r\n\r\nconst keys = [107, 109, 110, 187, 189];\r\n\r\nexport class MinusPlusWidget extends UpdownWidget {\r\n    @observable protected value: any;\r\n    @observable protected disabled: boolean;\r\n    // @observable protected hasFocus: boolean;\r\n\r\n    protected isValidKey(key: number): boolean {\r\n        if (keys.find(v => v === key) !== undefined) return false;\r\n        return super.isValidKey(key);\r\n    }\r\n\r\n\t/*\r\n    protected onBlur = (evt: React.FocusEvent<any>) => {\r\n        super.onBlur(evt);\r\n        this.hasFocus = false;\r\n    }\r\n\r\n    protected onFocus(evt: React.FocusEvent<any>) {\r\n        super.onFocus(evt);\r\n        this.hasFocus = true;\r\n\t}\r\n\t*/\r\n\r\n    protected onChange(evt: React.ChangeEvent<any>) {\r\n    }\r\n\r\n    private minusClick = () => {\r\n        let v = this.getValue();\r\n        if (!v) v = 0;\r\n        this.setValue(v - 1);\r\n    }\r\n    private plusClick = () => {\r\n        let v = this.getValue();\r\n        if (!v) v = 0;\r\n        this.setValue(v + 1);\r\n    }\r\n\r\n    private ref = (input: HTMLInputElement) => {\r\n        this.input = input;\r\n        if (this.input === null) return;\r\n        let p: HTMLElement;\r\n        for (p = this.input; ; p = p.parentElement) {\r\n            if (!p) break;\r\n            if (p.tagName !== 'FIELDSET') continue;\r\n            if ((p as any)['disabled'] === true) {\r\n                this.disabled = true;\r\n            }\r\n            break;\r\n        }\r\n    }\r\n\r\n    private renderContent = observer((): JSX.Element => {\r\n        let renderTemplet = this.renderTemplet();\r\n        if (renderTemplet !== undefined) return renderTemplet;\r\n        let cn: any = {\r\n            //'form-control': true,\r\n        };\r\n        if (this.hasError === true) {\r\n            cn['is-invalid'] = true;\r\n        }\r\n        else {\r\n            cn['required-item'] = this.itemSchema.required === true;\r\n        }\r\n        let hasFocus = this.hasFocus; // document.hasFocus() && document.activeElement === this.input;\r\n        let hasAction = this.readOnly !== true && this.disabled !== true;\r\n        let hasValue = isNaN(this.value) === false && this.value !== undefined && this.value > 0;\r\n        let cursorPointer: string,\r\n            minusColor: string, minusClick: any,\r\n            plusColor: string, plusClick: any;\r\n        if (this.disabled === true) {\r\n            cursorPointer = 'cursor-pointer';\r\n            minusColor = plusColor = 'text-light';\r\n        }\r\n        else {\r\n            minusClick = this.minusClick;\r\n            plusClick = this.plusClick;\r\n            minusColor = 'text-danger-2'; //'text-black-50';\r\n            plusColor = 'text-danger';\r\n        }\r\n        let minus = <i className={classNames('fa',\r\n            'fa-minus-circle', 'fa-lg', minusColor, cursorPointer,\r\n            { invisible: !(hasFocus === true || (hasAction === true && hasValue === true)) })}\r\n            onClick={minusClick} />;\r\n        let input = <input ref={this.ref}\r\n            className={classNames(this.className, cn, 'mx-1 w-4c form-control',\r\n                { invisible: !(hasFocus === true || hasValue === true) })}\r\n            type=\"text\"\r\n            defaultValue={this.value}\r\n            onChange={this.onChange}\r\n            placeholder={this.placeholder}\r\n            readOnly={this.readOnly}\r\n            disabled={this.disabled}\r\n            onKeyDown={this.onKeyDown}\r\n            onFocus={(evt: React.FocusEvent<any>) => this.onFocus(evt)}\r\n            onBlur={(evt: React.FocusEvent<any>) => this.onBlur(evt)}\r\n            maxLength={10} />;\r\n\r\n        let plus = <i className={classNames('fa fa-plus-circle fa-lg',\r\n            plusColor, cursorPointer,\r\n            { invisible: !(hasAction === true) })}\r\n            onClick={plusClick} />;\r\n        return <div className=\"d-flex align-items-center\">{minus}{input}{plus}\r\n            {this.renderErrors()}\r\n        </div>;\r\n    });\r\n\r\n    render() {\r\n        return <this.renderContent />;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { VPage, Page, Form, ObjectSchema, NumSchema, ArrSchema, UiSchema, UiArr, FormField, UiCustom } from 'tonva';\r\nimport { FA } from 'tonva';\r\nimport { tv } from 'tonva';\r\nimport { MinusPlusWidget } from '../tools';\r\nimport { CCart } from './CCart';\r\nimport { CartPackRow, CartItem2 } from './Cart';\r\n\r\nconst cartSchema = [\r\n    {\r\n        name: 'list',\r\n        type: 'arr',\r\n        arr: [\r\n            { name: 'checked', type: 'boolean' },\r\n            { name: 'product', type: 'object' } as ObjectSchema,\r\n            {\r\n                name: 'packs', type: 'arr', arr: [\r\n                    { name: 'pack', type: 'object' } as ObjectSchema,\r\n                    { name: 'price', type: 'number' } as NumSchema,\r\n                    { name: 'quantity', type: 'number' } as NumSchema,\r\n                    { name: 'currency', type: 'object' } as ObjectSchema\r\n                ]\r\n            }\r\n        ],\r\n    } as ArrSchema\r\n];\r\n\r\nexport class VCart extends VPage<CCart> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    protected CheckOutButton = observer(() => {\r\n        let { checkOut, cApp } = this.controller;\r\n        let { cart } = cApp;\r\n        let amount = cart.amount.get();\r\n        let check = \"去结算\";\r\n        let content = amount > 0 ?\r\n            <>{check} (¥{amount})</> :\r\n            <>{check}</>;\r\n        return <div className=\"d-flex justify-content-center\">\r\n            <button className=\"btn btn-success w-75 mx-5\"\r\n                type=\"button\"\r\n                onClick={checkOut} disabled={amount <= 0}>\r\n                {content}\r\n            </button>\r\n        </div>;\r\n    });\r\n\r\n    render(params: any): JSX.Element {\r\n        return <this.tab />;\r\n    }\r\n\r\n    private renderCartItem = (item: CartItem2) => {\r\n        let { product } = item;\r\n        let { controller } = this;\r\n        let { onProductClick, renderCartProduct } = controller;\r\n        return <div className=\"pr-1\">\r\n            <div className=\"row\">\r\n                <div className=\"col-lg-6 pb-3\" onClick={() => onProductClick(product)}>\r\n                    {renderCartProduct(product)}\r\n                </div>\r\n                <div className=\"col-lg-6\"><FormField name=\"packs\" /></div>\r\n            </div>\r\n        </div>;\r\n    }\r\n\r\n    private packsRow = (item: CartPackRow) => {\r\n        let { pack, price, currency } = item;\r\n\r\n        return <div className=\"px-2\">\r\n            <div className=\"d-flex align-items-center\">\r\n                <div className=\"flex-grow-1\"><b>{tv(pack)}</b></div>\r\n                <div className=\"w-6c mr-4 text-right\"><span className=\"text-danger h5\">¥{price}</span></div>\r\n                <FormField name=\"quantity\" />\r\n            </div>\r\n            <div>{this.controller.renderDeliveryTime(pack)}</div>\r\n        </div>;\r\n    }\r\n\r\n    private uiSchema: UiSchema = {\r\n        selectable: true,\r\n        deletable: true,\r\n        restorable: true,\r\n        items: {\r\n            list: {\r\n                widget: 'arr',\r\n                Templet: this.renderCartItem,\r\n                ArrContainer: (label: any, content: JSX.Element) => content,\r\n                RowContainer: (content: JSX.Element) => <div className=\"py-3\">{content}</div>,\r\n                items: {\r\n                    packs: {\r\n                        widget: 'arr',\r\n                        Templet: this.packsRow,\r\n                        selectable: false,\r\n                        deletable: false,\r\n                        ArrContainer: (label: any, content: JSX.Element) => content,\r\n                        RowContainer: (content: JSX.Element) => content,\r\n                        RowSeperator: <div className=\"border border-gray border-top my-3\" />,\r\n                        items: {\r\n                            quantity: {\r\n                                widget: 'custom',\r\n                                className: 'text-center',\r\n                                WidgetClass: MinusPlusWidget as any,\r\n                                onChanged: this.controller.onQuantityChanged\r\n                            } as UiCustom\r\n                        },\r\n                    } as UiArr\r\n                }\r\n            } as UiArr\r\n        }\r\n    }\r\n\r\n    protected cartForm = observer(() => {\r\n        let { cart } = this.controller.cApp;\r\n        let { data: cartData } = cart;\r\n        return <Form className=\"bg-white flex-fill overflow-auto\" schema={cartSchema} uiSchema={this.uiSchema} formData={cartData} />\r\n    });\r\n\r\n    private empty() {\r\n        return <div className=\"py-5 text-center bg-white\">你的购物车空空如也</div>\r\n    }\r\n\r\n    private page = observer((params: any): JSX.Element => {\r\n        let { cart } = this.controller.cApp;\r\n        let footer: any, content: any;\r\n        if (cart.count.get() === 0 && cart.cartItems.length === 0) {\r\n            content = this.empty();\r\n            footer = undefined;\r\n        }\r\n        else {\r\n            content = React.createElement(this.cartForm);\r\n            footer = React.createElement(this.CheckOutButton);\r\n        }\r\n        return <Page header=\"购物车\" footer={footer}>\r\n            {content}\r\n        </Page>;\r\n    })\r\n\r\n    private tab = observer(() => {\r\n        let { cart } = this.controller.cApp;\r\n        let header = <header className=\"py-2 text-center bg-info text-white\">\r\n            <FA className=\"align-middle\" name=\"shopping-cart\" size=\"2x\" /> &nbsp; <span className=\"h5 align-middle\">购物车</span>\r\n        </header>;\r\n        if (cart.count.get() === 0 && cart.cartItems.length === 0) {\r\n            return <>\r\n                {header}\r\n                {this.empty()}\r\n            </>;\r\n        }\r\n\r\n        let content = React.createElement(this.cartForm);\r\n        let footer = React.createElement(this.CheckOutButton);\r\n        return <>\r\n            {content}\r\n            {footer}\r\n        </>;\r\n    });\r\n\r\n    header() {\r\n        let header = <header className=\"py-2 text-center bg-info text-white\">\r\n            <FA className=\"mr-3\" name=\"shopping-cart\" size=\"lg\" />\r\n            <span>购物车</span>\r\n        </header>;\r\n        return header;\r\n    }\r\n\t/*\r\n\tfooter() {\r\n\t\treturn <div className=\"p-3 d-flex justify-content-center\"><this.CheckOutButton /></div>;\r\n\t}\r\n\t*/\r\n\r\n    content() {\r\n        return <this.tab />\r\n    }\r\n}","import * as React from 'react';\r\nimport { RowContext, nav, User, BoxId } from 'tonva';\r\nimport { CUqBase } from '../CBase';\r\nimport { VCartLabel } from './VCartLabel';\r\nimport { VCart } from './VCart';\r\nimport { CartPackRow, CartItem2 } from './Cart';\r\n\r\nexport class CCart extends CUqBase {\r\n\r\n    private selectedCartItems: CartItem2[];\r\n    tabPage: VCart = new VCart(this);\r\n\r\n    protected async internalStart(param: any) {\r\n        this.openVPage(VCart);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * 显示购物车图标\r\n     */\r\n    renderCartLabel() {\r\n        return this.renderView(VCartLabel);\r\n    }\r\n\r\n    onQuantityChanged = async (context: RowContext, value: any, prev: any) => {\r\n        let { data, parentData } = context;\r\n        let { product } = parentData;\r\n        let { pack, price, retail, currency } = data as CartPackRow;\r\n        let { cart } = this.cApp;\r\n        if (value > 0)\r\n            await cart.add(product, pack, value, price, retail, currency);\r\n        else\r\n            await cart.removeFromCart([{ productId: product.id, packId: pack.id }]);\r\n    }\r\n\r\n    onRowStateChanged = async (context: RowContext, selected: boolean, deleted: boolean) => {\r\n        alert('onRowStateChanged')\r\n    }\r\n\r\n    private loginCallback = async (user: User): Promise<void> => {\r\n        let { cApp } = this;\r\n        await cApp.currentUser.setUser(user);\r\n        await cApp.loginCallBack(user);\r\n        this.closePage(1);\r\n        await this.doFirstOrderChecking();\r\n    };\r\n\r\n    onProductClick = (product: BoxId) => {\r\n        let { cart, cProduct } = this.cApp;\r\n        if (!cart.isDeleted(product.id)) {\r\n            cProduct.showProductDetail(product);\r\n        }\r\n    }\r\n\r\n    checkOut = async () => {\r\n        let { cart } = this.cApp;\r\n        this.selectedCartItems = cart.getSelectedItems();\r\n        if (this.selectedCartItems === undefined) return;\r\n        if (!this.isLogined) {\r\n            nav.showLogin(this.loginCallback, true);\r\n        } else {\r\n            await this.doFirstOrderChecking();\r\n        }\r\n    }\r\n\r\n    private doFirstOrderChecking = async () => {\r\n        let { cMe, currentUser } = this.cApp;\r\n        if (!currentUser.allowOrdering) {\r\n            cMe.openMeInfoFirstOrder({\r\n                onlyRequired: false,\r\n                caption: \"请补充账户信息\",\r\n                note: <>\r\n                    化学品是受国家安全法规限制的特殊商品，百灵威提供技术咨询、资料以及化学产品的对象必须是具有化学管理和应用能力的专业单位（非个人）。\r\n                为此，需要您重新提供非虚拟的、可核查的信息。这些信息包括下面所有带有 <span className=\"text-danger\">*</span> 的信息。\r\n                </>,\r\n                actionButton: {\r\n                    value: \"下一步\",\r\n                    action: this.doCheckOut\r\n                }\r\n            });\r\n        } else {\r\n            await this.doCheckOut();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 导航到CheckOut界面\r\n     */\r\n    doCheckOut = async () => {\r\n\r\n        let { cOrder } = this.cApp;\r\n        let { selectedCartItems } = this;\r\n        if (selectedCartItems === undefined) return;\r\n        await cOrder.createOrderFromCart(selectedCartItems);\r\n        // await cOrder.start(this.selectedCartItems);\r\n    }\r\n\r\n    tab = () => this.renderView(VCart);\r\n\r\n    renderDeliveryTime = (pack: BoxId) => {\r\n        let { cProduct } = this.cApp;\r\n        return cProduct.renderDeliveryTime(pack);\r\n    }\r\n\r\n    renderCartProduct = (product: BoxId) => {\r\n        let { cProduct } = this.cApp;\r\n        return cProduct.renderCartProduct(product);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { Image } from 'tonva';\r\n\r\nconst imagePath = \"https://www.jkchemical.com/static/Structure/\";\r\nconst pointProductImagePath = \"https://www.jkchemical.com/static/images/pointshop\";\r\nconst altimagePath = \"https://www.jkchemical.com/static/Structure/999.png\";\r\n\r\ninterface ProductImageProps {\r\n    className?: string;\r\n    style?: React.CSSProperties;\r\n    chemicalId: string;\r\n}\r\n\r\nexport function ProductImage(props: ProductImageProps) {\r\n\r\n    let { style, className, chemicalId } = props;\r\n    return <Image src={chemicalId && (imagePath + chemicalId.substr(0, 3) + '/' + chemicalId + '.png')}\r\n        style={style} className={className} altImage={altimagePath} />;\r\n}\r\n\r\nexport function PointProductImage(props: ProductImageProps) {\r\n\r\n    let { style, className, chemicalId } = props;\r\n    return <Image src={chemicalId && (pointProductImagePath + '/' + chemicalId + '.png')}\r\n        style={style} className={className} altImage={altimagePath} />;\r\n}\r\n","import * as React from 'react';\r\nimport { View, tv, FormField, ObjectSchema, NumSchema, UiSchema, UiCustom, RowContext, BoxId, Form, ItemSchema } from 'tonva';\r\nimport { CProduct } from './CProduct';\r\nimport { ProductImage } from 'tools/productImage';\r\nimport { observer } from 'mobx-react';\r\nimport { MinusPlusWidget } from 'tools';\r\nimport { observable } from 'mobx';\r\nimport classNames from 'classnames';\r\n\r\nexport class VCartProuductView extends View<CProduct> {\r\n\r\n    render(param: any): JSX.Element {\r\n        return <>{tv(param, this.renderCartProduct)}</>;\r\n    }\r\n\r\n\r\n    private renderCartProduct = (product: any) => {\r\n        let { id, brand, description, descriptionC, origin, imageUrl } = product;\r\n\r\n        return <div className=\"row d-flex mb-3 px-2\">\r\n            <div className=\"col-12\">\r\n                <div className=\"py-2\">\r\n                    <strong>{description}</strong>\r\n                </div>\r\n                <div className=\"pb-2\">\r\n                    <strong>{descriptionC}</strong>\r\n                </div>\r\n                <div className=\"row\">\r\n                    <div className=\"col-3\">\r\n                        <ProductImage chemicalId={imageUrl} className=\"w-4c h-4c\" />\r\n                    </div>\r\n                    <div className=\"col-9\">\r\n                        <div className=\"row\">\r\n                            {productPropItem('编号', origin)}\r\n                            {this.controller.renderChemicalInfoInCart(product)}\r\n                            {tv(brand, renderBrand)}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    };\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport class VProuductView extends View<CProduct> {\r\n\r\n    @observable product: any;\r\n    @observable discount: number;\r\n\r\n    render(product: BoxId): JSX.Element {\r\n        return <this.renderProduct productBox={product} />;\r\n    }\r\n\r\n    private async getProudct(product: BoxId) {\r\n        if (this.product === undefined) {\r\n            let ret = await this.controller.getProductAndDiscount(product);\r\n            this.product = ret.product;\r\n            this.discount = ret.discount;\r\n        }\r\n    }\r\n\r\n    private renderProduct = observer((param: any) => {\r\n        let { productBox } = param;\r\n        this.getProudct(productBox);\r\n        if (!this.product)\r\n            return null;\r\n        let { renderChemicalInfoInCart } = this.controller;\r\n        let { id, brand, description, descriptionC, origin, imageUrl } = this.product;\r\n        return <div className=\"d-block mb-4 px-3\">\r\n            <div className=\"py-2\">\r\n                <div><strong>{description}</strong></div>\r\n                <div>{descriptionC}</div>\r\n            </div>\r\n            <div className=\"row\">\r\n                <div className=\"col-3\">\r\n                    <ProductImage chemicalId={imageUrl} className=\"w-100\" />\r\n                </div>\r\n                <div className=\"col-9\">\r\n                    <div className=\"row\">\r\n                        {productPropItem('产品编号', origin)}\r\n                        {renderChemicalInfoInCart(productBox)}\r\n                        {tv(brand, renderBrand)}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    })\r\n}\r\n\r\n/**\r\n * 显示产品包装价格，配合CProduct.renderProductPrice使用\r\n * 需要的参数product必须是BoxId(或者object?)\r\n */\r\nexport class VProductPrice extends View<CProduct> {\r\n\r\n    private schema: ItemSchema[] = [\r\n        { name: 'pack', type: 'object' } as ObjectSchema,\r\n        { name: 'quantity', type: 'number' } as NumSchema,\r\n        { name: 'retail', type: 'number' } as NumSchema,\r\n        { name: 'vipPrice', type: 'number' } as NumSchema,\r\n        { name: 'promotionPrice', type: 'number' } as NumSchema,\r\n        { name: 'currency', type: 'string' },\r\n    ];\r\n\r\n    private onQuantityChanged = async (context: RowContext, value: any, prev: any) => {\r\n        let { data } = context;\r\n        let { pack, retail, vipPrice, promotionPrice, currency } = data;\r\n        let price = this.minPrice(vipPrice, promotionPrice) || retail;\r\n        let { cApp } = this.controller;\r\n        let { cart } = cApp;\r\n        if (value > 0)\r\n            await cart.add(this.product, pack, value, price, retail, currency);\r\n        else\r\n            await cart.removeFromCart([{ productId: this.product.id, packId: pack.id }]);\r\n    }\r\n\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            pack: { visible: false },\r\n            retail: { visible: false },\r\n            vipPrice: { visible: false },\r\n            promotionPrice: { visible: false },\r\n            currency: { visible: false },\r\n            quantity: {\r\n                widget: 'custom',\r\n                label: null,\r\n                className: 'text-center',\r\n                WidgetClass: MinusPlusWidget,\r\n                onChanged: this.onQuantityChanged as any\r\n            } as UiCustom\r\n        }\r\n    }\r\n\r\n    @observable private prices: any;\r\n    private initPrices = async (product: BoxId, salesRegionId: number, discount: number) => {\r\n        if (this.prices === undefined)\r\n            this.prices = await this.controller.getProductPrice(product, salesRegionId, discount);\r\n    }\r\n\r\n    private renderPrice(item: any) {\r\n        let { pack, retail, vipPrice, promotionPrice } = item;\r\n        let right = null;\r\n        if (retail) {\r\n            let price: number = this.minPrice(vipPrice, promotionPrice);\r\n            let retailUI: any;\r\n            if (price) {\r\n                retailUI = <small className=\"text-muted\"><del>¥{retail}</del></small>;\r\n            }\r\n            else {\r\n                price = retail;\r\n            }\r\n            right = <div className=\"row\">\r\n                <div className=\"col-sm-6 pb-2 d-flex justify-content-end align-items-center\">\r\n                    <small className=\"text-muted\">{retailUI}</small>&nbsp; &nbsp;\r\n                    <span className=\"text-danger\">¥ <span className=\"h5\">{price}</span></span>\r\n                </div>\r\n                <div className=\"col-sm-6 pb-2 d-flex justify-content-end align-items-center\">\r\n                    <Form schema={this.schema} uiSchema={this.uiSchema} formData={item} />\r\n                </div>\r\n            </div >\r\n        } else {\r\n            right = <small>请询价</small>\r\n        }\r\n        return right;\r\n    }\r\n\r\n    private minPrice(vipPrice: any, promotionPrice: any) {\r\n        if (vipPrice || promotionPrice)\r\n            return Math.min(typeof (vipPrice) === 'number' ? vipPrice : Infinity, typeof (promotionPrice) === 'number' ? promotionPrice : Infinity);\r\n    }\r\n\r\n    private product: BoxId;\r\n    render(param: any): JSX.Element {\r\n        let { product, discount } = param;\r\n        this.product = product;\r\n        let { currentSalesRegion } = this.controller.cApp;\r\n        return <this.content product={product} SalesRegionId={currentSalesRegion} discount={discount} />;\r\n    }\r\n\r\n    private content = observer((param?: any) => {\r\n        let priceUI;\r\n        let { product, SalesRegionId, discount } = param;\r\n\r\n        let { renderDeliveryTime } = this.controller;\r\n        this.initPrices(product, SalesRegionId, discount);\r\n        if (this.prices && this.prices.length > 0) {\r\n            priceUI = this.prices.map((v: any, index: number) => {\r\n                let { pack, retail } = v;\r\n                if (retail) {\r\n                    return <div className=\"px-2\" key={pack.id}>\r\n                        <div className=\"row\">\r\n                            <div className=\"col-6\">\r\n                                <div><b>{tv(pack)}</b></div>\r\n                                <div>{renderDeliveryTime(pack)}</div>\r\n                            </div>\r\n                            <div className=\"col-6\">\r\n                                {this.renderPrice(v)}\r\n                            </div>\r\n                        </div>\r\n                    </div>;\r\n                } else {\r\n                    return <small>请询价</small>\r\n                }\r\n            });\r\n        }\r\n        return <>\r\n            {priceUI}\r\n        </>;\r\n    })\r\n}\r\n\r\nexport class VProductWithPrice extends View<CProduct> {\r\n    @observable product: any;\r\n    @observable discount: number;\r\n\r\n    render(product: BoxId): JSX.Element {\r\n        return <this.renderProduct productBox={product} />;\r\n    }\r\n\r\n    private async getProudct(product: BoxId) {\r\n        if (this.product === undefined) {\r\n            let ret = await this.controller.getProductAndDiscount(product);\r\n            this.product = ret.product;\r\n            this.discount = ret.discount;\r\n        }\r\n    }\r\n\r\n    private renderProduct = observer((param: any) => {\r\n        let { productBox } = param;\r\n        this.getProudct(productBox);\r\n        if (!this.product)\r\n            return null;\r\n        let { renderChemicalInfoInCart, renderProductPrice } = this.controller;\r\n        let { id, brand, description, descriptionC, origin, imageUrl } = this.product;\r\n        return <div className=\"d-block mb-2 px-3\">\r\n            <div className=\"py-2\">\r\n                <div><strong>{description}</strong></div>\r\n                <div>{descriptionC}</div>\r\n            </div>\r\n            <div className=\"row py-2\">\r\n                <div className=\"col-3\">\r\n                    <ProductImage chemicalId={imageUrl} className=\"w-100\" />\r\n                </div>\r\n                <div className=\"col-9\">\r\n                    <div className=\"row\">\r\n                        {productPropItem('产品编号', origin)}\r\n                        {renderChemicalInfoInCart(productBox)}\r\n                        {tv(brand, renderBrand)}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div className=\"border-top pt-2\">\r\n                {renderProductPrice(productBox, this.discount)}\r\n            </div>\r\n        </div>\r\n    })\r\n    /*\r\n    render(product: BoxId): JSX.Element {\r\n        let { renderProduct, renderProductPrice } = this.controller;\r\n        return <div className=\"d-flex flex-column\">\r\n            <div>{renderProduct(product)}</div>\r\n            <div className=\"p-2 border-top\">{renderProductPrice(product, 1)}</div>\r\n        </div>\r\n    }\r\n    */\r\n}\r\n\r\nexport function renderBrand(brand: any) {\r\n    return productPropItem('品牌', brand.name);\r\n}\r\n\r\nexport function productPropItem(caption: string, value: any, captionClass?: string) {\r\n    if (value === null || value === undefined || value === '0') return null;\r\n    let capClass = captionClass ? classNames(captionClass) : classNames(\"text-muted\");\r\n    let valClass = captionClass ? classNames(captionClass) : \"\";\r\n    return <>\r\n        <div className={classNames(\"col-6 col-sm-2 pr-0 small\", capClass)}> {caption}</div>\r\n        <div className={classNames(\"col-6 col-sm-4\", valClass)}>{value}</div>\r\n    </>;\r\n}\r\n\r\n/**\r\n * 显示产品信息（不包含包装价格），特定于参数包含相关的CAS/Purity等信息），现应用于产品列表\r\n * @param product\r\n */\r\nexport function renderProduct(product: any) {\r\n    let { brand, description, descriptionC, CAS, purity, molecularFomula, molecularWeight, origin, imageUrl } = product;\r\n    return <div className=\"d-block mb-4 px-3\">\r\n        <div className=\"py-2\">\r\n            <div><strong>{description}</strong></div>\r\n            <div>{descriptionC}</div>\r\n        </div>\r\n        <div className=\"row\">\r\n            <div className=\"col-3\">\r\n                <ProductImage chemicalId={imageUrl} className=\"w-100\" />\r\n            </div>\r\n            <div className=\"col-9\">\r\n                <div className=\"row\">\r\n                    {productPropItem('产品编号', origin)}\r\n                    {productPropItem('CAS', CAS)}\r\n                    {productPropItem('纯度', purity)}\r\n                    {productPropItem('分子式', molecularFomula)}\r\n                    {productPropItem('分子量', molecularWeight)}\r\n                    {tv(brand, renderBrand)}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n}","import * as React from 'react';\r\nimport { CProduct } from './CProduct';\r\nimport {\r\n    VPage, Page, Form, ItemSchema, NumSchema, UiSchema, Field,\r\n    ObjectSchema, RowContext, UiCustom, FormField, BoxId\r\n} from 'tonva';\r\nimport { tv } from 'tonva';\r\nimport { MinusPlusWidget } from '../tools/minusPlusWidget';\r\nimport { ProductPackRow } from './Product';\r\nimport { ViewMainSubs, MainProductChemical } from 'mainSubs';\r\nimport { ProductImage } from 'tools/productImage';\r\nimport { productPropItem, renderBrand } from './VProductView';\r\n\r\nconst schema: ItemSchema[] = [\r\n    { name: 'pack', type: 'object' } as ObjectSchema,\r\n    { name: 'retail', type: 'number' } as NumSchema,\r\n    { name: 'vipPrice', type: 'number' } as NumSchema,\r\n    { name: 'promotionPrice', type: 'number' } as NumSchema,\r\n    { name: 'currency', type: 'string' },\r\n    { name: 'quantity', type: 'number' } as NumSchema,\r\n    { name: 'inventoryAllocation', type: 'object' } as ObjectSchema,\r\n    { name: 'futureDeliveryTimeDescription', type: 'string' }\r\n];\r\n\r\nexport class VProduct extends VPage<CProduct> {\r\n    private productBox: BoxId;\r\n    private discount: number;\r\n\r\n    async open(param: any) {\r\n        let { productData, product, discount } = param;\r\n        this.productBox = product;\r\n        this.discount = discount;\r\n        this.openPage(this.page, productData);\r\n    }\r\n\r\n    private renderProduct = (product: MainProductChemical) => {\r\n\r\n        let { brand, description, descriptionC, CAS, purity, molecularFomula, molecularWeight, origin, imageUrl } = product;\r\n        return <div className=\"mb-3 px-2\">\r\n            <div className=\"py-2\"><strong>{description}</strong></div>\r\n            <div>{descriptionC}</div>\r\n            <div className=\"row mt-3\">\r\n                <div className=\"col-12 col-sm-3\">\r\n                    <ProductImage chemicalId={imageUrl} className=\"w-100\" />\r\n                </div>\r\n                <div className=\"col-12 col-sm-9\">\r\n                    <div className=\"row mx-3\">\r\n                        {productPropItem('产品编号', origin, \"font-weight-bold\")}\r\n                        {productPropItem('CAS', CAS, \"font-weight-bold\")}\r\n                        {productPropItem('纯度', purity)}\r\n                        {productPropItem('分子式', molecularFomula)}\r\n                        {productPropItem('分子量', molecularWeight)}\r\n                        {renderBrand(brand)}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    }\r\n\r\n    private arrTemplet = (item: ProductPackRow) => {\r\n        let { pack, retail, vipPrice, promotionPrice } = item;\r\n        let right = null;\r\n        if (retail) {\r\n            let price: number = this.minPrice(vipPrice, promotionPrice);\r\n            let retailUI: any;\r\n            if (price) {\r\n                retailUI = <small className=\"text-muted\"><del>¥{retail}</del></small>;\r\n            }\r\n            else {\r\n                price = retail;\r\n            }\r\n            right = <div className=\"row\">\r\n                <div className=\"col-sm-6 pb-2 d-flex justify-content-end align-items-center\">\r\n                    <small className=\"text-muted\">{retailUI}</small>&nbsp; &nbsp;\r\n                    <span className=\"text-danger\">¥ <span className=\"h5\">{price}</span></span>\r\n                </div>\r\n                <div className=\"col-sm-6 pb-2 d-flex justify-content-end align-items-center\"><FormField name=\"quantity\" /></div>\r\n            </div >\r\n        } else {\r\n            right = <small>请询价</small>\r\n        }\r\n\r\n        return <div className=\"px-2\">\r\n            <div className=\"row\">\r\n                <div className=\"col-6\">\r\n                    <div><b>{tv(pack)}</b></div>\r\n                    <div>{this.controller.renderDeliveryTime(pack)}</div>\r\n                </div>\r\n                <div className=\"col-6\">\r\n                    {right}\r\n                </div>\r\n            </div>\r\n        </div>;\r\n    }\r\n\r\n    private onQuantityChanged = async (context: RowContext, value: any, prev: any) => {\r\n        let { data } = context;\r\n        let { pack, retail, vipPrice, promotionPrice, currency } = data;\r\n        let price = this.minPrice(vipPrice, promotionPrice) || retail;\r\n        let { cApp } = this.controller;\r\n        let { cart } = cApp;\r\n        if (value > 0)\r\n            await cart.add(this.productBox, pack, value, price, retail, currency);\r\n        else\r\n            await cart.removeFromCart([{ productId: this.productBox.id, packId: pack.id }]);\r\n    }\r\n\r\n    private minPrice(vipPrice: any, promotionPrice: any) {\r\n        if (vipPrice || promotionPrice)\r\n            return Math.min(typeof (vipPrice) === 'number' ? vipPrice : Infinity, typeof (promotionPrice) === 'number' ? promotionPrice : Infinity);\r\n    }\r\n\r\n    private uiSchema: UiSchema = {\r\n        Templet: this.arrTemplet,\r\n        items: {\r\n            quantity: {\r\n                widget: 'custom',\r\n                className: 'text-center',\r\n                WidgetClass: MinusPlusWidget as any,\r\n                onChanged: this.onQuantityChanged\r\n            } as UiCustom\r\n        },\r\n    };\r\n\r\n    private renderPack = (pack: ProductPackRow) => {\r\n        return <>\r\n            <div className=\"sep-product-select\" />\r\n            <Form className=\"mx-3\" schema={schema} uiSchema={this.uiSchema} formData={pack} />\r\n        </>;\r\n    }\r\n\r\n    private page = (product: any) => {\r\n\r\n        let { cApp } = this.controller;\r\n        let header = cApp.cHome.renderSearchHeader();\r\n        let cartLabel = cApp.cCart.renderCartLabel();\r\n        if (true) {\r\n            let viewProduct = new ViewMainSubs<MainProductChemical, ProductPackRow>(this.renderProduct, this.renderPack);\r\n            viewProduct.model = product;\r\n\r\n            return <Page header={header} right={cartLabel}>\r\n                <div className=\"px-2 py-2 bg-white mb-3\">{viewProduct.render()}</div>\r\n            </Page>\r\n        } else {\r\n            /*\r\n            下面的做法大概不行，因为嵌套的层次较深，且都是observer的，上层observable的变化会嵌套执行下层的代码，而下层代码的render\r\n            会操作数据库，得不偿失（和React的可能还不一样，React只会更新必要的html，不会再执行查询DB的操作）\r\n            */\r\n            let { controller, productBox } = this;\r\n            let { renderProductWithPrice } = controller;\r\n            return <Page header={header} right={cartLabel}>\r\n                <div className=\"px-2 py-2 bg-white mb-3\">\r\n                    {renderProductWithPrice(productBox)}\r\n                </div>\r\n            </Page>\r\n        }\r\n    }\r\n}","import * as React from 'react';\r\nimport { VPage, Page, Scroller } from 'tonva';\r\nimport { CProduct } from './CProduct';\r\nimport { List } from 'tonva';\r\nimport { observer } from 'mobx-react';\r\nimport { renderProduct } from './VProductView';\r\n\r\nexport class VProductList extends VPage<CProduct> {\r\n\r\n    private searchKey: string;\r\n    async open(key: string) {\r\n        this.searchKey = key;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private onProductClick = async (product: any) => {\r\n        await this.controller.showProductDetail(product.id);\r\n    }\r\n\r\n    private onScrollBottom = async (scroller: Scroller) => {\r\n        scroller.scrollToBottom();\r\n        let { productsPager } = this.controller;\r\n        //await this.controller.pageProducts.more();\r\n        productsPager.more();\r\n    }\r\n\r\n    private page = observer(() => {\r\n\r\n        let { productsPager, cApp } = this.controller;\r\n        let { cHome, cCart } = cApp;\r\n        let header = cHome.renderSearchHeader();\r\n        let cart = cCart.renderCartLabel();\r\n        let none = <div className=\"p-3 text-warning\">[无]</div>\r\n        return <Page header={header} right={cart} onScrollBottom={this.onScrollBottom}>\r\n            <div className=\"bg-white py-2 px-3 mb-1\"><small className=\" small text-muted\">搜索: </small>{this.searchKey}</div>\r\n            <List before={''} none={none} items={productsPager} item={{ render: renderProduct, onClick: this.onProductClick }} />\r\n        </Page>\r\n    });\r\n}","import { Entity } from 'tonva';\r\nimport { CApp } from '../CApp';\r\n//import { CCartApp } from 'CCartApp';\r\n\r\nexport abstract class Loader<T> {\r\n    protected cApp: CApp;\r\n    private entities: Entity[] = [];\r\n    private schemaLoaded: boolean = false;\r\n    constructor(cApp: CApp) {\r\n        this.cApp = cApp;\r\n        //this.initEntities();\r\n    }\r\n\r\n    //protected abstract initEntities(): void;\r\n\r\n    protected async loadSchemas() {\r\n        if (this.schemaLoaded === true) return;\r\n        await Promise.all(this.entities);\r\n        this.schemaLoaded = true;\r\n    }\r\n\r\n    async load(param: any): Promise<T> {\r\n        await this.loadSchemas();\r\n        let data = this.initData();\r\n        await this.loadToData(param, data);\r\n        return data;\r\n    }\r\n    protected abstract async loadToData(param: any, data: T): Promise<void>;\r\n    protected abstract initData(): T;\r\n}\r\n","import { Loader } from '../mainSubs/loader';\r\n\r\nexport class LoaderProductChemical extends Loader<any> {\r\n    protected async loadToData(productId: number, data: any): Promise<void> {\r\n\r\n        let productChemical = await this.cApp.uqs.product.ProductChemical.obj({ product: productId });\r\n        if (productChemical) {\r\n            let { chemical, purity, CAS, molecularFomula, molecularWeight } = productChemical;\r\n            data.chemical = chemical;\r\n            data.purity = purity;\r\n            data.CAS = CAS;\r\n            data.molecularFomula = molecularFomula;\r\n            data.molecularWeight = molecularWeight;\r\n        }\r\n    }\r\n\r\n    protected initData(): any {\r\n        return {};\r\n    }\r\n}","import _ from 'lodash';\r\nimport { ProductPackRow } from './Product';\r\nimport { Loader } from '../mainSubs/loader';\r\nimport { MainSubs, MainProductChemical, MainBrand } from '../mainSubs';\r\nimport { LoaderProductChemical } from '../tools/productChemical';\r\n\r\nexport class LoaderBrand extends Loader<MainBrand> {\r\n    protected async loadToData(brandId: number, data: MainBrand): Promise<void> {\r\n        let brand = await this.cApp.uqs.product.Brand.load(brandId);\r\n        data.id = brand.id;\r\n        data.name = brand.name;\r\n    }\r\n\r\n    protected initData(): MainBrand {\r\n        return {} as MainBrand;\r\n    }\r\n}\r\n\r\nexport class LoaderProductWithChemical extends Loader<MainProductChemical> {\r\n\r\n    protected async loadToData(productId: number, data: MainProductChemical): Promise<void> {\r\n\r\n        let product = await this.cApp.uqs.product.ProductX.load(productId);\r\n        if (product === undefined)\r\n            return;\r\n        _.merge(data, product);\r\n\r\n        let brandLoader = new LoaderBrand(this.cApp);\r\n        data.brand = await brandLoader.load(data.brand.id);\r\n\r\n        let productChemicalLoader = new LoaderProductChemical(this.cApp);\r\n        let productChemical: any = await productChemicalLoader.load(productId);\r\n        if (productChemical) {\r\n            let { chemical, purity, CAS, molecularFomula, molecularWeight } = productChemical;\r\n            data.chemical = chemical;\r\n            data.purity = purity;\r\n            data.CAS = CAS;\r\n            data.molecularFomula = molecularFomula;\r\n            data.molecularWeight = molecularWeight;\r\n        }\r\n\r\n        data.packs = [];\r\n        product.packx.forEach((e: any) => {\r\n            data.packs.push(e);\r\n        });\r\n    }\r\n\r\n    protected initData(): MainProductChemical {\r\n        return {} as MainProductChemical;\r\n    }\r\n}\r\n\r\nexport class LoaderProductChemicalWithPrices extends Loader<MainSubs<MainProductChemical, ProductPackRow>> {\r\n\r\n    protected initData(): MainSubs<MainProductChemical, ProductPackRow> {\r\n        return { main: {} as MainProductChemical, subs: [] as ProductPackRow[] };\r\n    }\r\n\r\n    protected async loadToData(productId: any, data: MainSubs<MainProductChemical, ProductPackRow>): Promise<void> {\r\n        let { customerDiscount, product, promotion } = this.cApp.uqs;\r\n        let productLoader = new LoaderProductWithChemical(this.cApp);\r\n        data.main = await productLoader.load(productId);\r\n\r\n        let discount = 0;\r\n        let { currentUser, currentSalesRegion, cart, currentLanguage } = this.cApp;\r\n        if (currentUser.hasCustomer) {\r\n            let discountSetting = await customerDiscount.GetDiscount.obj({ brand: data.main.brand.id, customer: currentUser.currentCustomer });\r\n            discount = discountSetting && discountSetting.discount;\r\n        }\r\n\r\n        let { id: currentSalesRegionId } = currentSalesRegion;\r\n        let prices = await product.PriceX.table({ product: productId, salesRegion: currentSalesRegionId });\r\n        data.subs = prices.filter(e => e.discountinued === 0 && e.expireDate > Date.now()).sort((a, b) => a.retail - b.retail).map(element => {\r\n            let ret: any = {};\r\n            ret.pack = element.pack;\r\n            ret.retail = element.retail;\r\n            if (discount !== 0)\r\n                ret.vipPrice = Math.round(element.retail * (1 - discount));\r\n            ret.currency = currentSalesRegion.currency;\r\n            ret.quantity = cart.getQuantity(productId, element.pack.id)\r\n            return ret;\r\n        });\r\n\r\n        let promises: PromiseLike<any>[] = [];\r\n        data.subs.forEach(v => {\r\n            promises.push(promotion.GetPromotionPack.obj({ product: productId, pack: v.pack, salesRegion: currentSalesRegion, language: currentLanguage }));\r\n        })\r\n        let results = await Promise.all(promises);\r\n\r\n        for (let i = 0; i < data.subs.length; i++) {\r\n            let promotion = results[i];\r\n            let discount = promotion && promotion.discount;\r\n            if (discount)\r\n                data.subs[i].promotionPrice = Math.round((1 - discount) * data.subs[i].retail);\r\n        }\r\n    }\r\n}","import * as React from 'react';\r\nimport { tv, View } from 'tonva';\r\nimport { CProduct } from './CProduct';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\n\r\nexport class VProductDelivery extends View<CProduct> {\r\n\r\n    @observable private inventoryAllocation: any[];\r\n    @observable private futureDeliveryTimeDescription: string;\r\n\r\n    render(param: any): JSX.Element {\r\n        let { obj: packObj, id: packId } = param;\r\n        let { owner: productId } = packObj;\r\n        let { controller } = this;\r\n        let { currentSalesRegion } = controller.cApp;\r\n        return <this.content packId={packId} productId={productId} currentSalesRegion={currentSalesRegion} />;\r\n    }\r\n\r\n    private initInventoryAllocation = async (productId: number, packId: number, salesRegionId: number) => {\r\n        if (this.inventoryAllocation === undefined)\r\n            this.inventoryAllocation = await this.controller.getInventoryAllocation(productId, packId, salesRegionId);\r\n    }\r\n\r\n    private initFutureDeliveryTimeDescription = async (productId: number, salesRegionId: number) => {\r\n        if (this.futureDeliveryTimeDescription === undefined)\r\n            this.futureDeliveryTimeDescription = await this.controller.getFutureDeliveryTimeDescription(productId, salesRegionId);\r\n    }\r\n\r\n    private content = observer((param: any): any => {\r\n\r\n        let deliveryTimeUI;\r\n        let { packId, productId, currentSalesRegion } = param;\r\n        if (productId) {\r\n            this.initInventoryAllocation(productId, packId, currentSalesRegion);\r\n            this.initFutureDeliveryTimeDescription(productId, currentSalesRegion);\r\n        }\r\n        if (this.inventoryAllocation === undefined || this.futureDeliveryTimeDescription === undefined)\r\n            return null;\r\n        if (this.inventoryAllocation && this.inventoryAllocation.length > 0) {\r\n            deliveryTimeUI = this.inventoryAllocation.map((v, index) => {\r\n                let { warehouse, quantity, deliveryTimeDescription } = v;\r\n                if (quantity > 0) {\r\n                    return <div key={index} className=\"text-success\">\r\n                        {tv(warehouse, (values: any) => <span className=\"small\">{values.name}</span>)}: {(quantity > 10 ? '>10' : quantity)}\r\n                        {deliveryTimeDescription}\r\n                    </div>\r\n                } else {\r\n                    return undefined;\r\n                }\r\n            });\r\n        } else {\r\n            deliveryTimeUI = <div>{this.futureDeliveryTimeDescription && '期货: ' + this.futureDeliveryTimeDescription}</div>;\r\n        }\r\n        return deliveryTimeUI;\r\n    })\r\n}","import * as React from 'react';\r\nimport { tv, View } from 'tonva';\r\nimport { CProduct } from './CProduct';\r\nimport { observer } from 'mobx-react';\r\nimport { productPropItem } from './VProductView';\r\n\r\nexport class VChemicalInfoInCart extends View<CProduct> {\r\n\r\n    render(param: any): JSX.Element {\r\n        let { id: productId } = param;\r\n        if (typeof productId === 'object')\r\n            productId = productId.id;\r\n        let { controller } = this;\r\n        controller.getChemicalInfo(productId);\r\n        return <this.content productId={productId} />;\r\n    }\r\n\r\n    private content = observer((param: any) => {\r\n\r\n        let { productId } = param;\r\n        let { chemicalInfoContainer } = this.controller;\r\n        let chemicalInfo = chemicalInfoContainer[productId];\r\n        if (chemicalInfo !== undefined) {\r\n            let { chemical, purity, CAS, molecularFomula, molecularWeight } = chemicalInfo;\r\n            return <>\r\n                {productPropItem('CAS', CAS)}\r\n                {productPropItem('纯度', purity)}\r\n            </>\r\n        }\r\n        return <></>;\r\n    })\r\n}\r\n","import { observable } from 'mobx';\r\nimport { Query, tv, BoxId, PageItems, QueryPager } from 'tonva';\r\nimport { CUqBase } from '../CBase';\r\nimport { VProduct } from './VProduct';\r\nimport { VProductList } from './VProductList';\r\nimport { LoaderProductChemicalWithPrices } from './itemLoader';\r\nimport { VProductDelivery } from './VProductDelivery';\r\nimport { VCartProuductView, VProductWithPrice, VProuductView, VProductPrice } from './VProductView';\r\nimport { VChemicalInfoInCart } from './VChemicalInfo';\r\n\r\n/*\r\nclass PageProducts extends PageItems<any> {\r\n\r\n    private searchProductQuery: Query;\r\n\r\n    constructor(searchProductQuery: Query) {\r\n        super();\r\n        this.firstSize = this.pageSize = 10;\r\n        this.searchProductQuery = searchProductQuery;\r\n    }\r\n\r\n    protected async load(param: any, pageStart: any, pageSize: number): Promise<any[]> {\r\n        if (pageStart === undefined) pageStart = 0;\r\n        let ret = await this.searchProductQuery.page(param, pageStart, pageSize, false);\r\n        return ret;\r\n    }\r\n\r\n    protected setPageStart(item: any): any {\r\n        this.pageStart = item === undefined ? 0 : item.seq;\r\n    }\r\n}\r\n*/\r\n/**\r\n *\r\n */\r\nexport class CProduct extends CUqBase {\r\n    //pageProducts: PageProducts;\r\n    productsPager: QueryPager<any>;\r\n\r\n    @observable futureDeliveryTimeDescriptionContainer: { [cacheId: string]: string } = {};\r\n    @observable chemicalInfoContainer: { [productId: number]: any } = {};\r\n\r\n    protected async internalStart(param: any) {\r\n        this.searchByKey(param);\r\n    }\r\n\r\n    searchByKey(key: string) {\r\n        let { currentSalesRegion } = this.cApp;\r\n        //this.pageProducts = new PageProducts(this.uqs.product.SearchProduct);\r\n        this.productsPager = new QueryPager<any>(this.uqs.product.SearchProduct, 10, 10);\r\n        //this.pageProducts.first({ keyWord: key, salesRegion: currentSalesRegion.id });\r\n        this.productsPager.first({ keyWord: key, salesRegion: currentSalesRegion.id })\r\n        this.openVPage(VProductList, key);\r\n    }\r\n\r\n    async searchByCategory(category: any) {\r\n        let { currentSalesRegion } = this.cApp;\r\n        //this.pageProducts = new PageProducts(this.uqs.product.SearchProductByCategory);\r\n        this.productsPager = new QueryPager<any>(this.uqs.product.SearchProductByCategory, 10, 10);\r\n        let { productCategoryId, name } = category;\r\n        //this.pageProducts.first({ productCategory: productCategoryId, salesRegion: currentSalesRegion.id });\r\n        await this.productsPager.first({ productCategory: productCategoryId, salesRegion: currentSalesRegion.id })\r\n        this.openVPage(VProductList, name);\r\n    }\r\n\r\n    /**\r\n     *\r\n     */\r\n    showProductDetail = async (productId: BoxId | any) => {\r\n\r\n        if (productId) {\r\n            let discount = 0, product = productId;\r\n            /*\r\n            product = await this.uqs.product.ProductX.load(productId);\r\n            let { currentUser } = this.cApp;\r\n            if (currentUser.hasCustomer) {\r\n                let discountSetting = await this.uqs.customerDiscount.GetDiscount.obj({ brand: product.brand.id, customer: currentUser.currentCustomer });\r\n                discount = discountSetting && discountSetting.discount;\r\n            }\r\n            */\r\n            let loader = new LoaderProductChemicalWithPrices(this.cApp);\r\n            let productData = await loader.load(productId);\r\n            this.openVPage(VProduct, { productData, product, discount });\r\n        }\r\n    }\r\n\r\n    renderProductPrice = (product: BoxId, discount: number) => {\r\n        return this.renderView(VProductPrice, { product: product, discount: discount });\r\n    }\r\n\r\n    renderProductWithPrice = (product: BoxId) => {\r\n        return this.renderView(VProductWithPrice, product);\r\n    }\r\n\r\n    getProductPrice = async (product: BoxId, salesRegionId: number, discount: number) => {\r\n        let { id: productId } = product;\r\n        let { currentSalesRegion, cart, currentLanguage, uqs } = this.cApp;\r\n\r\n        let prices = await uqs.product.PriceX.table({ product: product, salesRegion: salesRegionId });\r\n        let priceSet = prices.filter(e => e.discountinued === 0 && e.expireDate > Date.now()).sort((a, b) => a.retail - b.retail).map(element => {\r\n            let ret: any = {};\r\n            ret.pack = element.pack;\r\n            ret.retail = element.retail;\r\n            if (discount !== 0)\r\n                ret.vipPrice = Math.round(element.retail * (1 - discount));\r\n            ret.currency = currentSalesRegion.currency;\r\n            ret.quantity = cart.getQuantity(productId, element.pack.id)\r\n            return ret;\r\n        });\r\n        let promises: PromiseLike<any>[] = [];\r\n        priceSet.forEach(v => {\r\n            promises.push(uqs.promotion.GetPromotionPack.obj({ product: productId, pack: v.pack, salesRegion: currentSalesRegion, language: currentLanguage }));\r\n        })\r\n        let results = await Promise.all(promises);\r\n\r\n        for (let i = 0; i < priceSet.length; i++) {\r\n            let promotion = results[i];\r\n            let discount = promotion && promotion.discount;\r\n            if (discount)\r\n                priceSet[i].promotionPrice = Math.round((1 - discount) * priceSet[i].retail);\r\n        }\r\n        return priceSet;\r\n    }\r\n\r\n    renderDeliveryTime = (pack: BoxId) => {\r\n        return this.renderView(VProductDelivery, pack);\r\n    }\r\n\r\n    getInventoryAllocation = async (productId: number, packId: number, salesRegionId: number) => {\r\n        return await this.uqs.warehouse.GetInventoryAllocation.table({ product: productId, pack: packId, salesRegion: this.cApp.currentSalesRegion });\r\n    }\r\n\r\n    getFutureDeliveryTimeDescription = async (productId: number, salesRegionId: number) => {\r\n        let cacheId = productId + '_' + salesRegionId;\r\n        if (this.futureDeliveryTimeDescriptionContainer[cacheId] === undefined) {\r\n            let futureDeliveryTime = await this.uqs.product.GetFutureDeliveryTime.table({ product: productId, salesRegion: salesRegionId });\r\n            if (futureDeliveryTime.length > 0) {\r\n                let { minValue, maxValue, unit, deliveryTimeDescription } = futureDeliveryTime[0];\r\n                this.futureDeliveryTimeDescriptionContainer[cacheId] = minValue + (maxValue > minValue ? '~' + maxValue : '') + ' ' + unit;\r\n            } else {\r\n                this.futureDeliveryTimeDescriptionContainer[cacheId] = null;\r\n            }\r\n        }\r\n        return this.futureDeliveryTimeDescriptionContainer[cacheId];\r\n    }\r\n\r\n    renderChemicalInfoInCart = (product: BoxId) => {\r\n        return this.renderView(VChemicalInfoInCart, product);\r\n    }\r\n\r\n    getChemicalInfo = async (productId: number) => {\r\n        if (this.chemicalInfoContainer[productId] === undefined) {\r\n            this.chemicalInfoContainer[productId] = await this.uqs.product.ProductChemical.obj({ product: productId });\r\n        }\r\n    }\r\n\r\n    /**\r\n     *\r\n     */\r\n    renderProduct = (product: any) => {\r\n        return this.renderView(VProuductView, product);\r\n    }\r\n\r\n    getProductAndDiscount = async (productId: BoxId) => {\r\n        let product = await this.uqs.product.ProductX.load(productId);\r\n        let discount = 0;\r\n        let { currentUser } = this.cApp;\r\n        if (currentUser.hasCustomer) {\r\n            let discountSetting = await this.uqs.customerDiscount.GetDiscount.obj({ brand: product.brand.id, customer: currentUser.currentCustomer });\r\n            discount = discountSetting && discountSetting.discount;\r\n        }\r\n        return { product: product, discount: discount };\r\n    }\r\n\r\n    renderCartProduct = (product: BoxId) => {\r\n        return this.renderView(VCartProuductView, product);\r\n    }\r\n}","import AnalyticalChemistry from './images/AnalyticalChemistry.png';\r\nimport LabSupplies from './images/LabSupplies.png';\r\nimport LifeScience from './images/LifeScience.png';\r\nimport MaterialScience from './images/MaterialScience.png';\r\nimport OrganicChemistry from './images/OrganicChemistry.png';\r\nimport { env } from 'tonva';\r\n\r\n\r\n// 生产配置\r\nconst GLOABLE_PRODUCTION = {\r\n    CHINA: 44,\r\n    CHINESE: 196,\r\n    SALESREGION_CN: 1,\r\n    ROOTCATEGORY: {\r\n        47: {\r\n            src: OrganicChemistry,\r\n            labelColor: 'text-info',\r\n        },\r\n        470: {\r\n            src: AnalyticalChemistry,\r\n            labelColor: 'text-success',\r\n        },\r\n        1013: {\r\n            src: LifeScience,\r\n            labelColor: 'text-danger',\r\n        },\r\n        1219: {\r\n            src: MaterialScience,\r\n            labelColor: 'text-warning',\r\n        },\r\n        1545: {\r\n            src: LabSupplies,\r\n            labelColor: 'text-primary',\r\n        },\r\n    } as any,\r\n    TIPDISPLAYTIME: 3000,\r\n    ANDROIDAPPADDRESS: \"https://shop.jkchemical.com/download/jk-shop.apk\",\r\n    PIRVACYURL: \"https://shop.jkchemical.com/privacy/shop.txt\",\r\n    CONTENTSITE: \"https://web.jkchemical.com\",\r\n}\r\n\r\n// 测试环境配置\r\nconst GLOABLE_TEST = {\r\n    CHINA: 43,\r\n    CHINESE: 197,\r\n    SALESREGION_CN: 4,\r\n    ROOTCATEGORY: {\r\n        7: {\r\n            src: OrganicChemistry,\r\n            labelColor: 'text-info',\r\n        },\r\n        430: {\r\n            src: AnalyticalChemistry,\r\n            labelColor: 'text-success',\r\n        },\r\n        986: {\r\n            src: LifeScience,\r\n            labelColor: 'text-danger',\r\n        },\r\n        1214: {\r\n            src: MaterialScience,\r\n            labelColor: 'text-warning',\r\n        },\r\n        1545: {\r\n            src: LabSupplies,\r\n            labelColor: 'text-primary',\r\n        },\r\n    } as any,\r\n    TIPDISPLAYTIME: 3000,\r\n    ANDROIDAPPADDRESS: \"https://shop.jkchemical.com/download/jk-shop.apk\",\r\n    PIRVACYURL: \"https://c.jkchemical.com/privacy/shop.txt\",\r\n    CONTENTSITE: \"https://c.jkchemical.com/jk-web\",\r\n}\r\n\r\nexport const GLOABLE = env.testing === true ? GLOABLE_TEST : GLOABLE_PRODUCTION;\r\n//export { GLOABLE_PRODUCTION as GLOABLE };\r\n//export { GLOABLE_TEST as GLOABLE };","import * as React from 'react';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport { VPage, Page, tv, List, LMR, FA } from 'tonva';\r\nimport { COrder } from './COrder';\r\nimport { OrderItem } from './Order';\r\nimport { CartPackRow } from '../cart/Cart';\r\nimport classNames from 'classnames';\r\nimport { GLOABLE } from 'cartenv';\r\n\r\nexport class VCreateOrder extends VPage<COrder> {\r\n\r\n    @observable private useShippingAddress: boolean = true;\r\n    @observable private shippingAddressIsBlank: boolean = false;\r\n    @observable private invoiceAddressIsBlank: boolean = false;\r\n    @observable private invoiceIsBlank: boolean = false;\r\n\r\n    async open(param: any) {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private nullContact = () => {\r\n        return <span className=\"text-primary\">选择收货地址</span>;\r\n    }\r\n\r\n    private packsRow = (item: CartPackRow, index: number) => {\r\n        let { pack, quantity, retail, priceInit } = item;\r\n\r\n        return <div key={index} className=\"px-2 py-2 border-top\">\r\n            <div className=\"d-flex align-items-center\">\r\n                <div className=\"flex-grow-1\"><b>{tv(pack)}</b></div>\r\n                <div className=\"w-12c mr-4 text-right\">\r\n                    <span className=\"text-danger h5\"><small>¥</small>{parseFloat((priceInit * quantity).toFixed(2))}</span>\r\n                    <small className=\"text-muted\">(¥{parseFloat(priceInit.toFixed(2))} × {quantity})</small>\r\n                </div>\r\n            </div>\r\n            <div>{this.controller.renderDeliveryTime(pack)}</div>\r\n        </div>;\r\n    }\r\n\r\n    private renderOrderItem = (orderItem: OrderItem) => {\r\n        let { product, packs } = orderItem;\r\n        let { controller, packsRow } = this;\r\n        return <div>\r\n            <div className=\"row\">\r\n                <div className=\"col-lg-6 pb-3\">{controller.renderOrderItemProduct(product)}</div>\r\n                <div className=\"col-lg-6\">{\r\n                    packs.map((p, index) => {\r\n                        return packsRow(p, index);\r\n                    })\r\n                }</div>\r\n            </div>\r\n        </div>;\r\n    }\r\n\r\n    private orderItemKey = (orderItem: OrderItem) => {\r\n        return orderItem.product.id;\r\n    }\r\n\r\n    private renderCoupon = observer((param: any) => {\r\n        let { couponAppliedData, hasAnyCoupon } = this.controller;\r\n        if (couponAppliedData['id'] === undefined) {\r\n            let tip = hasAnyCoupon ? \"有可用优惠卡/券，点击使用\" : \"输入优惠券/积分码\";\r\n            return <span className=\"text-primary\">{tip}</span>;\r\n        } else {\r\n            let { code, types } = couponAppliedData;\r\n            let { couponOffsetAmount, couponRemitted, point } = param;\r\n            let offsetUI, remittedUI, noOffsetUI;\r\n            if (types === \"credits\") {\r\n                offsetUI = <div className=\"d-flex flex-row justify-content-between\">\r\n                    <div className=\"text-muted\">积分:</div>\r\n                    <div className=\"text-right text-danger\">{point}<small>分</small></div>\r\n                </div>\r\n            }\r\n            else if (couponOffsetAmount || couponRemitted) {\r\n                if (couponOffsetAmount) {\r\n                    offsetUI = <div className=\"d-flex flex-row justify-content-between\">\r\n                        <div className=\"text-muted\">折扣:</div>\r\n                        <div className=\"text-right text-danger\"><small>¥</small>{couponOffsetAmount.toFixed(2)}</div>\r\n                    </div>\r\n                }\r\n                if (couponRemitted) {\r\n                    remittedUI = <div className=\"d-flex flex-row justify-content-between\">\r\n                        <div className=\"text-muted\">抵扣:</div>\r\n                        <div className=\"text-right text-danger\"><small>¥</small>{couponRemitted.toFixed(2)}</div>\r\n                    </div>\r\n                }\r\n            } else {\r\n                noOffsetUI = <div>谢谢惠顾</div>;\r\n            }\r\n            return <div className=\"mr-2\">\r\n                <div className=\"text-success\">{code.substr(0, 4)} {code.substr(4)}</div>\r\n                {offsetUI}\r\n                {remittedUI}\r\n                {noOffsetUI}\r\n            </div>\r\n        }\r\n    });\r\n\r\n    private onBuyerAccountChanged = () => {\r\n\r\n    }\r\n\r\n    private renderBuyerAccount = (item: any) => {\r\n        let { buyerAccount } = item;\r\n        return <div>{tv(buyerAccount, (v) => {\r\n            let { id, description, organization } = v;\r\n            return <>{description}{tv(organization, (o) => {\r\n                return <>{o.name}</>\r\n            }, undefined, () => null)}</>\r\n        })}</div>\r\n    }\r\n\r\n    private renderBuyerAccounts = observer(() => {\r\n        let { buyerAccounts } = this.controller;\r\n        if (!buyerAccounts || buyerAccounts.length === 0) return null;\r\n        return <div className=\"row py-3 bg-white mb-1\">\r\n            <div className=\"col-4 col-sm-2 pb-2 text-muted\">订单账号:</div>\r\n            <div className=\"col-8 col-sm-10\">\r\n                <List items={buyerAccounts} item={{ render: this.renderBuyerAccount, onSelect: this.onBuyerAccountChanged }}></List>\r\n            </div>\r\n        </div>\r\n    })\r\n\r\n    private onSubmit = async () => {\r\n        let { orderData } = this.controller;\r\n        // 必填项验证\r\n        let { shippingContact, invoiceContact, invoiceType, invoiceInfo } = orderData;\r\n        if (!shippingContact) {\r\n            this.shippingAddressIsBlank = true;\r\n            setTimeout(() => this.shippingAddressIsBlank = false, GLOABLE.TIPDISPLAYTIME);\r\n            return;\r\n        }\r\n        if (!invoiceContact) {\r\n            if (this.useShippingAddress) {\r\n                orderData.invoiceContact = shippingContact; //contactBox;\r\n                this.invoiceAddressIsBlank = false;\r\n            } else {\r\n                this.invoiceAddressIsBlank = true;\r\n                setTimeout(() => this.invoiceAddressIsBlank = false, GLOABLE.TIPDISPLAYTIME);\r\n                return;\r\n            }\r\n        }\r\n        if (!invoiceType || !invoiceInfo) {\r\n            this.invoiceIsBlank = true;\r\n            setTimeout(() => this.invoiceIsBlank = false, GLOABLE.TIPDISPLAYTIME);\r\n            return;\r\n        }\r\n\r\n        this.controller.submitOrder();\r\n    }\r\n\r\n    private page = observer(() => {\r\n\r\n        let { cApp, orderData, onSelectShippingContact, onSelectInvoiceContact, onInvoiceInfoEdit, onCouponEdit } = this.controller;\r\n        let { currentUser } = cApp;\r\n        let footer = <div className=\"w-100 px-3 py-1\" style={{ backgroundColor: \"#f8f8f8\" }}>\r\n            <div className=\"d-flex justify-content-left\">\r\n                <div className=\"text-danger flex-grow-1\" style={{ fontSize: '1.8rem' }}><small>¥</small>{orderData.amount}</div>\r\n                <button type=\"button\"\r\n                    className={classNames('btn', 'w-30', { 'btn-danger': currentUser.allowOrdering, 'btn-secondary': !currentUser.allowOrdering })}\r\n                    onClick={this.onSubmit} disabled={!currentUser.allowOrdering}>提交订单\r\n                </button>\r\n            </div>\r\n        </div>;\r\n\r\n        let chevronRight = <FA name=\"chevron-right\" className=\"cursor-pointer\" />\r\n        let shippingAddressBlankTip = this.shippingAddressIsBlank ?\r\n            <div className=\"text-danger small my-2\"><FA name=\"exclamation-circle\" /> 必须填写收货地址</div>\r\n            : null;\r\n        let invoiceAddressBlankTip = this.invoiceAddressIsBlank ?\r\n            <div className=\"text-danger small my-2\"><FA name=\"exclamation-circle\" /> 必须填写发票地址</div> : null;\r\n\r\n        let divInvoiceContact: any = null;\r\n        if (this.useShippingAddress === false) {\r\n            if (orderData.invoiceContact !== undefined) {\r\n                divInvoiceContact = <div className=\"col-8 col-sm-10 offset-4 offset-sm-2 d-flex\">\r\n                    {tv(orderData.invoiceContact, undefined, undefined, this.nullContact)}\r\n                    <div>{chevronRight}</div>\r\n                </div>\r\n            } else {\r\n                divInvoiceContact = <div className=\"col-8 offset-4 offset-sm-2\">\r\n                    <button className=\"btn btn-outline-primary\"\r\n                        onClick={onSelectInvoiceContact}>选择发票地址</button>\r\n                    {invoiceAddressBlankTip}\r\n                </div>\r\n            }\r\n        }\r\n\r\n        let invoiceContactUI = <div className=\"row py-3 bg-white mb-1\">\r\n            <div className=\"col-4 col-sm-2 pb-2 text-muted\">发票地址:</div>\r\n            <div className=\"col-8 col-sm-10\">\r\n                <div>\r\n                    <label className=\"cursor-pointer\">\r\n                        <input type=\"checkbox\"\r\n                            defaultChecked={this.useShippingAddress}\r\n                            onChange={e => {\r\n                                this.useShippingAddress = e.currentTarget.checked;\r\n                                orderData.invoiceContact = undefined;\r\n                                this.invoiceAddressIsBlank = false;\r\n                            }} /> 同收货地址\r\n                    </label>\r\n                </div>\r\n            </div>\r\n            {divInvoiceContact}\r\n        </div>\r\n\r\n        let invoiceBlankTip = this.invoiceIsBlank ? <div className=\"text-danger small my-2\"><FA name=\"exclamation-circle\" /> 必须填写发票信息</div> : null;\r\n        let invoiceInfoUI = <div className=\"row py-3 bg-white mb-1\" onClick={onInvoiceInfoEdit}>\r\n            <div className=\"col-4 col-sm-2 pb-2 text-muted\">发票信息:</div>\r\n            <div className=\"col-8 col-sm-10\">\r\n                <LMR className=\"w-100 align-items-center\" right={chevronRight}>\r\n                    {tv(orderData.invoiceType, (v) => <>{v.description}</>, undefined, () => <span className=\"text-primary\">填写发票信息</span>)}\r\n                    {tv(orderData.invoiceInfo, (v) => <> -- {v.title}</>, undefined, () => <></>)}\r\n                    {invoiceBlankTip}\r\n                </LMR>\r\n            </div>\r\n        </div>\r\n\r\n        let freightFeeUI = <></>;\r\n        let freightFeeRemittedUI = <></>;\r\n        if (orderData.freightFee) {\r\n            freightFeeUI = <>\r\n                <div className=\"col-4 col-sm-2 pb-2 text-muted\">运费:</div>\r\n                <div className=\"col-8 col-sm-10 text-right text-danger\"><small>¥</small>{orderData.freightFee}</div>\r\n            </>\r\n            if (orderData.freightFeeRemitted) {\r\n                freightFeeRemittedUI = <>\r\n                    <div className=\"col-4 col-sm-2 pb-2 text-muted\">运费减免:</div>\r\n                    <div className=\"col-8 col-sm-10 text-right text-danger\"><small>¥</small>{orderData.freightFeeRemitted}</div>\r\n                </>\r\n            }\r\n        }\r\n\r\n        let couponUI = <div className=\"row py-3 bg-white mb-1\" onClick={onCouponEdit}>\r\n            <div className=\"col-4 col-sm-2 pb-2 text-muted\">优惠卡券:</div>\r\n            <div className=\"col-8 col-sm-10\">\r\n                <LMR className=\"w-100 align-items-center\" right={chevronRight}>\r\n                    {React.createElement(this.renderCoupon,\r\n                        {\r\n                            couponOffsetAmount: orderData.couponOffsetAmount,\r\n                            couponRemitted: orderData.couponRemitted,\r\n                            point: orderData.point\r\n                        })}\r\n                </LMR>\r\n            </div>\r\n        </div>\r\n\r\n        return <Page header=\"订单预览\" footer={footer}>\r\n            <div className=\"px-2\">\r\n                <div className=\"row py-3 bg-white mb-1\" onClick={onSelectShippingContact}>\r\n                    <div className=\"col-4 col-sm-2 pb-2 text-muted\">收货地址:</div>\r\n                    <div className=\"col-8 col-sm-10\">\r\n                        <LMR className=\"w-100 align-items-center\" right={chevronRight}>\r\n                            {tv(orderData.shippingContact, undefined, undefined, this.nullContact)}\r\n                        </LMR>\r\n                        {shippingAddressBlankTip}\r\n                    </div>\r\n                </div>\r\n                {invoiceContactUI}\r\n                {invoiceInfoUI}\r\n            </div>\r\n            <List items={orderData.orderItems} item={{ render: this.renderOrderItem, key: this.orderItemKey as any }} />\r\n            <div className=\"px-2\">\r\n                <div className=\"row py-3 pr-3 bg-white my-1\">\r\n                    <div className=\"col-4 col-sm-2 pb-2 text-muted\">商品总额:</div>\r\n                    <div className=\"col-8 col-sm-10 text-right\"><small>¥</small>{orderData.productAmount}</div>\r\n                    {freightFeeUI}\r\n                    {freightFeeRemittedUI}\r\n                </div >\r\n                {couponUI}\r\n            </div>\r\n        </Page>\r\n    })\r\n}","import { BoxId } from 'tonva';\r\nimport { observable, computed } from 'mobx';\r\nimport { CartPackRow } from 'cart/Cart';\r\n\r\nexport class Order {\r\n\r\n    webUser: any;\r\n    organization: BoxId;\r\n    customer: any;\r\n\r\n    @observable shippingContact: BoxId;\r\n    @observable invoiceContact: BoxId;\r\n    @observable invoiceType: BoxId;\r\n    @observable invoiceInfo: BoxId;\r\n    @observable orderItems: OrderItem[] = [];\r\n\r\n    @observable freightFee: number;\r\n    @observable freightFeeRemitted: number;\r\n\r\n    /*\r\n    @computed get amount() {\r\n        return parseFloat((this.orderItems.reduce((pv, cv) => (pv + cv.subAmount), 0) +\r\n            (this.freightFee ? this.freightFee : 0) +\r\n            (this.freightFeeRemitted ? this.freightFeeRemitted : 0) +\r\n            (this.couponOffsetAmount ? this.couponOffsetAmount : 0) +\r\n            (this.couponRemitted ? this.couponRemitted : 0)).toFixed(2));\r\n    };\r\n    */\r\n    @computed get amount() {\r\n        return parseFloat((this.orderItems.reduce((pv, cv) => (pv + cv.subAmount), 0) +\r\n            (this.freightFee ? this.freightFee : 0) +\r\n            (this.freightFeeRemitted ? this.freightFeeRemitted : 0)).toFixed(2));\r\n    };\r\n    // @computed get productAmount() {\r\n    //     return parseFloat(this.orderItems.reduce((pv, cv) => pv + cv.subAmount, 0).toFixed(2));\r\n    // };\r\n    /**\r\n     * 商品总额(未应用券的价格)\r\n     */\r\n    @computed get productAmount() {\r\n        return parseFloat(this.orderItems.reduce((pv, cv) => pv + cv.subListAmount, 0).toFixed(2));\r\n    };\r\n    currency: BoxId;\r\n    @observable coupon: BoxId;\r\n    @observable couponOffsetAmount: number;\r\n    @observable couponRemitted: number;\r\n    @observable point: number;\r\n    comments: string;\r\n    salesRegion: BoxId;\r\n\r\n    getDataForSave() {\r\n        let orderItems: any[] = [];\r\n        this.orderItems.forEach(oi => {\r\n            oi.packs.forEach(pk => {\r\n                this.currency = pk.currency;\r\n                orderItems.push({\r\n                    product: oi.product, pack: pk.pack, price: pk.price, quantity: pk.quantity\r\n                    , subAmount: pk.quantity * pk.price\r\n                })\r\n            })\r\n        });\r\n        return {\r\n            webUser: this.webUser,\r\n            organization: this.organization,\r\n            customer: this.customer,\r\n            shippingContact: this.shippingContact,\r\n            invoiceContact: this.invoiceContact,\r\n            invoiceType: this.invoiceType,\r\n            invoiceInfo: this.invoiceInfo,\r\n            amount: this.amount,\r\n            currency: this.currency,\r\n            freightFee: this.freightFee,\r\n            freightFeeRemitted: this.freightFeeRemitted,\r\n            coupon: this.coupon,\r\n            couponOffsetAmount: this.couponOffsetAmount,\r\n            couponRemitted: this.couponRemitted,\r\n            point: this.point,\r\n            comments: this.comments,\r\n            orderitems: orderItems, // 前面的必须是小写的orderitems\r\n            salesRegion: this.salesRegion,\r\n        }\r\n    }\r\n}\r\n\r\nexport class OrderItem {\r\n\r\n    product: BoxId;\r\n    @observable packs: CartPackRow[];\r\n    @computed get subAmount() {\r\n        return this.packs.reduce((p, c) => {\r\n            return p + c.price * c.quantity\r\n        }, 0);\r\n    }\r\n    @computed get subListAmount() {\r\n        return this.packs.reduce((p, c) => {\r\n            return p + c.priceInit * c.quantity\r\n        }, 0);\r\n    }\r\n}","import * as React from 'react';\r\nimport { VPage, Page, FA } from 'tonva';\r\nimport { COrder } from './COrder';\r\n\r\nexport class OrderSuccess extends VPage<COrder> {\r\n\r\n    async open(orderCreateResult: any) {\r\n\r\n        this.openPage(this.page, orderCreateResult);\r\n    }\r\n\r\n    private page = (orderCreateResult: any) => {\r\n        return <Page header=\"下单成功\" back=\"close\">\r\n            <div className=\"py-4 px-3 bg-white mb-3 d-flex\">\r\n                <FA name=\"list-alt\" className=\"text-success mr-3\" size=\"4x\" />\r\n                <div>\r\n                    <p className=\"text-primary\"><span className=\"h4\">下单成功！</span></p>\r\n                    <p className=\"\">\r\n                        订单: <span className=\"h5 text-info\">{orderCreateResult.no}</span><br /><br />\r\n                        <span className=\"text-muted\">我们会加紧处理，请注意查收短信。</span>\r\n                    </p>\r\n                </div>\r\n            </div>\r\n        </Page>\r\n    }\r\n}","import * as React from 'react';\r\nimport { VPage, Page } from 'tonva';\r\nimport { CSelectContact } from './CSelectContact';\r\nimport { List, LMR, FA } from 'tonva';\r\nimport { tv } from 'tonva';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VContactList extends VPage<CSelectContact> {\r\n\r\n    async open() {\r\n\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private onContactRender = (contact: any) => {\r\n        let { onEditContact, onContactSelected } = this.controller;\r\n        let right = <div className=\"p-2 cursor-pointer text-info\" onClick={() => onEditContact(contact)}>\r\n            <FA name=\"edit\" />\r\n        </div>\r\n        return <LMR right={right} className=\"px-3 py-2\">\r\n            <div onClick={() => onContactSelected(contact)}>\r\n                {tv(contact)}\r\n            </div>\r\n        </LMR>\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let { onNewContact, userContacts } = this.controller;\r\n        let footer = <button type=\"button\" className=\"btn btn-primary w-100\" onClick={() => onNewContact()} >添加新地址</button>;\r\n        let contactList = <List items={userContacts} item={{ render: this.onContactRender }} none=\"无地址\" />;\r\n        return <Page footer={footer} header=\"管理地址\">\r\n            {contactList}\r\n        </Page>\r\n    })\r\n}","\r\nexport function telephoneValidation(value: string) {\r\n    if (value && !/^(\\(\\d{3,4}\\)|\\d{3,4}-|\\s)?\\d{7,14}$/.test(value))\r\n        return \"固定电话格式不正确，请重新输入！\";\r\n    else\r\n        return undefined;\r\n}\r\n\r\nexport function mobileValidation(value: string) {\r\n    if (value && !/^[1][3,4,5,6,7,8,9][0-9]{9}$/.test(value))\r\n        return \"手机号格式不正确，请重新输入！\";\r\n    else\r\n        return undefined;\r\n}\r\n\r\nexport function emailValidation(value: string) {\r\n    if (value && !/\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*/.test(value))\r\n        return \"Email格式不正确，请重新输入！\";\r\n    else\r\n        return undefined;\r\n}\r\n\r\nexport function faxValidation(value: string) {\r\n    if (value && !/^(\\(\\d{3,4}\\)|\\d{3,4}-|\\s)?\\d{7,14}$/.test(value))\r\n        return \"传真号码格式不正确，请重新输入！\";\r\n    else\r\n        return undefined;\r\n}\r\n\r\nexport function addressDetailValidation(value: string) {\r\n    return (value && value.length > 200) ? \"详细地址最多200个字！\" : undefined;\r\n}\r\n\r\nexport function zipCodeValidation(value: string) {\r\n    return (value && value.length > 15) ? \"邮编过长，请修改后录入！\" : undefined;\r\n}\r\n\r\n\r\nexport function organizationNameValidation(value: string) {\r\n    return (value && value.length > 100) ? \"单位名称最多100个字！\" : undefined;\r\n}\r\n\r\nexport function departmentNameValidation(value: string) {\r\n    return (value && value.length > 100) ? \"部门名称名称最多100个字！\" : undefined;\r\n}\r\n\r\nexport function salutationValidation(value: string) {\r\n    return (value && value.length > 100) ? \"单位名称最多100个字！\" : undefined;\r\n}\r\n\r\nexport function nameValidation(value: string) {\r\n    return (value && value.length > 50) ? \"姓名最多50个字！\" : undefined;\r\n}","import * as React from 'react';\r\nimport _ from 'lodash';\r\nimport { VPage, Page, Form, Schema, UiSchema, Context, UiInputItem, UiIdItem, BoxId } from 'tonva';\r\nimport { tv } from 'tonva';\r\nimport { CSelectContact } from './CSelectContact';\r\nimport { addressDetailValidation, emailValidation, telephoneValidation, mobileValidation, organizationNameValidation, nameValidation } from 'tools/inputValidations';\r\n\r\nconst schema: Schema = [\r\n    { name: 'id', type: 'id', required: false },\r\n    { name: 'name', type: 'string', required: true },\r\n    { name: 'organizationName', type: 'string', required: true },\r\n    { name: 'mobile', type: 'string', required: true },\r\n    { name: 'telephone', type: 'string', required: false },\r\n    { name: 'email', type: 'string', required: false },\r\n    { name: 'address', type: 'id', required: true },\r\n    { name: 'addressString', type: 'string', required: true },\r\n    { name: 'isDefault', type: 'boolean', required: false },\r\n];\r\n\r\nexport class VContact extends VPage<CSelectContact> {\r\n\r\n    private userContactData: any;\r\n    private form: Form;\r\n\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            id: { visible: false },\r\n            name: { widget: 'text', label: '姓名', placeholder: '姓名', rules: nameValidation } as UiInputItem,\r\n            organizationName: { widget: 'text', label: '单位名称', placeholder: '单位名称', rules: organizationNameValidation } as UiInputItem,\r\n            mobile: { widget: 'text', label: '手机号', placeholder: '手机号', rules: mobileValidation } as UiInputItem, telephone: { widget: 'text', label: '电话', placeholder: '电话', rules: telephoneValidation } as UiInputItem,\r\n            email: { widget: 'email', label: 'Email', rules: emailValidation, placeholder: 'Email' } as UiInputItem,\r\n            address: {\r\n                widget: 'id', label: '所在地区', placeholder: '所在地区',\r\n                pickId: async (context: Context, name: string, value: number) => await this.controller.pickAddress(context, name, value),\r\n                Templet: (address: BoxId) => {\r\n                    return tv(address, (addressValue) => {\r\n                        let { country, province, city, county } = addressValue;\r\n                        /* 下面这种在使用tv之前的一堆判断应该是tv或者什么的有bug, 应该让Henry改改 */\r\n                        return <div className=\"text-truncate\">\r\n                            {country && country.id && tv(country, v => <>{v.chineseName}</>)}\r\n                            {province && province.id && tv(province, (v) => <>{v.chineseName}</>)}\r\n                            {city && city.id && tv(city, (v) => <>{v.chineseName}</>)}\r\n                            {county && county.id && tv(county, (v) => <>{v.chineseName}</>)}\r\n                        </div>;\r\n                    }, () => {\r\n                        return <small className=\"text-muted\">请选择地区</small>;\r\n                    })\r\n                }\r\n            } as UiIdItem,\r\n            addressString: { widget: 'text', label: '详细地址', placeholder: '详细地址', className: \"text-truncate\", rules: addressDetailValidation } as UiInputItem,\r\n            isDefault: { widget: 'checkbox', label: '作为默认地址' },\r\n            submit: { widget: 'button', label: '提交' },\r\n        }\r\n    }\r\n\r\n    async open(userContactData: any) {\r\n        this.userContactData = userContactData;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private onSaveContact = async () => {\r\n        if (!this.form) return;\r\n        await this.form.buttonClick(\"submit\");\r\n    }\r\n\r\n    private onFormButtonClick = async (name: string, context: Context) => {\r\n        await this.controller.saveContact(context.form.data);\r\n    }\r\n\r\n    private onDelContact = async () => {\r\n        let { contact } = this.userContactData;\r\n        if (await this.vCall(VConfirmDeleteContact, contact) === true) {\r\n            await this.controller.delContact(contact);\r\n            this.closePage();\r\n        };\r\n    }\r\n\r\n    private page = () => {\r\n        let contactData = _.clone(this.userContactData.contact);\r\n\r\n        let buttonDel: any;\r\n        if (contactData !== undefined) {\r\n            buttonDel = <button className=\"btn btn-sm btn-info\" onClick={this.onDelContact}>删除</button>;\r\n        } else {\r\n            let { defaultOrganizationName, defaultName, defaultMobile, address, addressString } = this.controller.cApp.currentUser;\r\n            contactData = {\r\n                'organizationName': defaultOrganizationName,\r\n                'name': defaultName,\r\n                'mobile': defaultMobile,\r\n                'address': address,\r\n                'addressString': addressString\r\n            };\r\n        }\r\n        let { fromOrderCreation } = this.controller;\r\n        let footer = <button type=\"button\"\r\n            className=\"btn btn-primary w-100\"\r\n            onClick={this.onSaveContact}>{fromOrderCreation ? '保存并使用' : '保存'}</button>;\r\n        return <Page header=\"地址信息\" footer={footer} right={buttonDel}>\r\n            <div className=\"App-container container text-left\">\r\n                <Form ref={v => this.form = v} className=\"my-3\"\r\n                    schema={schema}\r\n                    uiSchema={this.uiSchema}\r\n                    formData={contactData}\r\n                    onButtonClick={this.onFormButtonClick}\r\n                    fieldLabelSize={3} />\r\n            </div>\r\n        </Page>\r\n    }\r\n}\r\n\r\nclass VConfirmDeleteContact extends VPage<CSelectContact> {\r\n    async open(contact: any) {\r\n        this.openPage(this.page, contact);\r\n    }\r\n\r\n    private onConfirm = async () => {\r\n        await this.returnCall(true);\r\n        this.closePage();\r\n    }\r\n\r\n    private onCancel = async () => {\r\n        await this.returnCall(false);\r\n        this.closePage();\r\n    }\r\n\r\n    private page = (contact: any) => {\r\n        return <Page header=\"删除地址\" back=\"close\">\r\n            <div className=\"w-75 mx-auto border border-primary rounded my-3 p-3 bg-white\">\r\n                <div className=\"p-4 position-relative\">\r\n                    <i className=\"fa fa-question-circle position-absolute fa-2x text-warning\" style={{ left: 0, top: 0 }} />\r\n                    <b className=\"\">是否删除该地址？</b>\r\n                </div>\r\n                <div className=\"d-flex mt-3 justify-content-end\">\r\n                    <button className=\"btn btn-danger mr-3\" onClick={this.onConfirm}>删除地址</button>\r\n                    <button className=\"btn btn-outline-info mr-3\" onClick={this.onCancel}>取消</button>\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { VPage, Page, BoxId } from 'tonva';\r\nimport { tv } from 'tonva';\r\nimport { FA } from 'tonva';\r\nimport { CAddress } from './CAddress';\r\nimport { GLOABLE } from 'cartenv';\r\n\r\nexport class VAddress extends VPage<CAddress> {\r\n    private provinceId: number;\r\n    private cityId: number;\r\n    private countyId: number;\r\n    private backLevel = 0;\r\n\r\n    async open(param: any) {\r\n        let provinces = await this.controller.getCountryProvince(GLOABLE.CHINA);\r\n        this.openPage(this.page, { provinces: provinces });\r\n    }\r\n\r\n    private page = (param: any) => {\r\n        this.backLevel++;\r\n        return <Page header=\"选择所在省市\">\r\n            <div className=\"row no-gutters\">\r\n                {param.provinces.map((v: any) => this.renderPCC(v.province, this.onProvinceClick))}\r\n            </div>\r\n        </Page>\r\n    }\r\n\r\n    private renderPCC = (pcc: BoxId, onClick: any) => {\r\n        return <div key={pcc.id} className=\"col-6 col-md-4 col-lg-3 cursor-pointer\">\r\n            {tv(pcc, (value) => {\r\n                let { id, chineseName } = value;\r\n                return <>\r\n                    <div className=\"pt-1 pb-1 px-2\" onClick={() => onClick(id)}\r\n                        style={{ border: '1px solid #eeeeee', marginRight: '-1px', marginBottom: '-1px' }}\r\n                    >\r\n                        <span className=\"ml-1 align-middle\">\r\n                            <FA name=\"chevron-right\" className=\"text-info small\" />\r\n                            &nbsp; {chineseName}\r\n                        </span>\r\n                    </div>\r\n                </>;\r\n            })}\r\n        </div>\r\n    }\r\n\r\n    private onProvinceClick = async (provinceId: any) => {\r\n        this.provinceId = provinceId;\r\n        let cities = await this.controller.getProvinceCities(provinceId);\r\n        if (cities) {\r\n            let len = cities.length;\r\n            if (len === 1) {\r\n                await this.onCityClick(cities[0].city.id);\r\n                return;\r\n            }\r\n            if (len > 1) {\r\n                this.backLevel++;\r\n                this.openPageElement(<Page header=\"选择所在城市\">\r\n                    <div className=\"row no-gutters\">\r\n                        {cities.map(v => this.renderPCC(v.city, this.onCityClick))}\r\n                    </div>\r\n                </Page>);\r\n                return;\r\n            }\r\n        } else {\r\n            this.closePage(this.backLevel);\r\n            this.saveAddress();\r\n        }\r\n    }\r\n\r\n    private onCityClick = async (cityId: any) => {\r\n        this.cityId = cityId;\r\n        let counties = await this.controller.getCityCounties(cityId);\r\n        if (counties && counties.length > 0) {\r\n            this.backLevel++;\r\n            this.openPageElement(<Page header=\"选择所在区县\">\r\n                <div className=\"row no-gutters\">\r\n                    {counties.map(v => this.renderPCC(v.county, this.onCountyClick))}\r\n                </div>\r\n            </Page>);\r\n        } else {\r\n            this.closePage(this.backLevel);\r\n            this.saveAddress();\r\n        }\r\n    }\r\n\r\n    private onCountyClick = async (countyId: any) => {\r\n        this.countyId = countyId;\r\n        this.closePage(this.backLevel);\r\n        this.saveAddress();\r\n    }\r\n\r\n    private saveAddress = async () => {\r\n        await this.controller.saveAddress(GLOABLE.CHINA, this.provinceId, this.cityId, this.countyId);\r\n    }\r\n}\r\n","import { VAddress } from './VAddress';\r\nimport { CUqBase } from '../CBase';\r\n\r\nexport class CAddress extends CUqBase {\r\n    protected async internalStart() {\r\n        this.openVPage(VAddress);\r\n    }\r\n\r\n    getCountryProvince = async (countryId: number): Promise<any[]> => {\r\n        return await this.uqs.common.GetCountryProvinces.table({ country: countryId });\r\n    }\r\n\r\n    getProvinceCities = async (provinceId: number): Promise<any[]> => {\r\n        return await this.uqs.common.GetProvinceCities.table({ province: provinceId });\r\n    }\r\n\r\n    getCityCounties = async (cityId: number): Promise<any[]> => {\r\n        return await this.uqs.common.GetCityCounties.table({ city: cityId });\r\n    }\r\n\r\n    saveAddress = async (countryId: number, provinceId: number, cityId?: number, countyId?: number): Promise<any> => {\r\n        let { Address } = this.uqs.common;\r\n        let newAddress = await Address.save(undefined, { country: countryId, province: provinceId, city: cityId, county: countyId });\r\n        let addressId = newAddress && Address.boxId(newAddress.id);\r\n        this.returnCall(addressId);\r\n    }\r\n}\r\n","import { observable } from 'mobx';\r\nimport { Context, BoxId } from 'tonva';\r\nimport { CUqBase } from '../CBase';\r\nimport { VContactList } from './VContactList';\r\nimport { VContact } from './VContact';\r\nimport { CAddress } from './CAddress';\r\n\r\nexport abstract class CSelectContact extends CUqBase {\r\n    fromOrderCreation: boolean;\r\n\r\n    @observable userContacts: BoxId[] = [];\r\n\r\n    async internalStart(fromOrderCreation: boolean/*contactType: ContactType*/) {\r\n        this.fromOrderCreation = fromOrderCreation;\r\n        let userContactMaps = await this.cApp.currentUser.getContacts();\r\n        this.userContacts = userContactMaps.map((v: any) => v.contact);\r\n        this.openVPage(VContactList);\r\n        if (this.fromOrderCreation && (!this.userContacts || this.userContacts.length === 0)) {\r\n            this.onNewContact();\r\n        }\r\n    }\r\n\r\n    protected abstract async getIsDefault(userSetting: any, userContactId: number): Promise<boolean>;\r\n\r\n    /**\r\n     * 打开地址新建界面\r\n     */\r\n    onNewContact = async () => {\r\n        this.openVPage(VContact, { contact: undefined });\r\n    }\r\n\r\n    /**\r\n     * 打开地址编辑界面\r\n     */\r\n    onEditContact = async (userContact: BoxId) => {\r\n        let userContactId = userContact.id;\r\n        let contact = await this.uqs.customer.Contact.load(userContactId);\r\n        let userSetting = await this.cApp.currentUser.getSetting();\r\n        contact.isDefault = await this.getIsDefault(userSetting, userContactId);\r\n        let userContactData: any = { contact: contact };\r\n        this.openVPage(VContact, userContactData);\r\n    }\r\n\r\n    delContact = async (contact: any) => {\r\n        let { id } = contact;\r\n        let { currentUser } = this.cApp;\r\n        await currentUser.delContact(id);\r\n        if (contact.isDefault) {\r\n            this.setDefaultContact(undefined);\r\n        }\r\n        let index = this.userContacts.findIndex(v => v.id === id);\r\n        if (index > -1)\r\n            this.userContacts.splice(index, 1);\r\n    }\r\n\r\n    saveContact = async (contact: any) => {\r\n        let { Contact: contactTuid } = this.uqs.customer;\r\n        let newContact = await contactTuid.save(undefined, contact);\r\n        let { id: newContactId } = newContact;\r\n        let contactBox = contactTuid.boxId(newContactId);\r\n\r\n        let { currentUser } = this.cApp;\r\n        await currentUser.addContact(newContactId);\r\n        this.userContacts.push(contactBox);\r\n        let { id, isDefault } = contact;\r\n        if (isDefault === true || this.userContacts.length === 1) {\r\n            await this.setDefaultContact(contactBox);\r\n        }\r\n        // contact.id !== undefined表示是修改了已有的contact(我们只能用“替换”表示“修改”，所以此时需要删除原contact)\r\n        if (id !== undefined) {\r\n            await currentUser.delContact(id);\r\n            let index = this.userContacts.findIndex(v => v.id === id);\r\n            if (index > -1)\r\n                this.userContacts.splice(index, 1);\r\n        }\r\n        this.backPage();\r\n        if (this.fromOrderCreation) {\r\n            this.onContactSelected(contactBox);\r\n        }\r\n    }\r\n\r\n    protected abstract async setDefaultContact(contactId: BoxId): Promise<any>;\r\n\r\n    onContactSelected = (contact: BoxId) => {\r\n        if (this.fromOrderCreation) {\r\n            this.backPage();\r\n            this.returnCall(contact);\r\n        }\r\n    }\r\n\r\n    pickAddress = async (context: Context, name: string, value: number): Promise<number> => {\r\n        let cAddress = this.newC(CAddress); // new CAddress(this.cApp, undefined);\r\n        return await cAddress.call<number>();\r\n    }\r\n}\r\n\r\nexport class CSelectShippingContact extends CSelectContact {\r\n    protected async getIsDefault(userSetting: any, userContactId: number): Promise<boolean> {\r\n        if (userSetting !== undefined) {\r\n            let { shippingContact } = userSetting;\r\n            return shippingContact && shippingContact.id === userContactId;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    protected async setDefaultContact(contactId: BoxId) {\r\n        let { currentUser } = this.cApp;\r\n        await currentUser.setDefaultShippingContact(contactId);\r\n    }\r\n}\r\n\r\nexport class CSelectInvoiceContact extends CSelectContact {\r\n    protected async getIsDefault(userSetting: any, userContactId: number): Promise<boolean> {\r\n        if (userSetting !== undefined) {\r\n            let { invoiceContact } = userSetting;\r\n            return invoiceContact && invoiceContact.id === userContactId;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    protected async setDefaultContact(contactId: BoxId) {\r\n        let { currentUser } = this.cApp;\r\n        await currentUser.setDefaultInvoiceContact(contactId);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { VPage, Page, Tabs, TabCaptionComponent, TabsProps, TabProp } from 'tonva';\r\nimport { COrder } from './COrder';\r\nimport { List, EasyDate } from 'tonva';\r\nimport { observable } from 'mobx';\r\n\r\nconst color = (selected: boolean) => selected === true ? 'text-primary' : 'text-muted';\r\n\r\nexport class VMyOrders extends VPage<COrder> {\r\n\r\n\t/*\r\n    @observable private pendingOrders: any[];\r\n    @observable private processingOrders: any[];\r\n    @observable private completedOrders: any[];\r\n\t@observable private allOrders: any[];\r\n\t*/\r\n\t@observable private list: any[];\r\n\tprivate currentState: string;\r\n\tprivate tabs: TabProp[];\r\n\r\n\t/*\r\n    async open(param: any) {\r\n        this.currentState = param;\r\n        this.openPage(this.page);\r\n\t}\r\n\t*/\r\n\r\n\tinit(param: any) {\r\n\t\tthis.currentState = param;\r\n\t\tlet { getMyOrders } = this.controller;\r\n\t\tlet oss = [\r\n\t\t\t{ caption: '待审核', state: 'processing', icon: 'desktop' },\r\n\t\t\t{ caption: '待发货', state: 'completed', icon: 'truck' },\r\n\t\t\t{ caption: '所有订单', state: 'all', icon: 'file-text-o' },\r\n\t\t];\r\n\t\tthis.tabs = oss.map(v => {\r\n\t\t\tlet { caption, state, icon } = v;\r\n\t\t\treturn {\r\n\t\t\t\tname: caption,\r\n\t\t\t\tcaption: (selected: boolean) => TabCaptionComponent(caption, icon, color(selected)),\r\n\t\t\t\tcontent: () => {\r\n\t\t\t\t\treturn <List items={this.list} item={{ render: this.renderOrder }} none=\"[无]\" />\r\n\t\t\t\t},\r\n\t\t\t\tisSelected: this.currentState === state,\r\n\t\t\t\tload: async () => {\r\n\t\t\t\t\tthis.currentState = state;\r\n\t\t\t\t\tthis.list = await getMyOrders(this.currentState);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t});\r\n\t}\r\n\r\n\tprivate renderOrder = (order: any, index: number) => {\r\n\t\tlet { openOrderDetail } = this.controller;\r\n\t\tlet { id, no, date, discription, flow } = order;\r\n\t\treturn <div className=\"m-3 justify-content-between cursor-pointer\" onClick={() => openOrderDetail(id)}>\r\n\t\t\t<div><span className=\"small text-muted\">订单: </span><strong>{no}</strong></div>\r\n\t\t\t<div className=\"small text-muted\"><EasyDate date={date} /></div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\theader() {\r\n\t\treturn '我的订单';\r\n\t}\r\n\r\n\tcontent(): JSX.Element {\r\n\t\treturn <Tabs tabs={this.tabs} tabPosition=\"top\" />;\r\n\t}\r\n\r\n\tprivate page = () => {\r\n\r\n\t\tlet { getMyOrders } = this.controller;\r\n\t\tlet oss = [\r\n\t\t\t{ caption: '待审核', state: 'processing', icon: 'desktop' },\r\n\t\t\t{ caption: '待发货', state: 'completed', icon: 'truck' },\r\n\t\t\t{ caption: '所有订单', state: 'all', icon: 'file-text-o' },\r\n\t\t];\r\n\t\tlet tabs = oss.map(v => {\r\n\t\t\tlet { caption, state, icon } = v;\r\n\t\t\treturn {\r\n\t\t\t\tname: caption,\r\n\t\t\t\tcaption: (selected: boolean) => TabCaptionComponent(caption, icon, color(selected)),\r\n\t\t\t\tcontent: () => {\r\n\t\t\t\t\treturn <List items={this.list} item={{ render: this.renderOrder }} none=\"[无]\" />\r\n\t\t\t\t},\r\n\t\t\t\tisSelected: this.currentState === state,\r\n\t\t\t\tload: async () => {\r\n\t\t\t\t\tthis.currentState = state;\r\n\t\t\t\t\tthis.list = await getMyOrders(this.currentState);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t});\r\n\t\t/*\r\n        let tabs = [{\r\n            name: '待审核',\r\n            caption: (selected: boolean) => TabCaptionComponent(\"待审核\", \"desktop\", color(selected)),\r\n            content: () => {\r\n                return <List items={this.processingOrders} item={{ render: this.renderOrder }} none=\"无待审核订单\" />\r\n            },\r\n            isSelected: this.currentState === 'processing',\r\n            load: async () => {\r\n                this.currentState = 'processing';\r\n                this.processingOrders = await getMyOrders(this.currentState);\r\n            }\r\n        }, {\r\n            name: '待发货',\r\n            caption: (selected: boolean) => TabCaptionComponent(\"待发货\", \"truck\", color(selected)),\r\n            content: () => {\r\n                return <List items={this.completedOrders} item={{ render: this.renderOrder }} none=\"还没有已完成的订单\" />\r\n            },\r\n            isSelected: this.currentState === 'completed',\r\n            load: async () => {\r\n                this.currentState = 'completed';\r\n                this.completedOrders = await getMyOrders(this.currentState);\r\n            }\r\n        }, {\r\n            name: '所有订单',\r\n            caption: (selected: boolean) => TabCaptionComponent(\"所有订单\", \"file-text-o\", color(selected)),\r\n            content: () => {\r\n                return <List items={this.allOrders} item={{ render: this.renderOrder }} none=\"还没有订单\" />\r\n            },\r\n            isSelected: this.currentState === 'all',\r\n            load: async () => {\r\n                this.currentState = 'all';\r\n                this.allOrders = await getMyOrders(this.currentState);\r\n            }\r\n\t\t}];\r\n\t\t*/\r\n\t\t// return <Page header=\"我的订单\" tabs={tabs} tabPosition=\"top\" />\r\n\t\t//return <Tabs tabs={tabs} tabPosition='top' />\r\n\t\treturn <Page header=\"我的订单\">\r\n\t\t\t<Tabs tabs={tabs} tabPosition=\"top\" />\r\n\t\t</Page>\r\n\t}\r\n}","import * as React from 'react';\r\nimport { VPage, Page, BoxId, EasyDate } from 'tonva';\r\nimport { COrder } from './COrder';\r\nimport { tv } from 'tonva';\r\nimport { List } from 'tonva';\r\nimport { OrderItem } from './Order';\r\n\r\nexport class VOrderDetail extends VPage<COrder> {\r\n\r\n    async open(order: any) {\r\n\r\n        this.openPage(this.page, order);\r\n    }\r\n\r\n\r\n    private packsRow = (item: any, index: number) => {\r\n        let { pack, quantity, price, currency } = item;\r\n\r\n        return <div key={index} className=\"px-2 py-2 border-top\">\r\n            <div className=\"d-flex align-items-center\">\r\n                <div className=\"flex-grow-1\"><b>{tv(pack)}</b></div>\r\n                <div className=\"w-12c mr-4 text-right\">\r\n                    <span className=\"text-danger h5\"><small>¥</small>{parseFloat((price * quantity).toFixed(2))}</span>\r\n                    <small className=\"text-muted\">(¥{parseFloat(price.toFixed(2))} × {quantity})</small>\r\n                </div>\r\n            </div>\r\n        </div>;\r\n    }\r\n\r\n    private renderOrderItem = (orderItem: OrderItem) => {\r\n        let { product, packs } = orderItem;\r\n        let { controller, packsRow } = this;\r\n        return <div>\r\n            <div className=\"row p-1 my-1\">\r\n                <div className=\"col-lg-6 pb-3\">{controller.renderOrderItemProduct(product)}</div>\r\n                <div className=\"col-lg-6\">{\r\n                    packs.map((p, index) => {\r\n                        return packsRow(p, index);\r\n                    })\r\n                }</div>\r\n            </div>\r\n        </div>;\r\n    }\r\n\r\n    private page = (order: any) => {\r\n\r\n        let { brief, data } = order;\r\n        let { id, no, state, description, date } = brief;\r\n        let { orderItems, currency, shippingContact, invoiceContact, invoiceType, invoiceInfo, amount, couponOffsetAmount, couponRemitted\r\n            , freightFee, freightFeeRemitted } = data;\r\n        let couponUI;\r\n        if (couponOffsetAmount || couponRemitted) {\r\n            let offsetUI, remittedUI;\r\n            if (couponOffsetAmount) {\r\n                offsetUI = <div className=\"d-flex flex-row justify-content-between\">\r\n                    <div className=\"text-muted\">折扣:</div>\r\n                    <div className=\"text-right text-danger\"><small>¥</small>{couponOffsetAmount}</div>\r\n                </div>\r\n            }\r\n            if (couponRemitted) {\r\n                remittedUI = <div className=\"d-flex flex-row justify-content-between\">\r\n                    <div className=\"text-muted\">抵扣:</div>\r\n                    <div className=\"text-right text-danger\"><small>¥</small>{couponRemitted}</div>\r\n                </div>\r\n            }\r\n            couponUI = <div className=\"bg-white row no-gutters p-3 my-1\">\r\n                <div className=\"col-3 text-muted\">优惠券:</div>\r\n                <div className=\"col-9\">\r\n                    {offsetUI}\r\n                    {remittedUI}\r\n                </div>\r\n            </div>\r\n        }\r\n\r\n        let freightFeeUI, freightFeeRemittedUI;\r\n        if (freightFee) {\r\n            freightFeeUI = <>\r\n                <div className=\"text-right text-danger\"><small>¥</small>{freightFee}</div>\r\n            </>\r\n            if (freightFeeRemitted) {\r\n                freightFeeRemittedUI = <>\r\n                    <div className=\"text-right text-danger\"><small>¥</small>{freightFeeRemitted}(减免)</div>\r\n                </>\r\n            }\r\n        }\r\n\r\n        let header = <>订单详情: {no}</>\r\n        return <Page header={header}>\r\n            <List items={orderItems} item={{ render: this.renderOrderItem }} />\r\n            <div className=\"bg-white row no-gutters p-3 my-1\">\r\n                <div className=\"col-3 text-muted\">收货地址:</div>\r\n                <div className=\"col-9\">{tv(shippingContact)}</div>\r\n            </div>\r\n            <div className=\"bg-white row no-gutters p-3 my-1\">\r\n                <div className=\"col-3 text-muted\">发票地址:</div>\r\n                <div className=\"col-9\">{tv(invoiceContact)}</div>\r\n            </div>\r\n            <div className=\"bg-white row no-gutters p-3 my-1\">\r\n                <div className=\"col-3 text-muted\">发票信息:</div>\r\n                <div className=\"col-9\">{invoiceTemplate(invoiceType, invoiceInfo)}</div>\r\n            </div>\r\n            <div className=\"bg-white row no-gutters p-3 my-1\">\r\n                <div className=\"col-3 text-muted\">运费:</div>\r\n                <div className=\"col-9\">{freightFeeUI}{freightFeeRemittedUI}</div>\r\n            </div>\r\n            {couponUI}\r\n            <div className=\"bg-white row no-gutters p-3 my-1\">\r\n                <div className=\"col-3 text-muted\">下单时间:</div>\r\n                <div className=\"col-9 text-right\"><EasyDate date={date} /></div>\r\n            </div>\r\n            <div className=\"bg-white p-3 my-1 text-right\">\r\n                <span className=\"text-danger font-weight-bold\">总金额: {amount}{tv(currency)}</span>\r\n            </div>\r\n        </Page>\r\n    }\r\n}\r\n\r\nfunction invoiceTemplate(invoiceType: BoxId, invoiceInfo: BoxId): JSX.Element {\r\n    return <>\r\n        {tv(invoiceType, invoiceTypeUI, undefined, () => <></>)}<br />\r\n        {tv(invoiceInfo, invoiceInfoUI, undefined, () => <></>)}\r\n    </>\r\n}\r\n\r\nfunction invoiceTypeUI(values: any) {\r\n    let { id, description } = values;\r\n    return <>{description}</>;\r\n}\r\n\r\nfunction invoiceInfoUI(values: any) {\r\n    let { id, title, taxNo, address, telephone, bank, accountNo } = values;\r\n    return <>{title}</>;\r\n}","import * as React from 'react';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport { VPage, Page, UiSchema, UiInputItem, Form, Context, tv, BoxId, FA } from 'tonva';\r\nimport { Schema } from 'tonva';\r\nimport { CInvoiceInfo } from './CInvoiceInfo';\r\n\r\nconst schema: Schema = [\r\n    { name: 'id', type: 'id', required: false },\r\n    { name: 'title', type: 'string', required: false },\r\n    { name: 'taxNo', type: 'string', required: false },\r\n    { name: 'address', type: 'id', required: false },\r\n    { name: 'telephone', type: 'string', required: false },\r\n    { name: 'bank', type: 'string', required: false },\r\n    { name: 'accountNo', type: 'string', required: false },\r\n];\r\n\r\nconst uiSchema: UiSchema = {\r\n    items: {\r\n        id: { visible: false },\r\n        title: {\r\n            widget: 'text', label: '单位全称', placeholder: '必填',\r\n            rules: (value: string) => {\r\n                return (value && value.length > 200) ? '单位全称最多200个字！' : undefined;\r\n            }\r\n        } as UiInputItem,\r\n        taxNo: {\r\n            widget: 'text', label: '纳税人识别码', placeholder: '必填',\r\n            rules: (value: string) => {\r\n                if (value) {\r\n                    var regArr = [/^[\\da-z]{10,15}$/i, /^\\d{6}[\\da-z]{10,12}$/i, /^[a-z]\\d{6}[\\da-z]{9,11}$/i, /^[a-z]{2}\\d{6}[\\da-z]{8,10}$/i, /^\\d{14}[\\dx][\\da-z]{4,5}$/i, /^\\d{17}[\\dx][\\da-z]{1,2}$/i, /^[a-z]\\d{14}[\\dx][\\da-z]{3,4}$/i, /^[a-z]\\d{17}[\\dx][\\da-z]{0,1}$/i, /^[\\d]{6}[\\da-z]{13,14}$/i],\r\n                        j = regArr.length;\r\n                    for (var i = 0; i < j; i++) {\r\n                        if (regArr[i].test(value)) {\r\n                            return undefined;\r\n                        }\r\n                    }\r\n                    return '纳税人识别码格式不正确，请重新输入！';\r\n                }\r\n            }\r\n        } as UiInputItem,\r\n        address: {\r\n            widget: 'text', label: '注册地址', placeholder: '必填',\r\n            rules: (value: string) => {\r\n                return (value && value.length > 200) ? '注册地址最多200个字！' : undefined;\r\n            }\r\n        } as UiInputItem,\r\n        telephone: {\r\n            widget: 'text', label: '注册电话', placeholder: '必填',\r\n            rules: (value: string) => {\r\n                if (value && !/^(\\(\\d{3,4}\\)|\\d{3,4}-|\\s)?\\d{7,14}$/.test(value))\r\n                    return \"注册电话格式不正确，请重新输入！\";\r\n                else\r\n                    return undefined;\r\n            }\r\n        } as UiInputItem,\r\n        bank: {\r\n            widget: 'text', label: '开户银行', placeholder: '必填',\r\n            rules: (value: string) => {\r\n                return (value && value.length > 100) ? '开户银行名称最多100个字！' : undefined;\r\n            }\r\n        } as UiInputItem,\r\n        accountNo: {\r\n            widget: 'text', label: '银行账号', placeholder: '必填',\r\n            rules: (value: string) => {\r\n                if (value && !/^([1-9]{1})(\\d{14}|\\d{18}|\\d{15})$/.test(value))\r\n                    return \"银行账号格式不正确，请重新输入！\";\r\n                else\r\n                    return undefined;\r\n            }\r\n        } as UiInputItem,\r\n        submit: { widget: 'button', label: '提交' },\r\n    }\r\n}\r\n\r\nconst commonRequired = {\r\n    id: false,\r\n    title: true,\r\n    taxNo: false,\r\n    address: false,\r\n    telephone: false,\r\n    bank: false,\r\n    accountNo: false,\r\n    isDefault: false,\r\n};\r\n\r\nconst valueAddedRequired = {\r\n    id: false,\r\n    title: true,\r\n    taxNo: true,\r\n    address: true,\r\n    telephone: true,\r\n    bank: true,\r\n    accountNo: true,\r\n    isDefault: false,\r\n}\r\n\r\nconst commonVisible = {\r\n    id: false,\r\n    title: true,\r\n    taxNo: false,\r\n    address: false,\r\n    telephone: false,\r\n    bank: false,\r\n    accountNo: false,\r\n    isDefault: true,\r\n};\r\n\r\nconst valueAddedVisible = {\r\n    id: false,\r\n    title: true,\r\n    taxNo: true,\r\n    address: true,\r\n    telephone: true,\r\n    bank: true,\r\n    accountNo: true,\r\n    isDefault: true,\r\n}\r\n\r\nexport class VInvoiceInfo extends VPage<CInvoiceInfo> {\r\n    private form: Form;\r\n    @observable showTip: boolean = false;\r\n    saveTip: string = \"\";\r\n    private invoiceInfoData: any;\r\n\r\n    async open(origInvoice?: any) {\r\n        let { invoiceType, invoiceInfo } = origInvoice;\r\n        this.invoiceType = (invoiceType && invoiceType.id) || 1;\r\n        if (invoiceInfo) {\r\n            invoiceInfo.assure();\r\n            this.invoiceInfoData = { ...invoiceInfo.obj };\r\n        } else {\r\n            this.invoiceInfoData = { 'title': this.controller.cApp.currentUser.defaultOrganizationName };\r\n        }\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private onFormButtonClick = async (name: string, context: Context) => {\r\n        let { form } = context;\r\n        let { data } = form;\r\n        let invoice = {\r\n            invoiceType: this.invoiceType,\r\n            invoiceInfo: data,\r\n        };\r\n        this.invoiceInfoData = data;\r\n\r\n        try {\r\n            await this.controller.saveInvoiceInfo(invoice);\r\n            this.saveTip = \"发票信息已经保存\";\r\n        } catch (error) {\r\n            this.saveTip = \"发票信息保存失败，请稍后再试\";\r\n        }\r\n        this.showTip = true;\r\n        setTimeout(() => { this.showTip = false; }, 2000);\r\n    }\r\n\r\n    private onSaveInvoice = async () => {\r\n        if (!this.form) return;\r\n        await this.form.buttonClick(\"submit\");\r\n    }\r\n\r\n    @observable invoiceType: number;\r\n\r\n    private buildForm(): JSX.Element {\r\n        let requiredFields: any = this.invoiceType === 1 ? commonRequired : valueAddedRequired;\r\n        let visibleFields: any = this.invoiceType === 1 ? commonVisible : valueAddedVisible;\r\n        schema.forEach(e => {\r\n            let { items } = uiSchema;\r\n            e.required = requiredFields[e.name];\r\n            items[e.name].visible = visibleFields[e.name];\r\n        });\r\n        return <Form ref={v => this.form = v} className=\"my-3\"\r\n            schema={schema}\r\n            uiSchema={uiSchema}\r\n            formData={this.invoiceInfoData}\r\n            onButtonClick={this.onFormButtonClick}\r\n            fieldLabelSize={3} />\r\n    }\r\n\r\n    private onInvoiceTypeClick = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.invoiceType = parseInt(event.currentTarget.value);\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let frm = this.buildForm();\r\n\r\n        let tipUI = this.showTip ? (<div className=\"alert alert-primary\" role=\"alert\">\r\n            <FA name=\"exclamation-circle\" className=\"text-warning float-left mr-3\" size=\"2x\"></FA>\r\n            {this.saveTip}\r\n        </div>) : null;\r\n        return <Page header=\"发票\">\r\n            <div className=\"px-3\">\r\n                <div className=\"form-group row py-3 mb-1 bg-white\">\r\n                    <div className=\"col-12 col-sm-3 pb-2 text-muted\">发票类型:</div>\r\n                    <div className=\"col-12 col-sm-9\">\r\n                        <div className=\"form-check form-check-inline\">\r\n                            <input className=\"form-check-input\" type=\"radio\" name=\"invoiceType\" id=\"common\" value=\"1\"\r\n                                onChange={(event) => this.onInvoiceTypeClick(event)} checked={this.invoiceType === 1}></input>\r\n                            <label className=\"form-check-label\" htmlFor=\"common\">增值税普通发票</label>\r\n                        </div>\r\n                        <div className=\"form-check form-check-inline\">\r\n                            <input className=\"form-check-input\" type=\"radio\" name=\"invoiceType\" id=\"valueAdded\" value=\"2\"\r\n                                onChange={(event) => this.onInvoiceTypeClick(event)} checked={this.invoiceType === 2}></input>\r\n                            <label className=\"form-check-label\" htmlFor=\"valueAdded\">增值税专用发票</label>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div className=\"p-3 bg-white\">\r\n                {frm}\r\n                <button type=\"button\"\r\n                    className=\"btn btn-primary w-100\"\r\n                    onClick={this.onSaveInvoice}>确定</button>\r\n                {tipUI}\r\n            </div>\r\n        </Page>\r\n    });\r\n}","//import { Controller } from 'tonva';\r\nimport { CUqBase } from '../CBase';\r\nimport { VInvoiceInfo } from './VInvoiceInfo';\r\n//import { CCartApp } from 'CCartApp';\r\n//import { Tuid } from 'tonva';\r\n\r\nexport class CInvoiceInfo extends CUqBase {\r\n    fromOrderCreation: boolean;\r\n\r\n    async internalStart(origInvoice: any, fromOrderCreation: boolean) {\r\n        this.fromOrderCreation = fromOrderCreation;\r\n        this.openVPage(VInvoiceInfo, origInvoice);\r\n    }\r\n\r\n    async saveInvoiceInfo(invoice: any) {\r\n        let { invoiceType, invoiceInfo, isDefault } = invoice;\r\n        let newInvoiceInfo = await this.uqs.customer.InvoiceInfo.save(undefined, invoiceInfo);\r\n\r\n        let { id: newInvoiceInfoId } = newInvoiceInfo;\r\n        let invoiceBox = {\r\n            invoiceType: this.uqs.common.InvoiceType.boxId(invoiceType),\r\n            invoiceInfo: this.uqs.customer.InvoiceInfo.boxId(newInvoiceInfoId),\r\n        }\r\n        // if (isDefault === true || !this.fromOrderCreation) {\r\n        let { currentUser } = this.cApp;\r\n        await currentUser.setDefaultInvoice(invoiceBox.invoiceType, invoiceBox.invoiceInfo);\r\n        // }\r\n        if (this.fromOrderCreation) {\r\n            this.backPage();\r\n            this.returnCall(invoiceBox);\r\n        }\r\n    }\r\n}","import { UQs } from '../uqs';\r\nimport { Tuid, BoxId } from 'tonva';\r\nimport { Order } from 'order/Order';\r\n\r\nexport class CouponBase {\r\n\r\n    constructor(protected id: BoxId, private code: number, expiredDate: Date, private isValid: boolean) {\r\n        this.expiredDate = new Date(expiredDate);\r\n    }\r\n\r\n    protected expiredDate: Date;\r\n\r\n    getCodeShow() {\r\n        let codeShow = String(this.code);\r\n        let p1 = codeShow.substr(0, 4);\r\n        let p2 = codeShow.substr(4);\r\n        return p1 + ' ' + p2;\r\n    }\r\n\r\n    isAvaliable() {\r\n        return this.isValid && this.expiredDate.getTime() > Date.now()\r\n    }\r\n}\r\n\r\nexport interface OrderPriceStrategy {\r\n\r\n    applyTo(order: Order, uqs: UQs): Promise<void>;\r\n}\r\n\r\nexport function createOrderPriceStrategy(couponData: any): OrderPriceStrategy {\r\n    let { id, code, discount, preferential, validitydate, isValid, types, discountSetting } = couponData;\r\n    switch (types) {\r\n        case \"coupon\":\r\n            return new Coupon(id, code, validitydate, isValid, discount, preferential);\r\n            break;\r\n        case \"coupon_sale\":\r\n            return new CouponSale(id, code, validitydate, isValid, discount, preferential);\r\n            break;\r\n        case \"vipcard\":\r\n            return new VIPCard(id, code, validitydate, isValid, discountSetting);\r\n            break;\r\n        case \"credits\":\r\n            return new Credits(id, code, validitydate, isValid);\r\n            break;\r\n        default:\r\n            break;\r\n    }\r\n}\r\n\r\nexport class Coupon extends CouponBase implements OrderPriceStrategy {\r\n\r\n    constructor(protected id: BoxId, code: number, expiredDate: Date, isValid: boolean, protected discount: number, protected preferential: number) {\r\n        super(id, code, expiredDate, isValid);\r\n    }\r\n    async applyTo(orderData: Order, uqs: UQs) {\r\n        orderData.coupon = this.id\r\n        if (this.isAvaliable()) {\r\n            if (this.discount) {\r\n                let { orderItems, salesRegion } = orderData;\r\n                if (orderItems !== undefined && orderItems.length > 0) {\r\n                    let { salesTask, product: uqsProduct } = uqs;\r\n                    let couponOffsetAmount = 0;\r\n                    for (let i = 0; i < orderItems.length; i++) {\r\n                        let oi = orderItems[i];\r\n                        let { product, packs } = oi;\r\n                        let { ProductX } = uqsProduct;\r\n                        let productTuid: any = await ProductX.load(product)\r\n                        // 获取品牌的折扣\r\n                        let { BottomDiscount } = salesTask;\r\n                        let brandDiscountMap: any = await BottomDiscount.obj({ brand: productTuid.brand, salesRegion: salesRegion.id });\r\n\r\n                        for (let j = 0; j < packs.length; j++) {\r\n                            let pk = packs[j];\r\n                            // 折扣价格取底线折扣价和折扣价格中较高者\r\n                            let lastDiscount = Math.min((brandDiscountMap ? brandDiscountMap.discount : 0), this.discount);\r\n                            let discountPrice = Math.round(pk.retail * (1 - lastDiscount));\r\n                            // 最终价格取折扣价格和显示的价格（可能会有市场活动价)中较低者\r\n                            pk.price = Math.round(Math.min(pk.price, discountPrice));\r\n                            couponOffsetAmount += Math.round(pk.quantity * (pk.retail - pk.price) * -1);\r\n                        };\r\n                    };\r\n                    orderData.couponOffsetAmount = Math.round(couponOffsetAmount);\r\n\r\n                    /*\r\n                    if (agentPrices && agentPrices.length > 0) {\r\n                        let couponOffsetAmount = 0;\r\n                        for (let i = 0; i < orderItems.length; i++) {\r\n                            let oi = orderItems[i];\r\n                            let { product, packs } = oi;\r\n\r\n                            let eachProductAgentPrice = agentPrices[i];\r\n                            for (let j = 0; j < packs.length; j++) {\r\n                                let pk = packs[j];\r\n                                let agentPrice: any = eachProductAgentPrice.find(\r\n                                    (p: any) => p.product.id === product.id &&\r\n                                        p.pack.id === pk.pack.id &&\r\n                                        p.discountinued === 0 &&\r\n                                        p.expireDate > Date.now());\r\n                                if (!agentPrice) break;\r\n\r\n                                // 折扣价格取agentPrice和折扣价格中较高者\r\n                                let discountPrice = Math.round(Math.max(agentPrice.agentPrice, pk.retail * (1 - this.discount)));\r\n                                // 最终价格取折扣价格和显示的价格（可能会有市场活动价)中较低者\r\n                                pk.price = Math.round(Math.min(pk.price, discountPrice));\r\n                                couponOffsetAmount += Math.round(pk.quantity * (pk.retail - pk.price) * -1);\r\n                            };\r\n                        };\r\n                        orderData.couponOffsetAmount = Math.round(couponOffsetAmount);\r\n                    };\r\n                    */\r\n                }\r\n            }\r\n\r\n            if (this.preferential) {\r\n                orderData.couponRemitted = this.preferential * -1;\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n}\r\n\r\nexport class CouponSale extends Coupon implements OrderPriceStrategy {\r\n\r\n    async applyTo(orderData: Order, uqs: UQs) {\r\n        orderData.coupon = this.id\r\n        if (this.isAvaliable()) {\r\n            if (this.discount) {\r\n                let { orderItems } = orderData;\r\n                if (orderItems !== undefined && orderItems.length > 0) {\r\n                    let couponOffsetAmount = 0;\r\n                    for (let i = 0; i < orderItems.length; i++) {\r\n                        let oi = orderItems[i];\r\n                        let { packs } = oi;\r\n\r\n                        for (let j = 0; j < packs.length; j++) {\r\n                            let pk = packs[j];\r\n                            // 最终价格取折扣价格和显示的价格（可能会有市场活动价)中较低者\r\n                            pk.price = Math.round(Math.min(pk.price, pk.retail * (1 - this.discount)));\r\n                            couponOffsetAmount += Math.round(pk.quantity * (pk.retail - pk.price) * -1);\r\n                        };\r\n                    };\r\n                    orderData.couponOffsetAmount = Math.round(couponOffsetAmount);\r\n                }\r\n            }\r\n\r\n            if (this.preferential) {\r\n                orderData.couponRemitted = this.preferential * -1;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport class VIPCard extends CouponBase implements OrderPriceStrategy {\r\n\r\n    constructor(protected id: BoxId, code: number, expiredDate: Date, isValid: boolean, private discountSetting: any[]) {\r\n        super(id, code, expiredDate, isValid);\r\n    }\r\n    async applyTo(orderData: Order, uqs: UQs) {\r\n        orderData.coupon = this.id\r\n        if (this.isAvaliable() && this.discountSetting && this.discountSetting.length > 0) {\r\n            let { orderItems } = orderData;\r\n            if (orderItems !== undefined && orderItems.length > 0) {\r\n                let couponOffsetAmount = 0;\r\n                for (let i = 0; i < orderItems.length; i++) {\r\n                    let oi = orderItems[i];\r\n                    let { product, packs } = oi;\r\n                    // 获取明细中产品的VIP卡折扣\r\n                    let thisDiscountSetting = this.discountSetting.find((e: any) => Tuid.equ(e.brand, product.obj.brand));\r\n                    let discount = (thisDiscountSetting && thisDiscountSetting.discount) || 0;\r\n\r\n                    for (let j = 0; j < packs.length; j++) {\r\n                        let pk = packs[j];\r\n                        // 最终价格取折扣价格和显示的价格（可能会有市场活动价)中较低者\r\n                        pk.price = Math.round(Math.min(pk.price, pk.retail * (1 - discount)));\r\n                        couponOffsetAmount += Math.round(pk.quantity * (pk.retail - pk.price) * -1);\r\n                    };\r\n                };\r\n                orderData.couponOffsetAmount = Math.round(couponOffsetAmount);\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\nexport class Credits extends CouponBase implements OrderPriceStrategy {\r\n    async applyTo(orderData: Order, uqs: UQs) {\r\n        orderData.point = Math.round(orderData.productAmount * 2);\r\n    }\r\n}","import { observable } from 'mobx';\r\nimport { BoxId, Tuid } from 'tonva';\r\nimport { nav } from 'tonva';\r\nimport { CUqBase } from '../CBase';\r\nimport { VCreateOrder } from './VCreateOrder';\r\nimport { Order, OrderItem } from './Order';\r\nimport { OrderSuccess } from './OrderSuccess';\r\nimport { CSelectShippingContact, CSelectInvoiceContact } from '../customer/CSelectContact';\r\nimport { VMyOrders } from './VMyOrders';\r\nimport { VOrderDetail } from './VOrderDetail';\r\nimport { CInvoiceInfo } from '../customer/CInvoiceInfo';\r\nimport { groupByProduct } from '../tools/groupByProduct';\r\nimport { CartItem2, CartPackRow } from '../cart/Cart';\r\nimport { createOrderPriceStrategy, OrderPriceStrategy } from 'coupon/Coupon';\r\nimport { PackRow } from 'product/Product';\r\n\r\nconst FREIGHTFEEFIXED = 12;\r\nconst FREIGHTFEEREMITTEDSTARTPOINT = 100;\r\n\r\nexport class COrder extends CUqBase {\r\n    @observable orderData: Order = new Order();\r\n    @observable couponAppliedData: any = {};\r\n    hasAnyCoupon: boolean;\r\n    @observable buyerAccounts: any[] = [];\r\n\r\n    protected async internalStart(param: any) {\r\n        /*\r\n        let cart = param;\r\n        await this.createOrderFromCart(cart);\r\n        this.openVPage(VCreateOrder);\r\n        */\r\n    }\r\n\r\n    createOrderFromCart = async (cartItems: CartItem2[]) => {\r\n        let { cApp, uqs } = this;\r\n        let { currentUser, currentSalesRegion } = cApp;\r\n        this.orderData.webUser = currentUser.id;\r\n        this.orderData.salesRegion = currentSalesRegion.id;\r\n        this.removeCoupon();\r\n        this.hasAnyCoupon = await this.hasCoupons();\r\n\r\n        let buyerAccountQResult = await uqs.webuser.WebUserBuyerAccount.query({ webUser: currentUser.id })\r\n        if (buyerAccountQResult) {\r\n            this.buyerAccounts = buyerAccountQResult.ret;\r\n            if (this.buyerAccounts && this.buyerAccounts.length === 1) {\r\n                this.orderData.customer = this.buyerAccounts[0].buyerAccount;\r\n            }\r\n        }\r\n\r\n        if (this.orderData.shippingContact === undefined) {\r\n            this.orderData.shippingContact = await this.getDefaultShippingContact();\r\n        }\r\n\r\n        if (this.orderData.invoiceContact === undefined) {\r\n            this.orderData.invoiceContact = await this.getDefaultInvoiceContact();\r\n        }\r\n\r\n        if (this.orderData.invoiceType === undefined) {\r\n            this.orderData.invoiceType = await this.getDefaultInvoiceType();\r\n        }\r\n\r\n        if (this.orderData.invoiceInfo === undefined) {\r\n            this.orderData.invoiceInfo = await this.getDefaultInvoiceInfo();\r\n        }\r\n\r\n        if (cartItems !== undefined && cartItems.length > 0) {\r\n            this.orderData.currency = cartItems[0].packs[0].currency;\r\n            this.orderData.orderItems = cartItems.map((e: any) => {\r\n                var item = new OrderItem();\r\n                item.product = e.product;\r\n                item.packs = e.packs.map((v: any) => { return { ...v } }).filter((v: any) => v.quantity > 0 && v.price);\r\n                item.packs.forEach((pk) => {\r\n                    // pk.retail = pk.price;\r\n                    pk.priceInit = pk.price;\r\n                })\r\n                return item;\r\n            });\r\n\r\n            // 运费和运费减免\r\n            this.orderData.freightFee = FREIGHTFEEFIXED;\r\n            if (this.orderData.productAmount > FREIGHTFEEREMITTEDSTARTPOINT)\r\n                this.orderData.freightFeeRemitted = FREIGHTFEEFIXED * -1;\r\n        }\r\n\r\n        /*\r\n        let currentCode = currentCouponCode || currentCreditCode;\r\n        if (currentCode) {\r\n            let coupon = await cCoupon.getCouponValidationResult(currentCode);\r\n            if (coupon.result === 1)\r\n                this.applyCoupon(coupon);\r\n            else {\r\n                this.cApp.currentCouponCode = undefined;\r\n                this.cApp.currentCreditCode = undefined;\r\n            }\r\n        }\r\n        */\r\n        this.openVPage(VCreateOrder);\r\n    }\r\n\r\n    private defaultSetting: any;\r\n    private async getDefaultSetting() {\r\n        if (this.defaultSetting) return this.defaultSetting;\r\n        let { currentUser } = this.cApp;\r\n        return this.defaultSetting = await currentUser.getSetting() || {};\r\n    }\r\n\r\n    private contact0: BoxId;\r\n    private async getContact(): Promise<BoxId> {\r\n        if (this.contact0 === null) return;\r\n        if (this.contact0 !== undefined) return this.contact0;\r\n        let { currentUser } = this.cApp;\r\n        let contactArr = await currentUser.getContacts();\r\n        if (contactArr === undefined || contactArr.length === 0) {\r\n            this.contact0 = null;\r\n            return;\r\n        }\r\n        return this.contact0 = contactArr[0].contact;\r\n    }\r\n\r\n    private async getDefaultShippingContact() {\r\n        let defaultSetting = await this.getDefaultSetting();\r\n        return defaultSetting.shippingContact || await this.getContact();\r\n    }\r\n\r\n    private async getDefaultInvoiceContact() {\r\n        let defaultSetting = await this.getDefaultSetting();\r\n        return defaultSetting.invoiceContact || await this.getContact();\r\n    }\r\n\r\n    private async getDefaultInvoiceType() {\r\n        let defaultSetting = await this.getDefaultSetting();\r\n        return defaultSetting.invoiceType;\r\n    }\r\n\r\n    private async getDefaultInvoiceInfo() {\r\n        let defaultSetting = await this.getDefaultSetting();\r\n        return defaultSetting.invoiceInfo;\r\n    }\r\n\r\n    /**\r\n     * 提交订单\r\n     */\r\n    submitOrder = async () => {\r\n        let { uqs, cart, currentUser } = this.cApp;\r\n        let { order, webuser, 积分商城 } = uqs;\r\n        let { orderItems } = this.orderData;\r\n\r\n        let result: any = await order.Order.save(\"order\", this.orderData.getDataForSave());\r\n        let { id: orderId, flow, state } = result;\r\n        await order.Order.action(orderId, flow, state, \"submit\");\r\n        // 如果使用了coupon/credits，需要将其标记为已使用\r\n        let { id: couponId, code, types } = this.couponAppliedData;\r\n        if (couponId) {\r\n            let nowDate = new Date();\r\n            let usedDate = `${nowDate.getFullYear()}-${nowDate.getMonth() + 1}-${nowDate.getDay()}`;\r\n            switch (types) {\r\n                case 'coupon':\r\n                    webuser.WebUserCoupon.del({ webUser: currentUser.id, coupon: couponId, arr1: [{ couponType: 1 }] });\r\n                    webuser.WebUserCouponUsed.add({ webUser: currentUser.id, arr1: [{ coupon: couponId, usedDate: usedDate }] });\r\n                    break;\r\n                case 'credits':\r\n                    积分商城.WebUserCredits.del({ webUser: currentUser.id, arr1: [{ credits: couponId }] });\r\n                    积分商城.WebUserCreditsUsed.add({ webUser: currentUser.id, arr1: [{ credits: couponId, usedDate: usedDate }] });\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n\r\n        let param: [{ productId: number, packId: number }] = [] as any;\r\n        orderItems.forEach(e => {\r\n            e.packs.forEach(v => {\r\n                param.push({ productId: e.product.id, packId: v.pack.id })\r\n            })\r\n        });\r\n        cart.removeFromCart(param);\r\n\r\n        // 打开下单成功显示界面\r\n        nav.popTo(this.cApp.topKey);\r\n        this.openVPage(OrderSuccess, result);\r\n    }\r\n\r\n    onSelectShippingContact = async () => {\r\n        let cSelect = this.newC(CSelectShippingContact);\r\n        let contactBox = await cSelect.call<BoxId>(true);\r\n        this.orderData.shippingContact = contactBox;\r\n    }\r\n\r\n    onSelectInvoiceContact = async () => {\r\n        let cSelect = this.newC(CSelectInvoiceContact);\r\n        let contactBox = await cSelect.call<BoxId>(true);\r\n        this.orderData.invoiceContact = contactBox;\r\n    }\r\n\r\n    onCouponEdit = async () => {\r\n        let { cCoupon } = this.cApp;\r\n        let coupon = await cCoupon.call<any>(this.orderData.coupon);\r\n        if (coupon) {\r\n            await this.applyCoupon(coupon);\r\n        }\r\n    }\r\n\r\n    private hasCoupons = async (): Promise<boolean> => {\r\n        let { cCoupon, currentUser } = this.cApp;\r\n        let { id: currentUserId } = currentUser;\r\n        if (await cCoupon.getValidCreditsForWebUser(currentUserId))\r\n            return true;\r\n        let validCoupons = await cCoupon.getValidCouponsForWebUser(currentUserId);\r\n        if (validCoupons && validCoupons.length > 0)\r\n            return true;\r\n        let validCredits = await cCoupon.getValidCreditsForWebUser(currentUserId);\r\n        if (validCredits && validCoupons.length > 0)\r\n            return true;\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * 使用优惠券后计算折扣金额和抵扣额\r\n     */\r\n    applyCoupon = async (coupon: any) => {\r\n\r\n        this.removeCoupon();\r\n        let { result: validationResult, validitydate, isValid } = coupon;\r\n        if (validationResult === 1 && isValid === 1 && new Date(validitydate).getTime() > Date.now()) {\r\n            this.couponAppliedData = coupon;\r\n            let orderPriceStrategy: OrderPriceStrategy = createOrderPriceStrategy(coupon);\r\n            orderPriceStrategy.applyTo(this.orderData, this.uqs);\r\n            /*\r\n            this.orderData.coupon = id;\r\n            if (types === \"coupon\" || types === \"vipcard\") {\r\n                // if (discount) {\r\n                // 仍兼容原来统一折扣的模式\r\n                if ((discountSetting && discountSetting.length > 0) || discount) {\r\n                    let { orderData, uqs, cApp } = this;\r\n                    let { orderItems } = orderData;\r\n                    let { AgentPrice } = uqs.product;\r\n                    if (orderItems !== undefined && orderItems.length > 0) {\r\n                        // 获取每个明细中产品的agentprice;\r\n                        let promises: PromiseLike<any>[] = [];\r\n                        orderItems.forEach(e => {\r\n                            promises.push(AgentPrice.table({ product: e.product.id, salesRegion: cApp.currentSalesRegion.id }));\r\n                        });\r\n                        let agentPrices = await Promise.all(promises);\r\n\r\n                        if (agentPrices && agentPrices.length > 0) {\r\n                            let couponOffsetAmount = 0;\r\n                            for (let i = 0; i < orderItems.length; i++) {\r\n                                let oi = orderItems[i];\r\n                                let { product, packs } = oi;\r\n                                // 获取明细中产品的优惠券/VIP卡折扣\r\n                                if (discountSetting) {\r\n                                    let thisDiscountSetting = discountSetting.find((e: any) => Tuid.equ(e.brand, product.obj.brand));\r\n                                    discount = (thisDiscountSetting && thisDiscountSetting.discount) || discount || 0;\r\n                                }\r\n\r\n                                let eachProductAgentPrice = agentPrices[i];\r\n                                for (let j = 0; j < packs.length; j++) {\r\n                                    let pk = packs[j];\r\n                                    let agentPrice: any = eachProductAgentPrice.find(\r\n                                        (p: any) => p.product.id === product.id &&\r\n                                            p.pack.id === pk.pack.id &&\r\n                                            p.discountinued === 0 &&\r\n                                            p.expireDate > Date.now());\r\n                                    if (!agentPrice) break;\r\n\r\n                                    // 折扣价格取agentPrice和折扣价格中较高者\r\n                                    let discountPrice = Math.round(Math.max(agentPrice.agentPrice, pk.retail * (1 - discount)));\r\n                                    // pk.price = Math.round(Math.max(agentPrice.agentPrice, pk.retail * (1 - discount)));\r\n                                    // 最终价格取折扣价格和显示的价格（可能会有市场活动价)中较低者\r\n                                    pk.price = Math.round(Math.min(pk.price, discountPrice));\r\n                                    couponOffsetAmount += Math.round(pk.quantity * (pk.retail - pk.price) * -1);\r\n                                };\r\n                            };\r\n                            this.orderData.couponOffsetAmount = Math.round(couponOffsetAmount);\r\n                        };\r\n                    }\r\n                }\r\n                if (preferential) {\r\n                    this.orderData.couponRemitted = preferential * -1;\r\n                }\r\n                // 运费和运费减免\r\n                this.orderData.freightFee = FREIGHTFEEFIXED;\r\n                if (this.orderData.productAmount > FREIGHTFEEREMITTEDSTARTPOINT)\r\n                    this.orderData.freightFeeRemitted = FREIGHTFEEFIXED * -1;\r\n            }\r\n\r\n            if (types === \"credits\") {\r\n                this.orderData.point = Math.round(this.orderData.productAmount * 2);\r\n            }\r\n            */\r\n            // 运费和运费减免\r\n            this.orderData.freightFee = FREIGHTFEEFIXED;\r\n            if (this.orderData.productAmount > FREIGHTFEEREMITTEDSTARTPOINT)\r\n                this.orderData.freightFeeRemitted = FREIGHTFEEFIXED * -1;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 删除优惠券\r\n     */\r\n    removeCoupon = () => {\r\n        this.orderData.coupon = undefined;\r\n        this.couponAppliedData = {};\r\n        this.orderData.couponOffsetAmount = 0;\r\n        this.orderData.couponRemitted = 0;\r\n        this.orderData.point = 0;\r\n        this.orderData.orderItems.forEach((e: OrderItem) => e.packs.forEach((v: CartPackRow) => v.price = v.priceInit));\r\n    }\r\n\r\n    /*\r\n    * 打开我的订单列表（在“我的”界面使用）\r\n    */\r\n    openMyOrders = async (state: string) => {\r\n\r\n        this.openVPage(VMyOrders, state);\r\n    }\r\n\r\n    /**\r\n     * 根据状态读取我的订单\r\n     */\r\n    getMyOrders = async (state: string) => {\r\n        let { order } = this.uqs;\r\n        switch (state) {\r\n            case 'pendingpayment':\r\n                return await order.GetPendingPayment.table(undefined);\r\n            case 'processing':\r\n                return await order.Order.mySheets(undefined, 1, -20);\r\n            case 'completed':\r\n                return await order.Order.mySheets(\"#\", 1, -20)\r\n            case 'all':\r\n                let promises: PromiseLike<any>[] = [];\r\n                promises.push(order.Order.mySheets(undefined, 1, -20));\r\n                promises.push(order.Order.mySheets(\"#\", 1, -20));\r\n                let presult = await Promise.all(promises);\r\n                return presult[0].concat(presult[1]).sort((a: any, b: any) => new Date(b.date).valueOf() - new Date(a.date).valueOf());\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 打开发票信息编辑界面\r\n     */\r\n    onInvoiceInfoEdit = async () => {\r\n        let cInvoiceInfo = this.newC(CInvoiceInfo); // new CInvoiceInfo(this.cApp, undefined, true);\r\n        let { invoiceType, invoiceInfo } = this.orderData;\r\n        let origInvoice = {\r\n            invoiceType: invoiceType,\r\n            invoiceInfo: invoiceInfo,\r\n        }\r\n        let newInvoice = await cInvoiceInfo.call<any>(origInvoice, true);\r\n        this.orderData.invoiceType = newInvoice.invoiceType;\r\n        this.orderData.invoiceInfo = newInvoice.invoiceInfo;\r\n    }\r\n\r\n    openOrderDetail = async (orderId: number) => {\r\n\r\n        let order = await this.uqs.order.Order.getSheet(orderId);\r\n        let { data } = order;\r\n        let { orderitems } = data;\r\n        let orderItemsGrouped = groupByProduct(orderitems);\r\n        data.orderItems = orderItemsGrouped;\r\n        this.openVPage(VOrderDetail, order);\r\n    }\r\n\r\n    renderDeliveryTime = (pack: BoxId) => {\r\n        let { cProduct } = this.cApp;\r\n        return cProduct.renderDeliveryTime(pack);\r\n    }\r\n\r\n    renderOrderItemProduct = (product: BoxId) => {\r\n        let { cProduct } = this.cApp;\r\n        return cProduct.renderCartProduct(product);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { View } from 'tonva';\r\nimport { CProductCategory } from './CProductCategory';\r\nimport { FA } from 'tonva';\r\nimport { GLOABLE } from 'cartenv';\r\n//import { observer } from 'mobx-react';\r\n\r\n/*\r\nconst imgStyle: React.CSSProperties = {\r\n    height: '1.5rem', width: '1.5rem',\r\n    marginLeft: '0.1rem',\r\n    marginRight: '0.3rem'\r\n}\r\n\r\nexport const titleTitle: React.CSSProperties = {\r\n    overflow: 'hidden',\r\n    textOverflow: 'ellipsis',\r\n    whiteSpace: 'nowrap',\r\n}\r\n\r\nexport const subStyle: React.CSSProperties = {\r\n    fontSize: '0.75rem',\r\n    overflow: 'hidden',\r\n    textOverflow: 'ellipsis',\r\n    whiteSpace: 'nowrap',\r\n}\r\n*/\r\n\r\nexport class VRootCategory extends View<CProductCategory> {\r\n\r\n    private categoryClick = async (categoryWapper: any, parent: any, labelColor: string) => {\r\n        await this.controller.openMainPage(categoryWapper, parent, labelColor);\r\n    }\r\n\r\n    private renderRootCategory = (item: any, parent: any) => {\r\n        let { name, children, productCategory } = item;\r\n        let { id: productCategoryID } = productCategory;\r\n        let { src, labelColor } = GLOABLE.ROOTCATEGORY[productCategoryID];\r\n        return <div className=\"bg-white mb-3\" key={name}>\r\n            <div className=\"py-2 px-3 cursor-pointer\" onClick={() => this.categoryClick(item, undefined, labelColor)}>\r\n                <img className=\"mr-4 cat-root-img\" src={src} alt={name} />\r\n                <b>{name}</b>\r\n            </div>\r\n            <div className=\"cat-root-sub\">\r\n                <div className=\"row no-gutters\">\r\n                    {children.map((v: any) => this.renderSubCategory(v, item, labelColor))}\r\n                </div>\r\n            </div>\r\n        </div>;\r\n    }\r\n\r\n    private renderSubCategory = (item: any, parent: any, labelColor: string) => {\r\n        let { name, subsub, total } = item;\r\n        return <div key={name}\r\n            className=\"col-6 col-md-4 col-lg-3 cursor-pointer\"\r\n            onClick={() => this.categoryClick(item, parent, labelColor)}>\r\n            <div className=\"py-2 px-2 cat-sub\">\r\n                <div className=\"text-truncate\">\r\n                    <span className=\"ml-1 align-middle\">\r\n                        <FA name=\"chevron-circle-right\" className={labelColor} />\r\n                        &nbsp; {name}\r\n                    </span>\r\n                </div>\r\n                {renderThirdCategory(subsub, total)}\r\n            </div>\r\n        </div>;\r\n    }\r\n\r\n    render(param: any): JSX.Element {\r\n        return <this.content />\r\n    }\r\n\r\n    private content = () => {\r\n        let { rootCategories } = this.controller;\r\n        return <>{rootCategories.map((v: any) => this.renderRootCategory(v, undefined))}</>;\r\n        // return <>{categories2.map(v => <div key={v.productCategory.id}>{tv(v, e => this.renderRoot(e))}</div>)}</>;\r\n    };\r\n\r\n    private renderRoot(root: any) {\r\n        let { productCategory } = root;\r\n        let { id } = productCategory;\r\n        console.log(id);\r\n        return <div key={id}>{id}</div>\r\n    }\r\n}\r\n\r\n\r\nexport function renderThirdCategory(subsub: string, total: number) {\r\n    /*\r\n    return <div className=\"py-1 px-1 text-muted small cat-sub-style\">\r\n        {items.length === 0 ? <>产品数量: {total > 1000 ? '>1000' : total}</> : items.map((v: any) => v.name).join(' / ')}\r\n    </div>\r\n    */\r\n    return <div className=\"py-1 px-1 text-muted small text-truncate\">\r\n        {\r\n            subsub === undefined ?\r\n                <>{total > 1000 ? '>1000' : total} 个产品</>\r\n                :\r\n                subsub\r\n        }\r\n    </div>\r\n}\r\n","import * as React from 'react';\r\nimport { VPage, Page, FA } from 'tonva';\r\nimport { CProductCategory } from './CProductCategory';\r\nimport marked from 'marked';\r\n//import { tv } from 'tonva';\r\nimport { renderThirdCategory } from './VRootCategory';\r\nimport { observer } from 'mobx-react';\r\nimport $ from 'jquery';\r\n\r\nexport class VCategory extends VPage<CProductCategory> {\r\n\r\n    instruction: string;\r\n    async open(categoryWapper: any) {\r\n\r\n        this.instruction = categoryWapper.instruction;\r\n        this.openPage(this.page, categoryWapper);\r\n        // let { getCategoryInstruction } = this.controller;\r\n        // this.instruction = await getCategoryInstruction(0);\r\n    }\r\n\r\n    /*\r\n    private renderChild = (childWapper: any) => {\r\n        return <div className=\"py-2\"><FA name=\"hand-o-right mr-2\"></FA>{childWapper.name}</div>\r\n    }*/\r\n\r\n    private categoryClick = async (childWapper: any, parent: any, labelColor: string) => {\r\n        await this.controller.openMainPage(childWapper, parent, labelColor);\r\n    }\r\n\r\n    /*\r\n    private breadCrumb = (item: any, parent: any) => {\r\n        return <nav arial-babel=\"breadcrumb\">\r\n            <ol className=\"breadcrumb\">\r\n                {tv(item, this.breadCrumbItem)}\r\n            </ol>\r\n        </nav>\r\n\r\n    }*/\r\n\r\n    /*\r\n    private breadCrumbItem = (values: any, parent: any) => {\r\n        if (values === undefined || values.productCategory === undefined)\r\n            return <></>;\r\n        return <>\r\n            {tv(values.productCategory.parent, this.breadCrumbItem)}\r\n            <li className=\"breadcrumb-item\" onClick={() => this.categoryClick(values, undefined, \"\")}>{values.name}</li>\r\n        </>\r\n    }*/\r\n\r\n    private renderRootCategory = (item: any, parent: any, labelColor: string) => {\r\n        let { productCategory, name, children } = item;\r\n        let instructionUi;\r\n        if (this.instruction) {\r\n            let instr: JQuery<Element> = $(this.instruction);\r\n            $(\"a[href*='jkchemical.com']\", instr).addClass('d-none');\r\n            instructionUi = <div className=\"overflow-auto my-3 bg-light\" style={{ height: 320 }} dangerouslySetInnerHTML={{ __html: (instr[0].innerHTML || \"\") }} />;\r\n        }\r\n        return <div className=\"bg-white mb-3\" key={name}>\r\n            <div className=\"py-2 px-3 cursor-pointer\" onClick={() => this.categoryClick(item, parent, labelColor)}>\r\n                <b>{name}</b>\r\n                {instructionUi}\r\n            </div>\r\n            <div className=\"cat-root-sub\">\r\n                <div className=\"row no-gutters\">\r\n                    {children.map((v: any) => this.renderSubCategory(v, item, labelColor))}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    }\r\n\r\n    private renderSubCategory = (item: any, parent: any, labelColor: string) => {\r\n        let { name, subsub, total } = item;\r\n        return <div key={name}\r\n            className=\"col-6 col-md-4 col-lg-3 cursor-pointer\"\r\n            onClick={() => this.categoryClick(item, parent, labelColor)}>\r\n            <div className=\"py-2 px-2 cat-sub\">\r\n                <div className=\"cat-title-title\">\r\n                    <span className=\"ml-1 align-middle\">\r\n                        <FA name=\"chevron-circle-right\" className={labelColor} />\r\n                        &nbsp; {name}\r\n                    </span>\r\n                </div>\r\n                {renderThirdCategory(subsub, total)}\r\n            </div>\r\n        </div>;\r\n    }\r\n\r\n    private page = observer((categoryWapper: any) => {\r\n        let { cHome } = this.controller.cApp;\r\n        let header = cHome.renderSearchHeader();\r\n        let cartLabel = this.controller.cApp.cCart.renderCartLabel();\r\n\r\n        let { categoryWapper: item, parent, labelColor } = categoryWapper;\r\n        return <Page header={header} right={cartLabel}>\r\n            {this.renderRootCategory(item, parent, labelColor)}\r\n        </Page>\r\n    })\r\n}","//import { observable } from 'mobx';\r\nimport _ from 'lodash';\r\nimport { CUqBase } from '../CBase';\r\nimport { VRootCategory } from './VRootCategory';\r\nimport { VCategory } from './VCategory';\r\nimport { GLOABLE } from \"cartenv\";\r\nimport './cat.css';\r\n\r\nexport class CProductCategory extends CUqBase {\r\n    rootCategories: any[] = [];\r\n    //@observable categories2: any[] = [];\r\n\r\n    async internalStart(param: any) {\r\n        this.uqs.product.ProductCategory.stopCache();\r\n\r\n        let { currentSalesRegion, currentLanguage } = this.cApp;\r\n        let results = await this.uqs.product.GetRootCategory.query({\r\n            salesRegion: currentSalesRegion.id,\r\n            language: currentLanguage.id\r\n        });\r\n        let { first, secend, third } = results;\r\n        /*\r\n        (first as any[]).forEach(element => {\r\n            this.buildCategories(element, secend, third);\r\n        });\r\n        */\r\n        this.rootCategories = (first as any[]).map(v => {\r\n            return this.buildCategories(v, secend, third);\r\n        });\r\n        /*\r\n        let result2 = await this.getRootCategoriesQuery.query({ salesRegion: currentSalesRegion.id, language: currentLanguage.id });\r\n        if (result2)\r\n            this.categories2 = result2.ret;\r\n        */\r\n    }\r\n\r\n    renderRootList = () => {\r\n        return this.renderView(VRootCategory);\r\n    };\r\n\r\n    getCategoryInstruction = async (categoryId: number) => {\r\n        let res = await window.fetch(GLOABLE.CONTENTSITE + \"/partial/categoryinstruction/\" + categoryId);\r\n        if (res.ok) {\r\n            let content = await res.text();\r\n            return content;\r\n        }\r\n    };\r\n\r\n    private async getCategoryChildren(parentCategoryId: number) {\r\n        let { currentSalesRegion, currentLanguage } = this.cApp;\r\n        return await this.uqs.product.GetChildrenCategory.query({\r\n            parent: parentCategoryId,\r\n            salesRegion: currentSalesRegion.id,\r\n            language: currentLanguage.id\r\n        });\r\n    }\r\n\r\n    private buildCategories(categoryWapper: any, firstCategory: any[], secendCategory: any[]): any {\r\n        let { productCategory } = categoryWapper;\r\n        let catId: number = productCategory.id, children: any[] = [];\r\n        for (let f of firstCategory) {\r\n            if (f.parent !== catId) continue;\r\n            let pcid = f.productCategory.id;\r\n            let len = secendCategory.length;\r\n            let subsub = '';\r\n            for (let j = 0; j < len; j++) {\r\n                //element.children = secendCategory.filter((v: any) => v.parent === pcid);\r\n                let { name, parent } = secendCategory[j];\r\n                if (parent !== pcid) continue;\r\n                if (subsub.length > 0) subsub += ' / ';\r\n                subsub += name;\r\n                let sLen = subsub.length;\r\n                if (sLen > 40) break;\r\n            }\r\n            if (subsub.length > 0) f.subsub = subsub;\r\n            children.push(f);\r\n        }\r\n        //categoryWapper.children = firstCategory.filter((v: any) => v.parent === pcid);\r\n        let ret = _.clone(categoryWapper);\r\n        ret.children = children; // firstCategory.filter((v: any) => v.parent === pcid);\r\n        return ret;\r\n    }\r\n\r\n    async openMainPage(categoryWaper: any, parent: any, labelColor: string) {\r\n\r\n        let { productCategory, name } = categoryWaper;\r\n        let { id: productCategoryId } = productCategory;\r\n        let results = await this.getCategoryChildren(productCategoryId);\r\n        if (results.first.length !== 0) {\r\n            let rootCategory = this.buildCategories(categoryWaper, results.first, results.secend);\r\n            let instruction = await this.getCategoryInstruction(productCategoryId);\r\n            this.openVPage(VCategory, { categoryWapper: rootCategory, parent, labelColor, instruction });\r\n        } else {\r\n            let { cProduct } = this.cApp;\r\n            await cProduct.searchByCategory({ productCategoryId, name });\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { VPage, Image } from 'tonva';\r\nimport { CMember } from './CMember';\r\nimport { LMR, Muted, FA, Media } from 'tonva';\r\nimport pig from '../images/pig.png';\r\nimport { observer } from 'mobx-react';\r\n\r\nconst stylePig: React.CSSProperties = {\r\n    width: '100%',\r\n    height: '20rem',\r\n    backgroundImage: `url(${pig})`,\r\n    backgroundSize: 'contain',\r\n    backgroundColor: 'rgba(255,255,255,0.1)',\r\n    opacity: 0.09,\r\n    position: 'absolute',\r\n}\r\n\r\nexport class VMember extends VPage<CMember> {\r\n    private recommendationCodeRef = React.createRef<HTMLInputElement>();\r\n\r\n    async open(param: any) {\r\n\r\n    }\r\n\r\n    render(member: any): JSX.Element {\r\n\r\n        return <this.page />;\r\n    }\r\n\r\n    private submitRecommendationCode() {\r\n        let code = this.recommendationCodeRef.current.value;\r\n        if (code) {\r\n            let { setReferrer: submit } = this.controller;\r\n            submit(code);\r\n        }\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let { cApp, member } = this.controller;\r\n        if (member === undefined)\r\n            return <></>;\r\n        let { currentUser } = cApp;\r\n        let { recommendationCode, point } = member;\r\n        if (!point) point = 0;\r\n\r\n        let im = <Image className=\"mr-3 w-3c h-3c\" src={currentUser.icon} />;\r\n        let inviteCode = <div className=\"small\">邀请码: {recommendationCode}</div>;\r\n\r\n        let divPoints = <div className=\"my-3 text-center bg-white h-25\" style={{ position: 'relative' }}>\r\n            <div className=\"w-100 bg-white h-20c\" style={{ position: 'absolute' }} />\r\n            <div className=\"d-flex align-items-center justify-content-center\" style={stylePig} />\r\n            <div className=\"w-100 d-flex align-items-center justify-content-center h-20c\" style={{ position: 'absolute' }}>\r\n                <div className=\"muted mr-3 small\">积分: </div>\r\n                <div className=\"text-danger\" style={{ fontSize: '2rem' }}>{point}</div>\r\n            </div>\r\n        </div>\r\n\r\n        let pointTitle = <p className=\"h4\">我的积分</p>\r\n        let pointDetail = <p className=\"small align-self-end\">查看详情 <FA name=\"angle-right\"></FA></p>\r\n        let pointThisWeek = <><p className=\"h5 mb-0\">0</p><Muted>本周</Muted></>\r\n        let pointAll = <><p className=\"h5 mb-0\">{point}</p><Muted>累计</Muted></>\r\n\r\n        let fansTitle = <p>我的粉丝</p>\r\n        let fansDetail = <p className=\"small align-self-end\">查看详情 <FA name=\"angle-right\"></FA></p>;\r\n        let detail = <div className=\"shadow bg-white rounded p-3 mb-1\">\r\n            <LMR left={fansTitle} right={fansDetail}></LMR>\r\n            <LMR className=\"pb-2\">\r\n                <p className=\"h4 mb-0\">0</p>\r\n                <Muted>今日</Muted>\r\n            </LMR>\r\n            <LMR left={pointThisWeek} right={pointAll} />\r\n            <LMR>\r\n                <input type=\"text\" className=\"form-control\" ref={this.recommendationCodeRef} />\r\n                <button type=\"button\" className=\"btn btn-primary\" onClick={() => this.submitRecommendationCode()}>输入邀请码</button>\r\n            </LMR>\r\n        </div>;\r\n\r\n        return <div>\r\n            <LMR className=\"bg-white p-3 mb-1 align-items-center\"\r\n                left={im} right={inviteCode}>\r\n                <b>{currentUser.name}</b>\r\n            </LMR>\r\n            {divPoints}\r\n            {/*detail*/}\r\n        </div>\r\n    })\r\n}\r\n/*\r\n<div className=\"shadow bg-white rounded p-3 mb-1\">\r\n<LMR left={pointTitle} right={pointDetail}></LMR>\r\n<LMR className=\"pb-2\">\r\n    <p className=\"h4 mb-0\">0</p>\r\n    <Muted>今日</Muted>\r\n</LMR>\r\n<LMR left={pointThisWeek} right={pointAll} />\r\n</div>\r\n*/","import * as React from 'react';\r\n//import Loadable from 'react-loadable';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport { FA } from 'tonva';\r\nimport { Controller, Loading, nav } from 'tonva';\r\nimport { Action, Map, BoxId } from 'tonva';\r\nimport { CApp } from '../CApp';\r\nimport { CUqBase } from '../CBase';\r\nimport { VMember } from './VMember';\r\n//import { CCartApp } from 'CCartApp';\r\n//import { jnkTop } from 'me/loginTop';\r\n\r\nexport class CMember extends CUqBase {\r\n\r\n    //cApp: CCartApp;\r\n    //    cApp: CApp;\r\n    @observable member: any;\r\n    private referrer: BoxId;\r\n\r\n    protected async internalStart(param: any) {\r\n\r\n        if (this.isLogined) {\r\n            let { member } = this.uqs;\r\n            let { id: currentUserId } = this.user;\r\n            let promises: PromiseLike<any>[] = [];\r\n            promises.push(member.MemberAction.submit({}));\r\n            promises.push(member.MemberRecommender.table({ referrer: currentUserId }));\r\n            promises.push(member.MemberRecommender.table({ member: currentUserId }));\r\n            let result = await Promise.all(promises);\r\n            let { code, point } = result[0];\r\n            this.referrer = result[2];\r\n            this.member = { recommendationCode: code, point: point, fans: result[1], referrer: result[2] };\r\n        }\r\n    }\r\n\r\n    private loginCallback = async () => {\r\n        nav.pop();\r\n        await this.internalStart(undefined);\r\n    }\r\n\r\n    render = observer(() => {\r\n        if (this.isLogined) {\r\n            return this.member === undefined ? <Loading /> : this.renderView(VMember);\r\n        } else {\r\n            return <div\r\n                className=\"d-flex h-100 flex-column align-items-center justify-content-center\">\r\n                <div className=\"flex-fill\" />\r\n                <button className=\"btn btn-success w-20c\"\r\n                    onClick={() => nav.showLogin(this.loginCallback, true)}>\r\n                    <FA name=\"sign-out\" size=\"lg\" /> 请登录\r\n                </button>\r\n                <div className=\"flex-fill\" />\r\n                <div className=\"flex-fill\" />\r\n            </div>;\r\n        }\r\n    })\r\n\r\n    tab = () => {\r\n        this.start();\r\n        return <this.render />;\r\n    }\r\n\r\n    setReferrer(code: string) {\r\n        if (code) {\r\n            // 写入map，方法是add，用这个方法可能会写入多次，多以在写入之前要检查有没有，有的话，就不能再调用这个方法了\r\n            // 这个逻辑我认为应该是在服务端，写入的时候要给双方积分，给多少积分的逻辑，也应该在后端，从邀请码到拥有此邀请码\r\n            // 的会员id之间的转换，逻辑也应该在后台，这个后端的逻辑写在ACTION中？\r\n            if (!this.referrer) {\r\n                let { id: currentUserId } = this.user;\r\n            }\r\n        }\r\n    }\r\n}","import * as React from 'react';\r\nimport { Page } from 'tonva';\r\nimport marked from 'marked';\r\nimport logo from '../images/logo.png';\r\n\r\nconst content = `<p>　　百灵威科技有限公司是一家致力于研发和生产化学及相关产品，集敏捷制造、全球营销和现代物流为一体的高科技企业。\r\n百灵威在中国内地、香港，欧洲及北美等多个国家和地区设有物流中心，实行专业化、个性化的一站式服务，\r\n为全球超过200,000 名科技和工业领域的客户提供产品资源及配套技术服务。</p>\r\n<image src=\"images/aboutus/HebBirdsEye.jpg\" alt=\"BirdsEye\" class=\"pb-3\" style=\"width:100%; height:auto\">\r\n<p>　　百灵威现代化的研发制造基地拥有一支富有创造天赋的专业团队，新技术、新产品层出不穷，J&K®、Amethyst®、J&K Scientific® 产品\r\n已多达30,000 种以上，并呈几何级数增长。作为国际化的资源平台公司，百灵威致力于促进全球产业链的合作，不断推进集约式发展，\r\n集成资源600,000 余种，包括高纯有机试剂、无机试剂、生化试剂、分析试剂、标准品、金属有机催化剂、医药中间体、超精细材料、\r\n以及实验室仪器、耗材等众多产品。百灵威的柔性生产线能够快速提供小批量、多品种的原料，满足实验、中试以至规模化生产的需要。\r\n</p>\r\n<image src=\"images/aboutus/aboutUs1.jpg\" alt=\"aboutus1\" class=\"pb-3\" style=\"width:100%; height:auto\">\r\n<p>　　百灵威秉承“诚实守信、开拓创新、合作共赢、实现卓越”的价值观，致力于与化学、生物医药、精细化工、食品工业、现代农业、电子、日化、\r\n石化、纺织、生命科学、环境保护、疾病控制、新能源、新材料、航空航天等领域的客户建立互信、长久的合作关系，\r\n为实现“促进科技与工业发展，造福人类”的使命而不懈努力！\r\n</p>\r\n`\r\n\r\nexport class About extends React.Component {\r\n    render() {\r\n        let right = null;\r\n        return <Page header=\"关于百灵威\" right={right}>\r\n            <div className='bg-white p-3'>\r\n                <img className=\"h-3c position-absolute\" src={logo} alt=\"百灵威\" />\r\n                <div className=\"h3 flex-fill text-center\">\r\n                    <span className=\"text-primary mr-3\">百灵威集团</span>\r\n                </div>\r\n                <div className=\"mt-5\" dangerouslySetInnerHTML={{ __html: marked(content) }} />\r\n            </div>\r\n        </Page>;\r\n    }\r\n}","import * as React from 'react';\r\nimport { Page } from 'tonva';\r\n\r\ninterface Phone {\r\n\tnumber: string;\r\n\tcaption: string;\r\n}\r\n\r\ninterface Section {\r\n\tcaption: string;\r\n\taddress: string;\r\n\tpost?: string;\r\n\tphones: Phone[];\r\n\tfax?: string;\r\n\temail: string[];\r\n}\r\n\r\nconst sections: Section[] = [\r\n\t{\r\n\t\tcaption: 'J&K Scientific Ltd.',\r\n\t\taddress: '北京市朝阳区北辰西路69号峻峰华亭A座5层',\r\n\t\tpost: '100029',\r\n\t\tphones: [\r\n\t\t\t{ number: '4006667788', caption: '400-666-7788' },\r\n\t\t\t{ number: '+861082848833', caption: '+86 10 8284 8833' },\r\n\t\t],\r\n\t\tfax: '+86 10 8284 9933',\r\n\t\temail: ['jkinfo@jkchemical.com', 'jkinfo@jk-sci.com'],\r\n\t},\r\n\t{\r\n\t\tcaption: 'J&K Scientific Ltd. (上海)',\r\n\t\taddress: '上海市浦东区世纪大道1777号东方希望大厦10楼H座',\r\n\t\tpost: '200122',\r\n\t\tphones: [{ number: '+862161638833', caption: '+86 21 6163 8833' }],\r\n\t\tfax: '+86 21 6163 8800',\r\n\t\temail: ['jksh@jkchemical.com', 'jksh@jk-sci.com']\r\n\t},\r\n\t{\r\n\t\tcaption: 'J&K Scientific Ltd. (广东)',\r\n\t\taddress: '广东省广州市天河区珠江新城华夏路28号富力盈信大厦3108室',\r\n\t\tpost: '510623',\r\n\t\tphones: [{ number: '+862038889733', caption: '+86 20 3888 9733' }],\r\n\t\tfax: '+86 20 3888 8285',\r\n\t\temail: ['jkgz@jkchemical.com', 'jkgz@jk-sci.com'],\r\n\t},\r\n\t{\r\n\t\tcaption: 'J&K Scientific Ltd. (成都)',\r\n\t\taddress: '四川省成都市高新区科园南路1号1栋8楼803号',\r\n\t\tpost: '610041',\r\n\t\tphones: [{ number: '+8602883231067', caption: '+86 028 83231067' }],\r\n\t\temail: ['jkinfo@jkchemical.com'],\r\n\t},\r\n\t{\r\n\t\tcaption: 'J&K Scientific Ltd. (香港)',\r\n\t\taddress: 'FLAT/RM 1901, 19/F, Lee Garden One,33 Hysan Avenue, Causeway Bay, Hong Kong',\r\n\t\tphones: [{ number: '+85228105022', caption: '+852 2810 5022' }],\r\n\t\tfax: '+852 2810 5033',\r\n\t\temail: ['jkhk@jkchemical.com'],\r\n\t}\r\n];\r\n\r\nconst Row: React.FunctionComponent<any> = ({ label, content }) => {\r\n\tif (!content) return null;\r\n\treturn <div className=\"my-1\">\r\n\t\t<span className=\"small text-muted\">{label}</span>：{content}\r\n\t</div>;\r\n}\r\n\r\nexport class ContactUs extends React.Component {\r\n\trender() {\r\n\t\tlet right = null;\r\n\t\treturn <Page header=\"联系信息\" right={right}>\r\n\t\t\t<div className='bg-white pb-5'>\r\n\t\t\t\t<div className=\"h4 pb-3 border-bottom border-muted text-center p-3 mb-3\">\r\n\t\t\t\t\t<span className=\"text-primary mr-\">联系我们</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"px-3 my-3\">\r\n\t\t\t\t\t<small className=\"text-muted\">全国客服热线：</small><a href=\"tel:4006667788\">400-666-7788</a>\r\n\t\t\t\t\t<span className=\"ml-4\"><small className=\"text-muted\">QQ：</small>4006667788</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t{sections.map((v, index) => {\r\n\t\t\t\t\tlet { caption, address, post, phones, fax, email } = v;\r\n\t\t\t\t\treturn <div key={index} className=\"my-4\">\r\n\t\t\t\t\t\t<div className=\"h5 text-info border-bottom p-3\">{caption}</div>\r\n\t\t\t\t\t\t<div className=\"px-3\">\r\n\t\t\t\t\t\t\t<Row label=\"地址\" content={address} />\r\n\t\t\t\t\t\t\t<Row label=\"邮编\" content={post} />\r\n\t\t\t\t\t\t\t<Row label=\"电话\" content={\r\n\t\t\t\t\t\t\t\tphones && phones.map((phone, phoneIndex) => {\r\n\t\t\t\t\t\t\t\t\tlet { number, caption } = phone;\r\n\t\t\t\t\t\t\t\t\treturn <a key={phoneIndex} className=\"mr-5\" href={'tel:' + number}>{caption}</a>\r\n\t\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t<Row label=\"传真\" content={fax} />\r\n\t\t\t\t\t\t\t<Row label=\"电子邮件\" content={\r\n\t\t\t\t\t\t\t\temail && email.map((e, eIndex) => {\r\n\t\t\t\t\t\t\t\t\treturn <a key={eIndex} className=\"mr-5\" href={'mailto:' + e}>{e}</a>\r\n\t\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t})}\r\n\t\t\t</div>\r\n\t\t</Page >;\r\n\t}\r\n}\r\n/*\r\n<div className=\"my-5\">\r\n<p className=\"h4 text-info\">J&amp;K Scientific Ltd.</p>\r\n<div className=\"small\">\r\n\t<p>地址：北京市朝阳区北辰西路69号峻峰华亭A座5层</p>\r\n\t<p>邮编：100029</p>\r\n\t<p>电话：<a href=\"tel:4006667788\">400-666-7788</a> / <a href=\"tel:861082848833\">+86 10 8284 8833</a></p>\r\n\t<p>传真：+86 10 8284 9933</p>\r\n\t<p>电子邮件：<a href=\"mailto:jkinfo@jkchemical.com\">jkinfo@jkchemical.com</a><a className=\"ml-3\" href=\"mailto:jkinfo@jk-sci.com\">jkinfo@jk-sci.com</a></p>\r\n</div>\r\n</div>\r\n<div className=\"my-5\">\r\n<p className=\"h4 text-info\">J&amp;K Scientific Ltd.(上海)</p>\r\n<div className=\"small\">\r\n\t<p>地址：上海市浦东区世纪大道1777号东方希望大厦10楼H座</p>\r\n\t<p>邮编：200122</p>\r\n\t<p>电话：<a href=\"tel:+862161638833\">+86 21 6163 8833</a></p>\r\n\t<p>传真：+86 21 6163 8800</p>\r\n\t<p>电子邮件：<a href=\"mailto:jksh@jkchemical.com\">jksh@jkchemical.com</a><a className=\"ml-3\" href=\"mailto:jksh@jk-sci.com\">jksh@jk-sci.com</a></p>\r\n</div>\r\n</div>\r\n<div className=\"my-5\">\r\n<p className=\"h4 text-info\">J&amp;K Scientific Ltd.(广东)</p>\r\n<div className=\"small\">\r\n\t<p>地址：广东省广州市天河区珠江新城华夏路28号富力盈信大厦3108室</p>\r\n\t<p>邮编：510623</p>\r\n\t<p>电话：<a href=\"tel:+862038889733\">+86 20 3888 9733</a></p>\r\n\t<p>传真：+86 20 3888 8285</p>\r\n\t<p>电子邮件：<a href=\"mailto:jkgz@jkchemical.com\">jkgz@jkchemical.com</a><a className=\"ml-3\" href=\"mailto:jkgz@jk-sci.com\">jkgz@jk-sci.com</a></p>\r\n</div>\r\n</div>\r\n<div className=\"my-5\">\r\n<p className=\"h4 text-info\">J&amp;K Scientific Ltd.(成都)</p>\r\n<div className=\"small\">\r\n\t<p>地址：四川省成都市高新区科园南路1号1栋8楼803号</p>\r\n\t<p>邮编：610041</p>\r\n\t<p>电话：<a href=\"tel:+8602883231067\">+86 028 83231067</a></p>\r\n\t<p>电子邮件：<a href=\"mailto:jkinfo@jkchemical.com\">jkinfo@jkchemical.com</a></p>\r\n</div>\r\n</div>\r\n<div className=\"my-5\">\r\n<p className=\"h4 text-info\">J&amp;K Scientific Ltd.(香港)</p>\r\n<div className=\"small\">\r\n\t<p>地址：FLAT/RM 1901, 19/F, Lee Garden One,33 Hysan Avenue, Causeway Bay, Hong Kong</p>\r\n\t<p>电话：<a href=\"tel:+85228105022\">+852 2810 5022</a></p>\r\n\t<p>传真：+852 2810 5033</p>\r\n\t<p>电子邮件：<a href=\"mailto:jkhk@jkchemical.com\">jkhk@jkchemical.com</a></p>\r\n</div>\r\n</div>\r\n*/","import * as React from 'react';\r\nimport { observable } from 'mobx';\r\nimport {\r\n    userApi, ItemSchema, StringSchema, ImageSchema, UiTextItem, UiImageItem, nav, Page,\r\n    Edit, UiSchema,\r\n    VPage, UiRadio, IdSchema, UiIdItem, Context, BoxId, tv\r\n} from 'tonva';\r\nimport { CMe } from './CMe';\r\nimport {\r\n    faxValidation, emailValidation, mobileValidation, telephoneValidation,\r\n    addressDetailValidation, zipCodeValidation,\r\n    organizationNameValidation, departmentNameValidation,\r\n    salutationValidation, nameValidation\r\n} from '../tools/inputValidations';\r\n\r\nexport class EditMeInfo extends VPage<CMe>{\r\n\r\n    async open(param: any) {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private schema: ItemSchema[] = [\r\n        { name: 'nick', type: 'string' } as StringSchema,\r\n        { name: 'icon', type: 'image' } as ImageSchema,\r\n    ];\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            nick: { widget: 'text', label: '别名', placeholder: '好的别名更方便记忆' } as UiTextItem,\r\n            icon: { widget: 'image', label: '头像' } as UiImageItem,\r\n        }\r\n    }\r\n    @observable private data: any;\r\n\r\n    @observable private webUserData: any;\r\n\r\n    @observable private webUserContactData: any;\r\n\r\n    constructor(props: any) {\r\n        super(props);\r\n        let { nick, icon } = nav.user;\r\n        this.data = {\r\n            nick: nick,\r\n            icon: icon,\r\n        };\r\n\r\n        let { cApp } = this.controller;\r\n        let { firstName, gender, salutation, organizationName, departmentName, telephone\r\n            , mobile, email, fax, zipCode, address, addressString } = cApp.currentUser;\r\n        this.webUserData = {\r\n            firstName: firstName,\r\n            gender: gender,\r\n            salutation: salutation,\r\n            organizationName: organizationName,\r\n            departmentName: departmentName,\r\n        };\r\n\r\n        this.webUserContactData = {\r\n            telephone: telephone,\r\n            mobile: mobile,\r\n            email: email,\r\n            fax: fax,\r\n            address: address,\r\n            addressString: addressString,\r\n            zipCode: zipCode,\r\n        }\r\n    }\r\n\r\n    private onItemChanged = async (itemSchema: ItemSchema, newValue: any, preValue: any) => {\r\n        let { name } = itemSchema;\r\n        await userApi.userSetProp(name, newValue);\r\n        this.data[name] = newValue;\r\n        (nav.user as any)[name] = newValue;\r\n        nav.saveLocalUser();\r\n    }\r\n\r\n    private onWebUserChanged = async (itemSchema: ItemSchema, newValue: any, preValue: any) => {\r\n        let { name } = itemSchema;\r\n        this.webUserData[name] = newValue;\r\n        await this.controller.changeWebUser(this.webUserData);\r\n    }\r\n\r\n    private onWebUserContactChanged = async (itemSchema: ItemSchema, newValue: any, preValue: any) => {\r\n        let { name } = itemSchema;\r\n        this.webUserContactData[name] = newValue;\r\n        await this.controller.changeWebUserContact(this.webUserContactData);\r\n    }\r\n\r\n    private page = () => {\r\n        let { schema, uiSchema, data, onItemChanged, webUserData, onWebUserChanged, webUserContactData, onWebUserContactChanged, controller } = this;\r\n        return <Page header=\"个人信息\">\r\n            <Edit schema={schema} uiSchema={uiSchema}\r\n                data={data}\r\n                onItemChanged={onItemChanged} />\r\n            <Edit schema={webUserSchema} uiSchema={webUserUiSchema}\r\n                data={webUserData}\r\n                onItemChanged={onWebUserChanged} />\r\n            <Edit schema={webUserContactSchema} uiSchema={webUserContactUiSchema(controller.pickAddress)}\r\n                data={webUserContactData}\r\n                onItemChanged={onWebUserContactChanged} />\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport const webUserSchema: ItemSchema[] = [\r\n    { name: 'firstName', type: 'string', required: true } as StringSchema,\r\n    { name: 'gender', type: 'string' } as StringSchema,\r\n    { name: 'salutation', type: 'string' } as StringSchema,\r\n    { name: 'organizationName', type: 'string', required: true } as StringSchema,\r\n    { name: 'departmentName', type: 'string' } as StringSchema,\r\n];\r\n\r\nexport const webUserUiSchema: UiSchema = {\r\n    items: {\r\n        firstName: {\r\n            widget: 'text', label: '真实姓名',\r\n            placeholder: '真实姓名',\r\n            rules: nameValidation\r\n        } as UiTextItem,\r\n        gender: { widget: 'radio', label: '性别', list: [{ value: '1', title: '男' }, { value: '0', title: '女' }] } as UiRadio,\r\n        salutation: { widget: 'text', label: '称谓', rules: salutationValidation } as UiTextItem,\r\n        organizationName: { widget: 'text', label: '单位名称', placeholder: '单位名称', rules: organizationNameValidation } as UiTextItem,\r\n        departmentName: { widget: 'text', label: '部门名称', placeholder: '部门名称', rules: departmentNameValidation } as UiTextItem,\r\n    }\r\n}\r\n\r\n// 个人联系方式信息\r\nexport const webUserContactSchema: ItemSchema[] = [\r\n    { name: 'telephone', type: 'string' } as StringSchema,\r\n    { name: 'mobile', type: 'string', required: true } as StringSchema,\r\n    { name: 'email', type: 'string' } as StringSchema,\r\n    { name: 'fax', type: 'string', required: false } as StringSchema,\r\n    { name: 'address', type: 'id', required: false } as IdSchema,\r\n    { name: 'addressString', type: 'string', required: false } as StringSchema,\r\n    { name: 'zipCode', type: 'string', required: false } as StringSchema,\r\n];\r\n\r\nexport function webUserContactUiSchema(pickAddress: any) {\r\n    return {\r\n        items: {\r\n            telephone: { widget: 'text', label: '固定电话', placeholder: '固定电话', rules: telephoneValidation } as UiTextItem,\r\n            mobile: { widget: 'text', label: '手机号', placeholder: '手机号', rules: mobileValidation } as UiTextItem,\r\n            email: { widget: 'text', label: 'Email', rules: emailValidation, placeholder: 'Email' } as UiTextItem,\r\n            fax: { widget: 'text', label: '传真', placeholder: '传真', rules: faxValidation } as UiTextItem,\r\n            address: {\r\n                widget: 'id', label: '所在地区', placeholder: '所在地区',\r\n                pickId: async (context: Context, name: string, value: number) => await pickAddress(context, name, value),\r\n                Templet: (address: BoxId) => {\r\n                    if (!address) return <small className=\"text-muted\">(无)</small>;\r\n                    return tv(address, (addressValue) => {\r\n                        let { country, province, city, county } = addressValue;\r\n                        /* 下面这种在使用tv之前的一堆判断应该是tv或者什么的有bug, 应该让Henry改改 */\r\n                        return <>\r\n                            {country !== undefined && country.id !== undefined && tv(country, v => <>{v.chineseName}</>)}\r\n                            {province !== undefined && province.id !== undefined && tv(province, (v) => <>{v.chineseName}</>)}\r\n                            {city !== undefined && city.id !== undefined && tv(city, (v) => <>{v.chineseName}</>)}\r\n                            {county !== undefined && county.id !== undefined && tv(county, (v) => <>{v.chineseName}</>)}\r\n                        </>;\r\n                    }, () => {\r\n                        return <small className=\"text-muted\">请选择地区</small>;\r\n                    })\r\n                }\r\n            } as UiIdItem,\r\n            addressString: { widget: 'text', label: '详细地址', placeholder: '详细地址', rules: addressDetailValidation } as UiTextItem,\r\n            zipCode: { widget: 'text', label: '邮编', placeholder: '邮编', rules: zipCodeValidation } as UiTextItem,\r\n        }\r\n    }\r\n}","import * as React from 'react';\r\nimport logo from '../images/logo.png';\r\n\r\nexport const jnkTop = <div className=\"d-flex align-items-center position-relative\">\r\n    <img className=\"h-3c position-absolute\" src={logo} alt=\"百灵威\" />\r\n    <div className=\"h3 flex-fill text-center\">\r\n        <span className=\"text-primary mr-3\">百灵威</span>\r\n    </div>\r\n</div>;\r\n","import * as React from 'react';\r\nimport { tv } from 'tonva';\r\n\r\nexport const tvAddress = (values: any) => {\r\n    let { country, province, city, county } = values;\r\n    return <>\r\n        {tv(country)}{tv(province, undefined, undefined, () => <></>)}{tv(city, undefined, undefined, () => <></>)}{tv(county, undefined, undefined, () => <></>)}\r\n    </>\r\n}\r\n\r\nexport const tvCountry = (values: any) => {\r\n    return <> {values.chineseName} </>;\r\n}\r\n\r\nexport const tvCurrency = (values: any) => {\r\n    return <> {values.name} </>;\r\n}\r\n\r\nexport const common = {\r\n    address: tvAddress,\r\n    country: tvCountry,\r\n    province: tvCountry,\r\n    city: tvCountry,\r\n    county: tvCountry,\r\n    currency: tvCurrency,\r\n};\r\n","import * as React from 'react';\r\nimport { tv } from 'tonva';\r\nimport { ProductImage } from 'tools/productImage';\r\n\r\nexport const tvProduct = (values: any) => {\r\n    let product = values;\r\n    let { brand, description, CAS, purity, molecularFomula, molecularWeight, origin, imageUrl } = product;\r\n    return <div className=\"row d-flex\">\r\n        <div className=\"col-12\">\r\n            <div className=\"row py-2\">\r\n                <div className=\"col-12\"><strong>{description}</strong></div>\r\n            </div>\r\n            <div className=\"row\">\r\n                <div className=\"col-3\">\r\n                    <ProductImage chemicalId={imageUrl} className=\"w-100\" />\r\n                </div>\r\n                <div className=\"col-9\">\r\n                    <div className=\"row\">\r\n                        {item('CAS', CAS)}\r\n                        {item('纯度', purity)}\r\n                        {item('分子式', molecularFomula)}\r\n                        {item('分子量', molecularWeight)}\r\n                        {item('产品编号', origin)}\r\n                        {tv(brand, (values: any) => <>{item(\"品牌\", values.name)}</>)}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n};\r\n\r\nconst tvPackx = (values: any) => {\r\n    let { radiox, radioy, unit } = values;\r\n    if (radiox !== 1) return <>{radiox} * {radioy}{unit}</>;\r\n    return <>{radioy}{unit}</>;\r\n}\r\n\r\nfunction item(caption: string, value: any) {\r\n    if (value === null || value === undefined) return null;\r\n    return <>\r\n        <div className=\"col-4 text-muted pr-0\">{caption}:</div>\r\n        <div className=\"col-8\">{value}</div>\r\n    </>;\r\n}\r\n\r\nconst tvProductCategory = (values: any) => {\r\n    let { children } = values;\r\n    return <>\r\n        aaa\r\n    </>\r\n};\r\n\r\nexport const product = {\r\n    productx: tvProduct,\r\n    packx: tvPackx,\r\n    productCategory: tvProductCategory,\r\n}\r\n","import * as React from 'react';\r\nimport { tv } from 'tonva';\r\nimport { tvAddress, tvCountry } from './common';\r\n\r\nexport const tvContact = (values: any) => {\r\n    let { name, mobile, organizationName, address, addressString } = values;\r\n    return <div className=\"flex-grow-1\">\r\n        <b>\r\n            {name}\r\n        </b>\r\n        &nbsp; {mobile} &nbsp; {organizationName}<br />\r\n        <small>{tv(address)} {addressString}</small>\r\n    </div>\r\n}\r\n\r\nexport const tvInvoiceType = (values: any) => {\r\n    let { id, description } = values;\r\n    return <div className=\"flex-grow-1\">\r\n        {description}\r\n    </div>\r\n}\r\n\r\nexport const tvInvoiceInfo = (values: any) => {\r\n    let { title, taxNo } = values;\r\n    return <div className=\"flex-grow-1\">\r\n        <b>\r\n            {title}\r\n        </b>\r\n        &nbsp; {taxNo}\r\n    </div>\r\n}\r\n\r\nexport const customer = {\r\n    contact: tvContact,\r\n    address: tvAddress,\r\n    country: tvCountry,\r\n    province: tvCountry,\r\n    city: tvCountry,\r\n    county: tvCountry,\r\n    invoiceInfo: tvInvoiceInfo,\r\n    invoiceType: tvInvoiceType\r\n}\r\n","import { AppConfig } from \"tonva\";\r\nimport { jnkTop } from \"./me/loginTop\";\r\nimport { tvs } from \"./tvs\";\r\nimport { GLOABLE } from \"cartenv\";\r\n\r\nexport { CApp } from './CApp';\r\n\r\nexport const appConfig: AppConfig = {\r\n    appName: '百灵威系统工程部/cart',\r\n    version: '1.1.93',\r\n    tvs: tvs,\r\n    loginTop: jnkTop,\r\n    oem: '百灵威',\r\n    privacy: GLOABLE.PIRVACYURL\r\n};","import { TVs } from \"tonva\";\r\nimport { common } from \"./common\";\r\nimport { warehouse } from \"./warehouse\";\r\nimport { product } from \"./product\";\r\nimport { order } from \"./order\";\r\nimport { customer } from './customer';\r\n\r\nexport const tvs:TVs = {\r\n    common: common,\r\n    warehouse: warehouse,\r\n    product: product,\r\n    order: order,\r\n    customer: customer,\r\n}","import * as React from 'react';\r\n\r\nconst tvWarehouse = (values: any) => {\r\n    let { name } = values;\r\n    return <div>\r\n        {name}\r\n    </div>\r\n}\r\n\r\nexport const warehouse = {\r\n    warehouse: tvWarehouse,\r\n}\r\n","import { tvProduct } from \"./product\";\r\nimport { tvAddress, tvCountry, tvCurrency } from \"./common\";\r\nimport { tvContact } from \"./customer\";\r\n\r\nexport const order = {\r\n    productx: tvProduct,\r\n    address: tvAddress,\r\n    country: tvCountry,\r\n    province: tvCountry,\r\n    city: tvCountry,\r\n    county: tvCountry,\r\n    contact: tvContact,\r\n    currency: tvCurrency,\r\n}\r\n","import * as React from 'react';\r\nimport { Page } from 'tonva';\r\nimport logo from '../images/logo.png';\r\nimport { appConfig } from 'configuration';\r\n\r\nexport class AboutThisApp extends React.Component {\r\n    render() {\r\n        let right = null;\r\n        return <Page header=\"关于百灵威购物APP\" right={right}>\r\n            <div className='bg-white p-3'>\r\n                <div className=\"h3 flex-fill text-center\">\r\n                    <img src={logo} />\r\n                </div>\r\n                <div className=\"h3 flex-fill text-center\">\r\n                    <span className=\"text-primary mr-3\">百灵威购物APP</span>\r\n                </div>\r\n                <div className=\"h3 flex-fill text-center small\">\r\n                    <span className=\"text-muted mr-3\">V{appConfig.version}</span>\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}","import * as React from 'react';\r\nimport { nav, User, Page, Image, VPage } from 'tonva';\r\nimport { Prop, Media, IconText, FA, PropGrid, LMR } from 'tonva';\r\nimport { About } from './about';\r\nimport { ContactUs } from './contactUs';\r\nimport { observer } from 'mobx-react';\r\nimport { EditMeInfo } from './EditMeInfo';\r\nimport { CMe } from './CMe';\r\nimport { AboutThisApp } from './aboutThisApp';\r\nimport { appConfig } from 'configuration';\r\n\r\nexport class VMe extends VPage<CMe> {\r\n\r\n    async open(param?: any) {\r\n\r\n    }\r\n\r\n    private exit() {\r\n        nav.showLogout();\r\n    }\r\n\r\n    private about = () => nav.push(<About />);\r\n    private contactUs = () => nav.push(<ContactUs />);\r\n    private privacy = () => {\r\n        this.controller.openPrivacy();\r\n    }\r\n    private aboutThisApp = () => nav.push(<AboutThisApp />);\r\n\r\n    private changePassword = async () => {\r\n        await nav.changePassword();\r\n    }\r\n\r\n    private openContactList = async () => {\r\n        this.controller.openContactList();\r\n    }\r\n\r\n    private openInvoice = async () => {\r\n        this.controller.openInvoice();\r\n    }\r\n\r\n    private openMyPoint = async () => {\r\n        this.controller.openMyPoint();\r\n    }\r\n\r\n    private meInfo = observer(() => {\r\n        let { user } = nav;\r\n        if (user === undefined) return null;\r\n        let { id, name, nick, icon } = user;\r\n        return <LMR className=\"px-3 py-2 cursor-pointer w-100 bg-primary text-white\"\r\n            left={<Image className=\"w-3c h-3c mr-3\" src={icon} />}\r\n            right={<FA className=\"align-self-end\" name=\"angle-right\" />}\r\n            onClick={() => {\r\n                this.openVPage(EditMeInfo);\r\n            }}>\r\n            <div>\r\n                <div>{userSpan(name, nick)}</div>\r\n                <div className=\"small\"><span className=\"text-light\">ID:</span> {id > 10000 ? id : String(id + 10000).substr(1)}</div>\r\n            </div>\r\n        </LMR>;\r\n    });\r\n\r\n    private orderStates = () => {\r\n        let { openMyOrders } = this.controller;\r\n        let oss = [\r\n            { caption: '待审核', state: 'processing', icon: 'desktop' },\r\n            { caption: '待发货', state: 'completed', icon: 'truck' },\r\n            { caption: '所有订单', state: 'all', icon: 'file-text-o' },\r\n        ];\r\n\r\n        return <div className=\"d-flex justify-content-around w-100 my-3\">\r\n            {\r\n                oss.map(((os, index) => {\r\n                    let { caption, state, icon } = os;\r\n                    return <div key={index} className=\"flex-fill d-flex flex-column align-items-center cursor-pointer\"\r\n                        onClick={() => openMyOrders(state)}>\r\n                        <FA name={icon} className=\"text-info fa-2x\" />\r\n                        <small>{caption}</small>\r\n                    </div>;\r\n                }))\r\n            }\r\n        </div>\r\n    };\r\n\r\n    render() {\r\n        return <this.page />;\r\n    }\r\n    content() {\r\n        return <this.page />;\r\n    }\r\n    header() {\r\n        return <this.meInfo />;\r\n    }\r\n\r\n    private page = observer(() => {\r\n        const { user } = nav;\r\n        let aboutRows: Prop[] = [\r\n            '',\r\n            {\r\n                type: 'component',\r\n                component: <IconText iconClass=\"text-info mr-2\" icon=\"phone\" text=\"联系我们\" />,\r\n                onClick: this.contactUs\r\n            },\r\n            {\r\n                type: 'component',\r\n                component: <IconText iconClass=\"text-info mr-2\" icon=\"smile-o\" text=\"关于百灵威\" />,\r\n                onClick: this.about\r\n            },\r\n            {\r\n                type: 'component',\r\n                component: <IconText iconClass=\"text-info mr-2\" icon=\"smile-o\" text=\"隐私政策\" />,\r\n                onClick: this.privacy\r\n            },\r\n            {\r\n                type: 'component',\r\n                component: <div className=\"w-100 d-flex justify-content-between\" onClick={this.aboutThisApp}>\r\n                    <IconText iconClass=\"text-info mr-2\" icon=\"smile-o\" text=\"关于本APP\" />\r\n                    <div className=\"py-2 small\">V{appConfig.version}</div>\r\n                </div>,\r\n            },\r\n            ''\r\n        ];\r\n\r\n        let rows: Prop[];\r\n        if (user === undefined) {\r\n            let { showLogin } = this.controller;\r\n            rows = aboutRows;\r\n            rows.push(\r\n                {\r\n                    type: 'component',\r\n                    component: <button className=\"btn btn-success w-100 my-2\" onClick={() => showLogin()}>\r\n                        <FA name=\"sign-out\" size=\"lg\" /> 请登录\r\n                    </button>\r\n                },\r\n            );\r\n        }\r\n        else {\r\n            let logOutRows: Prop[] = [\r\n                '',\r\n                {\r\n                    type: 'component',\r\n                    bk: '',\r\n                    component: <div className=\"text-center flex-fill\"><button className=\"btn btn-danger w-75\" onClick={this.exit}>\r\n                        <FA name=\"sign-out\" size=\"lg\" /> 退出登录\r\n\t\t\t\t\t\t</button>\r\n                    </div>\r\n                },\r\n            ];\r\n\r\n            rows = [\r\n\t\t\t\t/*\r\n                '',\r\n                {\r\n                    type: 'component',\r\n                    component: <this.meInfo />\r\n\t\t\t\t},\r\n\t\t\t\t*/\r\n                '',\r\n                {\r\n                    type: 'component',\r\n                    component: <>{this.orderStates()}</>,\r\n                },\r\n                '',\r\n                {\r\n                    type: 'component',\r\n                    component: <IconText iconClass=\"text-info mr-2\" icon=\"address-book-o\" text=\"地址管理\" />,\r\n                    onClick: this.openContactList\r\n                },\r\n                {\r\n                    type: 'component',\r\n                    component: <IconText iconClass=\"text-info mr-2\" icon=\"address-book-o\" text=\"发票管理\" />,\r\n                    onClick: this.openInvoice\r\n                },\r\n                {\r\n                    type: 'component',\r\n                    component: <IconText iconClass=\"text-info mr-2\" icon=\"address-book-o\" text=\"积分管理\" />,\r\n                    onClick: this.openMyPoint\r\n                },\r\n                '',\r\n                {\r\n                    type: 'component',\r\n                    component: <IconText iconClass=\"text-info mr-2\" icon=\"key\" text=\"修改密码\" />,\r\n                    onClick: this.changePassword\r\n                },\r\n            ]\r\n            rows.push(...aboutRows, ...logOutRows);\r\n        }\r\n        return <PropGrid rows={rows} values={{}} />;\r\n    })\r\n}\r\n\r\n\r\nexport function userSpan(name: string, nick: string): JSX.Element {\r\n    return nick ?\r\n        <><b>{nick} &nbsp; <small className=\"muted\">{name}</small></b></>\r\n        : <b>{name}</b>\r\n}\r\n","import * as React from 'react';\r\nimport _ from 'lodash';\r\nimport { observable } from 'mobx';\r\nimport { ItemSchema, Page, VPage, FA, Form, Context } from 'tonva';\r\nimport { CMe } from './CMe';\r\nimport { webUserSchema, webUserUiSchema, webUserContactSchema, webUserContactUiSchema } from './EditMeInfo';\r\nimport { observer } from 'mobx-react';\r\nimport { GLOABLE } from 'cartenv';\r\n\r\ninterface Options {\r\n    onlyRequired: boolean;\r\n    caption: string;\r\n    note: string;\r\n    actionButton: {\r\n        value: string;\r\n        action: any;\r\n    }\r\n}\r\n\r\nexport class EditMeInfoFirstOrder extends VPage<CMe>{\r\n    private options: Options;\r\n    @observable tips: JSX.Element;\r\n    private form: Form;\r\n\r\n    async open(param: any) {\r\n        // this.onlyRequired = param;\r\n        this.options = param;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    @observable private webUserData: any;\r\n    @observable private webUserContactData: any;\r\n\r\n    constructor(props: any) {\r\n        super(props);\r\n\r\n        let { cApp } = this.controller;\r\n        let { firstName, gender, salutation, organizationName, departmentName, telephone\r\n            , mobile, email, fax, address, addressString, zipCode } = cApp.currentUser;\r\n        this.webUserData = {\r\n            firstName: firstName,\r\n            gender: gender,\r\n            salutation: salutation,\r\n            organizationName: organizationName,\r\n            departmentName: departmentName\r\n        };\r\n\r\n        this.webUserContactData = {\r\n            telephone: telephone,\r\n            mobile: mobile,\r\n            email: email,\r\n            fax: fax,\r\n            address: address,\r\n            addressString: addressString,\r\n            zipCode: zipCode\r\n        }\r\n    }\r\n\r\n    private onFormButtonClick = async (name: string, context: Context) => {\r\n        let { data } = context.form;\r\n        console.log(data);\r\n        _.merge(this.webUserData, data);\r\n        _.merge(this.webUserContactData, data);\r\n        await this.controller.changeWebUser(this.webUserData);\r\n        await this.controller.changeWebUserContact(this.webUserContactData);\r\n\r\n        let { currentUser } = this.controller.cApp;\r\n        if (currentUser.allowOrdering) {\r\n            this.closePage();\r\n            let webUserContacts = await currentUser.getContacts();\r\n            if (webUserContacts === undefined || webUserContacts.length === 0) {\r\n                await currentUser.addContactFromAccount();\r\n            }\r\n            await this.options.actionButton.action();\r\n        } else {\r\n            this.tips = <>以上带有 <span className='text-danger'>*</span> 的内容均须填写！</>;\r\n            setTimeout(() => {\r\n                this.tips = undefined;\r\n            }, GLOABLE.TIPDISPLAYTIME);\r\n        }\r\n    }\r\n\r\n\r\n    private onCompleted = async () => {\r\n        if (!this.form) return;\r\n        await this.form.buttonClick(\"submit\");\r\n    }\r\n\r\n    private page = observer(() => {\r\n\r\n        let tipsUI = <></>;\r\n        if (this.tips) {\r\n            tipsUI = <div className=\"alert alert-primary\" role=\"alert\">\r\n                <FA name=\"exclamation-circle\" className=\"text-warning float-left mr-3\" size=\"2x\"></FA>\r\n                {this.tips}\r\n            </div>\r\n        }\r\n\r\n        let { onlyRequired, caption, note, actionButton } = this.options;\r\n        let schemaFilter = (itemSchema: ItemSchema): boolean => {\r\n            return (onlyRequired === true && itemSchema.required === true)\r\n                || onlyRequired === undefined\r\n                || onlyRequired === false\r\n        }\r\n\r\n        let schemaArr = [];\r\n        for (let item of webUserSchema) {\r\n            if (item.required === true) schemaArr.push(item);\r\n        }\r\n        for (let item of webUserContactSchema) {\r\n            if (item.required === true) schemaArr.push(item);\r\n        }\r\n        if (onlyRequired !== true) {\r\n            for (let item of webUserSchema) {\r\n                if (item.required !== true) schemaArr.push(item);\r\n            }\r\n            for (let item of webUserContactSchema) {\r\n                if (item.required !== true) schemaArr.push(item);\r\n            }\r\n        }\r\n        let uiSchema = {};\r\n        _.merge(uiSchema, webUserUiSchema, webUserContactUiSchema(this.controller.pickAddress));\r\n\r\n        let data = _.merge(this.webUserData, this.webUserContactData);\r\n        let { value } = actionButton;\r\n        return <Page header={caption}>\r\n            <div className=\"alert alert-light my-3 py-4\" role=\"alert\">\r\n                <FA name=\"smile-o\" className=\"text-warning mr-4 my-1\" size=\"2x\" />\r\n                {note}\r\n            </div>\r\n\r\n            <div className=\"App-container container text-left\">\r\n                <Form ref={v => this.form = v} className=\"my-3\"\r\n                    schema={schemaArr.filter(schemaFilter)}\r\n                    uiSchema={uiSchema}\r\n                    formData={data}\r\n                    onButtonClick={this.onFormButtonClick}\r\n                    fieldLabelSize={3} />\r\n            </div>\r\n\r\n            <div className=\"p-3 bg-white\">\r\n                {tipsUI}\r\n                <button type=\"button\" className=\"btn btn-primary w-100\" onClick={() => this.onCompleted()}>{value}</button>\r\n            </div>\r\n        </Page >;\r\n    });\r\n}\r\n/*\r\n<Edit schema={schemaArr.filter(schemaFilter)} uiSchema={uiSchema}\r\n    data={data}\r\n    onItemChanged={this.onMergeDataChanged} />\r\n\r\n    private onMergeDataChanged = async (itemSchema: ItemSchema, newValue: any, preValue: any) => {\r\n        let { name } = itemSchema;\r\n        this.webUserContactData[name] = newValue;\r\n        this.webUserData[name] = newValue;\r\n        await this.controller.changeWebUser(this.webUserData);\r\n        await this.controller.changeWebUserContact(this.webUserContactData);\r\n    }\r\n*/","import * as React from 'react';\r\nimport { VPage, Page, Form, List, tv, ObjectSchema, NumSchema, UiSchema, UiCustom, FA } from 'tonva';\r\nimport { CPointProduct } from 'pointMarket/CPointProduct';\r\nimport { observer } from 'mobx-react-lite';\r\nimport { PointProductImage } from 'tools/productImage';\r\nimport { MinusPlusWidget } from 'tools';\r\nimport { observable } from 'mobx';\r\nimport { GLOABLE } from 'cartenv';\r\n\r\nexport class VPointProduct extends VPage<CPointProduct> {\r\n\r\n    @observable private productIsNull: boolean = false;\r\n    @observable private pointIsEnough: boolean = false;\r\n\r\n    async open(param?: any) {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private schema = [\r\n        { name: 'product', type: 'object' } as ObjectSchema,\r\n        { name: 'pack', type: 'object' } as ObjectSchema,\r\n        { name: 'quantity', type: 'number' } as NumSchema,\r\n        { name: 'point', type: 'number' } as NumSchema,\r\n        { name: 'imageUrl', type: 'object' } as ObjectSchema,\r\n    ];\r\n\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            product: { visible: false },\r\n            pack: { visible: false },\r\n            quantity: {\r\n                widget: 'custom',\r\n                label: null,\r\n                className: 'text-center',\r\n                WidgetClass: MinusPlusWidget,\r\n                onChanged: this.controller.onQuantityChanged as any\r\n            } as UiCustom,\r\n            point: { visible: false },\r\n            imageUrl: { visible: false }\r\n        }\r\n    }\r\n\r\n    private renderPointProduct = (pointProduct: any, index: number) => {\r\n        let { product, pack, point, imageUrl } = pointProduct;\r\n        return <>\r\n            {tv(product, (v) => {\r\n                return <div className=\"row m-1 w-100\">\r\n                    <div title={v.description} className=\"col-4 m-0 p-0\"><PointProductImage chemicalId={imageUrl} className=\"w-100\" /></div>\r\n                    {tv(pack, (c) => {\r\n                        return <div className=\"col-8 small\">\r\n                            <div>{v.descriptionC}</div>\r\n                            <div className=\"my-2\">{c.radioy}{c.unit}</div>\r\n                            <div className=\"row m-0 p-0\">\r\n                                <div className=\"col-5 m-0 p-0\">\r\n                                    <span className=\"text-danger h5\">{point}</span>\r\n                                    <small>分</small>\r\n                                </div>\r\n                                <div className=\"col-7 d-flex justify-content-end align-items-right m-0 p-0\">\r\n                                    <Form schema={this.schema} uiSchema={this.uiSchema} formData={pointProduct} className=\"mr-2\" />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    })}\r\n                </div>\r\n            })}\r\n        </>\r\n    }\r\n\r\n    private openExchangeOrder = async () => {\r\n        // 未选择产品\r\n        let { pointToExchanging, myEffectivePoints } = this.controller;\r\n\r\n        if (pointToExchanging < 1) {\r\n            this.productIsNull = true;\r\n            this.pointIsEnough = false;\r\n            setTimeout(() => this.productIsNull = false, GLOABLE.TIPDISPLAYTIME);\r\n            return;\r\n        }\r\n        // 积分不足\r\n        if (pointToExchanging > myEffectivePoints) {\r\n            this.productIsNull = false;\r\n            this.pointIsEnough = true;\r\n            setTimeout(() => this.pointIsEnough = false, GLOABLE.TIPDISPLAYTIME);\r\n            return;\r\n        }\r\n\r\n        this.controller.openExchangeOrder();\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let { pointProducts, pointToExchanging, myEffectivePoints } = this.controller;\r\n\r\n        let productIsNullTip = this.productIsNull ?\r\n            <div className=\"text-danger small my-2\"><FA name=\"exclamation-circle\" />未选择产品</div>\r\n            : null;\r\n        let pointIsEnoughTip = this.pointIsEnough ?\r\n            <div className=\"text-danger small m-0 p-0\"><FA name=\"exclamation-circle\" />积分不足<br />剩余{myEffectivePoints}分</div>\r\n            : null;\r\n\r\n        let footer = <div className=\"d-block\">\r\n            <div className=\"w-100 px-3 d-flex justify-content-between\">\r\n                <div>总计:<span className=\"text-danger ml-2 mr-1 h2\" >{pointToExchanging}</span>分</div>\r\n                <div>{productIsNullTip}{pointIsEnoughTip}</div>\r\n                <button type=\"button\" className=\"btn btn-danger m-1\" onClick={this.openExchangeOrder}>去兑换</button>\r\n            </div>\r\n        </div>;\r\n        return <Page header=\"积分商城\" footer={footer}>\r\n            <div>\r\n                <List items={pointProducts} item={{ render: this.renderPointProduct }} none=\"暂无可兑换产品\"></List>\r\n            </div>\r\n        </Page>;\r\n    });\r\n}","import * as React from 'react';\r\nimport { VPage, nav, Page, LMR, FA, tv, List } from 'tonva';\r\nimport { CPointProduct } from './CPointProduct';\r\nimport { observer } from 'mobx-react-lite';\r\nimport { observable } from 'mobx';\r\nimport { PointProductImage } from 'tools/productImage';\r\nimport { GLOABLE } from 'cartenv';\r\n\r\nexport class VExchangeOrder extends VPage<CPointProduct> {\r\n    @observable private shippingAddressIsBlank: boolean = false;\r\n\r\n    async open(param?: any) {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private nullContact = () => {\r\n        return <span className=\"text-primary\">选择收货地址</span>;\r\n    }\r\n\r\n    private renderPointProduct = (pointProduct: any, index: number) => {\r\n        let { product, pack, quantity, point, imageUrl } = pointProduct;\r\n        if (quantity > 0) {\r\n            return <>\r\n                {tv(product, (v) => {\r\n                    return <div className=\"row m-1 w-100\">\r\n                        <div title={v.description} className=\"col-4 m-0 p-0\"><PointProductImage chemicalId={imageUrl} className=\"w-100\" /></div>\r\n                        {tv(pack, (c) => {\r\n                            return <div className=\"col-8 small\">\r\n                                <div>{v.descriptionC}</div>\r\n                                <div className=\"d-flex justify-content-between my-3\">\r\n                                    <div className=\"mt-1\"><b>{c.radioy}{c.unit}</b></div>\r\n                                    <div>\r\n                                        <span className=\"text-danger h5\">{(point * quantity)}</span>\r\n                                        <small className=\"text-muted\">分 ({point} × {quantity})</small>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        })}\r\n                    </div>\r\n                })}\r\n            </>;\r\n        }\r\n    }\r\n\r\n    private onSubmit = async () => {\r\n        let { orderData } = this.controller;\r\n        // 必填项验证\r\n        let { shippingContact } = orderData;\r\n        if (!shippingContact) {\r\n            this.shippingAddressIsBlank = true;\r\n            setTimeout(() => this.shippingAddressIsBlank = false, GLOABLE.TIPDISPLAYTIME);\r\n            return;\r\n        }\r\n        this.controller.submitOrder();\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let { pointProductsSelected, pointToExchanging: pointsSum, orderData, onSelectShippingContact } = this.controller;\r\n        let chevronRight = <FA name=\"chevron-right\" className=\"cursor-pointer\" />\r\n        let shippingAddressBlankTip = this.shippingAddressIsBlank ?\r\n            <div className=\"text-danger small my-2\"><FA name=\"exclamation-circle\" /> 必须填写收货地址</div>\r\n            : null;\r\n\r\n        let footer = <div className=\"d-block\">\r\n            <div className=\"w-100 px-3 d-flex justify-content-between\">\r\n                <div>总计:<span className=\"text-danger ml-2 mr-1 h2\" >{pointsSum}</span>分</div>\r\n                <button type=\"button\" className=\"btn btn-danger m-1\" onClick={this.onSubmit}>确认兑换</button>\r\n            </div>\r\n        </div>;\r\n\r\n        return <Page header=\"确认兑换信息\" footer={footer}>\r\n            <div className=\"px-2\">\r\n                <div className=\"row py-3 bg-white mb-1\" onClick={onSelectShippingContact}>\r\n                    <div className=\"col-3 text-muted pr-0\">收货地址:</div>\r\n                    <div className=\"col-9 col-sm-10\">\r\n                        <LMR className=\"w-100 align-items-center\" right={chevronRight}>{tv(orderData.shippingContact, undefined, undefined, this.nullContact)}</LMR>\r\n                        {shippingAddressBlankTip}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <List items={pointProductsSelected} item={{ render: this.renderPointProduct }} ></List>\r\n        </Page>\r\n    })\r\n}","import * as React from 'react';\r\nimport { Page } from 'tonva';\r\n\r\nexport class VPointRule extends React.Component {\r\n\r\n    render() {\r\n        return <Page header=\"积分规则\">\r\n            <div className='bg-white p-3'>\r\n                <ol className=\"mb-3\">\r\n                    <li>订购产品满1元积1分（活动期间积分按活动规则执行），积分按消费额累计；付款后，积分变为有效积分，可以使用；</li>\r\n                    <li>特价产品、产业型产品等不产生积分；</li>\r\n                    <li>积分有效期为自然年三年，过期作废（示例：2010年1-12月份产生的积分在2012年12月31日作废清零，以此类推）；</li>\r\n                    <li>积分目前仅限兑换百灵威积分商城中的产品使用，不兑换现金；</li>\r\n                    <li>此积分政策只针对百灵威终端客户，经销商等不产生积分；</li>\r\n                </ol>\r\n                <div className=\"text-muted small\">\r\n                    <p>百灵威保留本积分活动中条款的解释权利，并有根据需要取消本活动或增删、修订本规定的权利，并于百灵威官网、邮件、报纸或其他途径公告后生效。</p>\r\n                    <p>如有疑问，请致电百灵威客服中心：400-666-7788</p>\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}","import * as React from 'react';\r\nimport { VPage, Page, nav, DropdownActions, DropdownAction } from \"tonva\";\r\nimport { CPointProduct } from \"./CPointProduct\";\r\nimport { observer } from 'mobx-react-lite';\r\nimport { observable } from 'mobx';\r\nimport { VPointRule } from './VPointRule';\r\n\r\nexport class VMyPoint extends VPage<CPointProduct> {\r\n    @observable private openMyPointList: boolean = false;\r\n\r\n    async open(param?: any) {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private openPointProduct = async () => {\r\n        this.controller.openPointProduct();\r\n    }\r\n    private openExchangeHistory = async () => {\r\n        this.controller.openExchangeHistory();\r\n    }\r\n\r\n    /**\r\n     * 打开领取积分界面 \r\n     */\r\n    private openPointDrawing = async () => {\r\n        this.controller.openPointDrawing();\r\n    }\r\n\r\n    private pointRules = () => nav.push(<VPointRule />);\r\n\r\n    private page = observer(() => {\r\n        let { myEffectivePoints, myPointTobeExpired, myTotalPoints } = this.controller;\r\n        var date = new Date();\r\n        let dateYear = date.getFullYear();\r\n\r\n        let nowPoint = myPointTobeExpired;\r\n        let nowPointTip = nowPoint > 0 ?\r\n            <div className=\"alert alert-warning m-2\" role=\"alert\">\r\n                <span className=\"text-muted\">友情提示: 将有{nowPoint}积分于{dateYear}-12-31过期</span>\r\n            </div>\r\n            : null;\r\n        let actions: DropdownAction[] = [\r\n            {\r\n                icon: 'get-pocket',\r\n                caption: '领取积分',\r\n                action: this.openPointDrawing\r\n            },\r\n            {\r\n                icon: 'history',\r\n                caption: '兑换记录',\r\n                action: this.openExchangeHistory\r\n            },\r\n            {\r\n                icon: 'book',\r\n                caption: '积分规则',\r\n                action: this.pointRules\r\n            }\r\n        ];\r\n        let right = <DropdownActions className=\"align-self-center mr-1\" icon=\"navicon\" actions={actions} />;\r\n        return <Page header=\"积分管理\" right={right}>\r\n            <div className=\"bg-white h-100\">\r\n                <div className=\"d-flex flex-column align-items-center py-5 point-main-top\">\r\n                    <div className=\"text-white text-center\">\r\n                        <small>当前</small> <span className=\"h2\">{myEffectivePoints}</span> <small>分可用</small>\r\n                        <br />\r\n                        {myTotalPoints > 0 ? <small>总分: {myTotalPoints}</small> : null}\r\n                    </div>\r\n                    <div className=\"mt-3\">\r\n                        <button className=\"btn btn-light\" onClick={this.openPointProduct}>\r\n                            <label className=\"m-0 p-0\">积分兑换</label>\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n                {nowPointTip}\r\n            </div>\r\n        </Page >;\r\n    });\r\n}\r\n","import * as React from 'react';\r\nimport { VPage, Page } from 'tonva';\r\nimport { CPointProduct } from './CPointProduct';\r\n\r\nexport class OrderSuccess extends VPage<CPointProduct> {\r\n\r\n    async open(orderCreateResult: any) {\r\n        this.openPage(this.page, orderCreateResult);\r\n    }\r\n\r\n    private page = (orderCreateResult: any) => {\r\n        return <Page header=\"兑换成功\" back=\"close\">\r\n            <div className=\"p-3 bg-white mb-3\">\r\n                <div className=\"mb-3\">兑换成功，感谢您对百灵威的厚爱！</div>\r\n                <p className=\"\">\r\n                    订单: <span className=\"h5 text-info\">{orderCreateResult.no}</span><br /><br />\r\n                    我们将立刻处理您的订单，请注意查收到货短信。\r\n                </p>\r\n            </div>\r\n        </Page>\r\n    }\r\n}","import { BoxId } from 'tonva';\r\nimport { observable, computed } from 'mobx';\r\n\r\nexport class pointOrder {\r\n\r\n    webUser: any;   // OK\r\n    organization: BoxId;\r\n    customer: any;  //OK\r\n    salesRegion: BoxId;   // OK\r\n\r\n    @observable shippingContact: BoxId; //OK\r\n    @observable exchangeItems: OrderItem[] = [];\r\n\r\n    @computed get amount() {\r\n        return this.exchangeItems.reduce((pv, cv) => (pv + cv.subAmount), 0);\r\n    };\r\n\r\n    getDataForSave() {\r\n        let exchangeItems: any[] = [];\r\n        this.exchangeItems.forEach(oi => {\r\n            exchangeItems.push({\r\n                product: oi.product, pack: oi.pack, point: oi.point, quantity: oi.quantity\r\n                , subAmount: oi.quantity * oi.point\r\n            })\r\n        });\r\n        return {\r\n            webUser: this.webUser,\r\n            organization: this.organization,\r\n            customer: this.customer,\r\n            shippingContact: this.shippingContact,\r\n            amount: this.amount,\r\n            exchangeitems: exchangeItems, // 前面的必须是小写的\r\n            salesRegion: this.salesRegion\r\n        }\r\n    }\r\n}\r\n\r\nexport class OrderItem {\r\n    product: BoxId;\r\n    @observable pack: BoxId;\r\n    @observable quantity: any;\r\n    @observable point: any;\r\n    @computed get subAmount() {\r\n        return this.quantity * this.point;\r\n    }\r\n}","import * as React from 'react';\r\nimport { VPage, Page, EasyDate } from 'tonva';\r\nimport { CPointProduct } from './CPointProduct';\r\nimport { tv, List } from 'tonva';\r\nimport { OrderItem } from './pointOrder';\r\nimport { PointProductImage } from 'tools/productImage';\r\n\r\nexport class VExchangeHistoryDetail extends VPage<CPointProduct> {\r\n\r\n    async open(order: any) {\r\n\r\n        this.openPage(this.page, order);\r\n    }\r\n\r\n    private renderexchangeItem = (orderItem: OrderItem) => {\r\n        let { product, pack, quantity, point } = orderItem;\r\n        return <>\r\n            {tv(product, (v) => {\r\n                return <div className=\"row m-1 w-100\">\r\n                    {/* <div title={v.description} className=\"col-4 m-0 p-0\"><ProductImage chemicalId={v.imageUrl} className=\"w-100\" /></div> */}\r\n                    <div title={v.description} className=\"col-4 m-0 p-0\"><PointProductImage chemicalId={v.imageUrl} className=\"w-100\" /></div>\r\n                    {tv(pack, (c) => {\r\n                        return <div className=\"col-8 small\">\r\n                            <div><label>{v.descriptionC}</label></div>\r\n                            <div className=\"d-flex justify-content-between my-3\">\r\n                                <div className=\"mt-1\"><b>{c.radioy}{c.unit}</b></div>\r\n                                <div>\r\n                                    <span className=\"text-danger h6\">{(point * quantity)}</span>\r\n                                    <small className=\"text-muted\">分 ({point} × {quantity})</small>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    })}\r\n                </div>\r\n            })}\r\n        </>;\r\n    }\r\n\r\n    private page = (order: any) => {\r\n        let { brief, data } = order;\r\n        let { no, date } = brief;\r\n        let { exchangeitems, shippingContact, amount } = data;\r\n\r\n        let header = <>订单详情: {no}</>\r\n        return <Page header={header}>\r\n            <List items={exchangeitems} item={{ render: this.renderexchangeItem }} />\r\n            <div className=\"bg-white row no-gutters p-3 my-1\">\r\n                <div className=\"col-3 text-muted\">收货地址:</div>\r\n                <div className=\"col-9\">{tv(shippingContact)}</div>\r\n            </div>\r\n            <div className=\"bg-white row no-gutters p-3 my-1\">\r\n                <div className=\"col-3 text-muted\">下单时间:</div>\r\n                <div className=\"col-9 text-right\"><EasyDate date={date} /></div>\r\n            </div>\r\n            <div className=\"bg-white p-3 my-1 text-right\">\r\n                <span className=\"text-danger font-weight-bold\">总积分: {amount}</span>\r\n            </div>\r\n        </Page>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { VPage, Page, EasyDate } from 'tonva';\r\nimport { CPointProduct } from './CPointProduct';\r\nimport { List } from 'tonva';\r\nimport { observer } from 'mobx-react-lite';\r\n\r\nexport class VExchangeHistory extends VPage<CPointProduct> {\r\n\r\n    private exchangeHistory: any[] = [];        /*积分产品列表 */\r\n    async open(param?: any) {\r\n        this.exchangeHistory = param;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderExchangeHistory = (pointProduct: any, index: number) => {\r\n        let { openOrderDetail } = this.controller;\r\n        let { id, no, date } = pointProduct;\r\n        return <div className=\"p-3 justify-content-between\">\r\n            <div className=\"mr-5\" onClick={() => openOrderDetail(id)}><span className=\"small text-muted\">兑换单号: </span><strong>{no}</strong></div>\r\n            <div className=\"small text-muted\"><EasyDate date={date} /></div>\r\n        </div>;\r\n    }\r\n\r\n    private page = observer(() => {\r\n        return <Page header=\"兑换历史记录\">\r\n            <List items={this.exchangeHistory} item={{ render: this.renderExchangeHistory }} none=\"暂无记录\"></List>\r\n        </Page>;\r\n    });\r\n}","import * as React from 'react';\r\nimport { CPointProduct } from './CPointProduct';\r\nimport { VPage, Page, FA } from 'tonva';\r\n\r\nexport class VReceivePointSuccess extends VPage<CPointProduct> {\r\n\r\n    private tip: string;\r\n    async open(param: any) {\r\n        this.tip = param;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = () => {\r\n        return <Page header=\"领取积分成功\" back=\"close\">\r\n            <div className=\"py-4 px-3 bg-white mb-3 d-flex\">\r\n                <FA name=\"list-alt\" className=\"text-success mr-3\" size=\"4x\" />\r\n                <div>\r\n                    <p className=\"text-primary\"><span className=\"h4\">领取成功！</span></p>\r\n                    <p className=\"\">\r\n                        {this.tip}\r\n                    </p>\r\n                </div>\r\n            </div>\r\n        </Page>\r\n    }\r\n}","import React from \"react\";\r\nimport { VPage, Page, FA, List, tv, LMR } from \"tonva\";\r\nimport { CPointProduct } from \"./CPointProduct\";\r\nimport { observer } from \"mobx-react-lite\";\r\nimport { observable } from \"mobx\";\r\nimport { GLOABLE } from \"cartenv\";\r\nimport { VReceivePointSuccess } from \"./VReceivePointSuccess\";\r\n\r\nexport class VPlatformOrderPoint extends VPage<CPointProduct> {\r\n\r\n    private couponInput: HTMLInputElement;\r\n    private currentCredits: string;\r\n    @observable tips: string;\r\n\r\n    async open(param?: any) {\r\n        this.currentCredits = param;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private openPlatformOrderPoint = async () => {\r\n        this.controller.openPointDrawing();\r\n    }\r\n\r\n    private tryApplyCoupon = async () => {\r\n\r\n        this.tips = \"\";\r\n        let coupon = this.couponInput.value;\r\n        if (!coupon) {\r\n            this.tips = '请填写积分码';\r\n            setTimeout(() => this.tips = undefined, GLOABLE.TIPDISPLAYTIME);\r\n            return;\r\n        }\r\n\r\n        let options = {\r\n            onlyRequired: true,\r\n            caption: \"第一次领取积分\",\r\n            note: <>\r\n                请提供信息，以便自动为您最近的内部订单积分。\r\n            </>,\r\n            actionButton: {\r\n                value: \"确定\",\r\n                action: this.applyCoupon\r\n            }\r\n        };\r\n        let { userInfoCompletedChecking } = this.controller;\r\n        if (userInfoCompletedChecking(options)) {\r\n            await this.applyCoupon();\r\n        }\r\n    }\r\n\r\n    private applyCoupon = async () => {\r\n\r\n        let { IsCouponCanUse, getLastPlatformOrder, receivePoint, addUsedCoupon, refreshMypoint } = this.controller;\r\n\r\n        let coupon = this.couponInput.value;\r\n        coupon = coupon.replace(' ', '');\r\n        let retCoupon = await IsCouponCanUse(coupon);\r\n        let tip = \"\";\r\n        if (retCoupon !== 1) {\r\n            switch (retCoupon) {\r\n                case -1:\r\n                    tip = '对不起，当前服务器繁忙，请稍后再试。';\r\n                    break;\r\n                case 0:\r\n                case 2:\r\n                case 4:\r\n                case 6:\r\n                    tip = '您输入的积分码无效，请重新输入！';\r\n                    break;\r\n                case 3:\r\n                case 5:\r\n                    tip = '您输入的积分码无效，请重新输入或与您的专属销售人员联系！';\r\n                    break;\r\n                case 100:\r\n                    tip = '您已经使用过该积分码了，不可重复使用。'\r\n                default:\r\n                    break;\r\n            }\r\n            this.tips = tip;\r\n            setTimeout(() => this.tips = undefined, GLOABLE.TIPDISPLAYTIME);\r\n            return;\r\n        }\r\n\r\n        let lastPlatformOrderId = undefined; // = await getLastPlatformOrder();\r\n        if (lastPlatformOrderId) {\r\n            let rtn = await receivePoint(lastPlatformOrderId);\r\n            if (rtn === 1) {\r\n                this.controller.platformOrder = [];\r\n                tip = \"提取成功，积分稍后到账！\";\r\n                await refreshMypoint();\r\n            }\r\n        } else {\r\n            // 无可用订单,保存积分码\r\n            let Crtn = await addUsedCoupon();\r\n            tip = \"积分码已记录，此积分码会在7日内首次下单时自动使用。\";\r\n        }\r\n        this.closePage();\r\n        this.openVPage(VReceivePointSuccess, tip);\r\n    }\r\n\r\n    private renderPlatformOrder = (PlatformOrder: any, index: number) => {\r\n        let { description, price, quantity, radioy, unit } = PlatformOrder;\r\n        return <div className=\"row\">\r\n            <div className=\"col-12\"><label>{description}</label></div>\r\n            <div className=\"col-12 d-flex justify-content-between\">\r\n                <div className=\"mt-1\"><b>{radioy}{unit}</b></div>\r\n                <div className=\"col-6 text-right\">\r\n                    <span className=\"text-danger h6\">{(price * quantity)}</span>\r\n                    <small className=\"text-muted\"> ({price} × {quantity})</small>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let { platformOrder } = this.controller;\r\n        let tipsUI;\r\n        if (this.tips) {\r\n            tipsUI = <div className=\"alert alert-primary\" role=\"alert\">\r\n                <FA name=\"smile-o\" className=\"text-warning mr-3\" size=\"2x\"></FA>\r\n                {this.tips}\r\n            </div>\r\n        }\r\n\r\n        return <Page header=\"领取积分\" right={null}>\r\n            <div>\r\n                <div className=\"px-2 pb-1 bg-white\">\r\n                    <div className=\"row py-2\">\r\n                        <div className=\"col-3 text-muted pr\">积分码:</div>\r\n                        <div className=\"col-9 d-flex pl-0\">\r\n                            <input ref={v => this.couponInput = v} type=\"text\" className=\"form-control\" value={this.currentCredits}></input>\r\n                        </div>\r\n                    </div>\r\n                    {\r\n                        platformOrder.length > 0 &&\r\n                        <div className=\"my-2 small\">\r\n                            <div>可用订单:</div>\r\n                            <List items={platformOrder} item={{ render: this.renderPlatformOrder }} none=\"系统中暂无可用订单\"></List>\r\n                        </div>\r\n                    }\r\n                    <div className=\"row py-2\">\r\n                        <div className=\"col-12\">\r\n                            <button className=\"btn btn-primary w-100\" onClick={this.tryApplyCoupon}>确认</button>\r\n                        </div>\r\n                    </div>\r\n                    {tipsUI}\r\n                    <div className=\"alert alert-info\">\r\n                        你在领取积分码后7个自然日内的第一个订单将获取到额外积分\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </Page >;\r\n    });\r\n}","import * as React from 'react';\r\nimport { BoxId, RowContext, nav, User } from 'tonva';\r\nimport { CUqBase } from 'CBase';\r\nimport { observable } from 'mobx';\r\nimport { VPointProduct } from 'pointMarket/VPointProduct';\r\nimport { VExchangeOrder } from './VExchangeOrder';\r\nimport { VMyPoint } from './VMyPoint';\r\nimport { CSelectShippingContact } from 'customer/CSelectContact';\r\nimport { OrderSuccess } from './OrderSuccess';\r\nimport { pointOrder, OrderItem } from './pointOrder';\r\nimport { VExchangeHistoryDetail } from './VExchangeHistoryDetail';\r\nimport { VExchangeHistory } from './VExchangeHistory';\r\nimport { VPlatformOrderPoint } from './VPlatformOrderPoint';\r\n\r\nexport class CPointProduct extends CUqBase {\r\n\r\n    @observable myPoints: any[] = [];              /*我的积分 */\r\n    @observable myEffectivePoints: number = 0;            /*我的积分(计算后) */\r\n    @observable myTotalPoints: number = 0;            /*我的积分(计算后) */\r\n    @observable myPointTobeExpired: number = 0;        /*我的快过期积分 */\r\n\r\n    @observable pointProducts: any[] = [];          /*可兑产品列表 */\r\n    @observable pointProductsSelected: any[] = [];  /*已选择产品列表 */\r\n    @observable pointToExchanging: number = 0;              /*将要兑换的积分总计 */\r\n    @observable orderData: pointOrder = new pointOrder();   /*正在提交的产品列表*/\r\n    @observable couponId: number;                   /*积分码 */\r\n    @observable platformOrderId: any;               /*平台合同号 */\r\n    @observable platformOrder: any[] = [];          /*平台合同 */\r\n\r\n    protected async internalStart(param: any) {\r\n        await this.refreshMypoint();\r\n        this.openVPage(VMyPoint);\r\n    }\r\n\r\n\r\n    refreshMypoint = async () => {\r\n        let { currentUser } = this.cApp;\r\n        this.myPoints = await currentUser.getPoints();\r\n        this.myEffectivePoints = this.myPoints.reduce((v, e) => { return v + e.effectiveLeftPoint }, 0);\r\n        this.myTotalPoints = this.myPoints.reduce((v, e) => { return v + e.totalLeftPoint }, 0)\r\n        let date = new Date();\r\n        let dateYear = date.getFullYear();\r\n        this.myPointTobeExpired = this.myPoints.reduce((v, e) => { return v + ((dateYear - e.pointYear) > 1 ? e.effectiveLeftPoint : 0) }, 0);\r\n    }\r\n\r\n    openPointProduct = async () => {\r\n        //清空选择的积分产品\r\n        this.orderData.exchangeItems = undefined;\r\n        this.pointProductsSelected.length = 0;\r\n        this.pointToExchanging = 0;\r\n        this.pointProducts = await this.getPointsProducts();\r\n        this.openVPage(VPointProduct);\r\n    }\r\n\r\n    openExchangeHistory = async () => {\r\n        let promises: PromiseLike<any>[] = [];\r\n        promises.push(this.uqs.积分商城.PointExchangeSheet.mySheets(undefined, 1, -20));\r\n        promises.push(this.uqs.积分商城.PointExchangeSheet.mySheets(\"#\", 1, -20));\r\n        let presult = await Promise.all(promises);\r\n        let exchangeHistory = presult[0].concat(presult[1]);\r\n        this.openVPage(VExchangeHistory, exchangeHistory);\r\n    }\r\n\r\n    openPointDrawing = async (credits?: string) => {\r\n        /* \r\n        let lastPlatformId = await this.getLastPlatformOrder();\r\n        if (lastPlatformId)\r\n            this.platformOrder = await this.getPlatFormOrder(this.platformOrderId);\r\n        */\r\n        this.openVPage(VPlatformOrderPoint, credits);\r\n    }\r\n\r\n    openExchangeOrder = async () => {\r\n        if (this.orderData.shippingContact === undefined) {\r\n            this.orderData.shippingContact = await this.getDefaultShippingContact();\r\n        }\r\n        this.openVPage(VExchangeOrder);\r\n    }\r\n\r\n    openOrderDetail = async (orderId: number) => {\r\n        let order = await this.uqs.积分商城.PointExchangeSheet.getSheet(orderId);\r\n        this.openVPage(VExchangeHistoryDetail, order);\r\n    }\r\n\r\n    renderOrderItemProduct = (product: BoxId) => {\r\n        let { cProduct } = this.cApp;\r\n        return cProduct.renderCartProduct(product);\r\n    }\r\n\r\n    getPointsProducts = async () => {\r\n        return await this.uqs.积分商城.GetPointProduct.table({});\r\n    }\r\n\r\n    onQuantityChanged = async (context: RowContext, value: any, prev: any) => {\r\n        let { data } = context;\r\n        let IsContain = 0;\r\n        let nowQuantity = value - (prev ? prev : 0);\r\n        this.pointToExchanging = this.pointToExchanging + (data.point * nowQuantity);\r\n\r\n        this.pointProductsSelected.forEach(element => {\r\n            if (element.pack.id === data.pack.id) {\r\n                element.quantity = element.quantity + nowQuantity;\r\n                IsContain = IsContain + 1;\r\n            }\r\n        });\r\n        if (IsContain === 0) {\r\n            this.pointProductsSelected.push(data);\r\n        }\r\n    }\r\n\r\n    private createOrderFromCart = async () => {\r\n        let { currentUser, currentSalesRegion } = this.cApp;\r\n        this.orderData.webUser = currentUser.id;\r\n        this.orderData.salesRegion = currentSalesRegion.id;\r\n        if (currentUser.currentCustomer !== undefined) {\r\n            this.orderData.customer = currentUser.currentCustomer.id;\r\n        }\r\n        if (this.pointProductsSelected !== undefined && this.pointProductsSelected.length > 0) {\r\n            this.orderData.exchangeItems = this.pointProductsSelected.map((e: any) => {\r\n                if (e.quantity > 0) {\r\n                    var item = new OrderItem();\r\n                    item.product = e.product;\r\n                    item.pack = e.pack;\r\n                    item.quantity = e.quantity;\r\n                    item.point = e.point;\r\n                    return item;\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 生成兑换单兑换积分\r\n     */\r\n    submitOrder = async () => {\r\n        this.createOrderFromCart();\r\n\r\n        let PointExchangeSheet = this.uqs.积分商城.PointExchangeSheet;\r\n        let getDataForSave = this.orderData.getDataForSave();\r\n        let result: any = await PointExchangeSheet.save(\"PointExchangeSheet\", getDataForSave);\r\n        let { id, flow, state } = result;\r\n        await PointExchangeSheet.action(id, flow, state, \"submit\");\r\n\r\n        //暂时扣除已经兑换的积分;\r\n        this.myEffectivePoints = this.myEffectivePoints - this.pointToExchanging;\r\n        this.myTotalPoints = this.myTotalPoints - this.pointToExchanging;\r\n        if (this.pointToExchanging > this.myPointTobeExpired) {\r\n            this.myPointTobeExpired = 0;\r\n        } else {\r\n            this.myPointTobeExpired = this.myPointTobeExpired - this.pointToExchanging;\r\n        }\r\n\r\n        //兑换后清空选择的积分产品\r\n        this.orderData.exchangeItems = undefined;\r\n        this.pointProductsSelected.length = 0;\r\n        this.pointToExchanging = 0;\r\n\r\n        // 打开下单成功显示界面\r\n        nav.popTo(this.cApp.topKey);\r\n        this.openVPage(OrderSuccess, result);\r\n    }\r\n\r\n    /**\r\n     * 获取当前webuser对应customer的最近一个订单\r\n     */\r\n    getLastPlatformOrder = async () => {\r\n\r\n        let { currentCustomer } = this.cApp.currentUser;\r\n        let validationResult = await this.uqs.积分商城.GetLastPlatFormOrder.submit({ customer: currentCustomer && currentCustomer.id });\r\n        let { platformOrderId } = validationResult;\r\n        this.platformOrderId = validationResult.platformOrderId;\r\n        return platformOrderId;\r\n    }\r\n\r\n    getPlatFormOrder = async (platformOrderId: string) => {\r\n        return await this.uqs.积分商城.GetPlatFormOrder.table({ platformOrderId: platformOrderId });\r\n    }\r\n\r\n    IsCouponCanUse = async (couponCode: string) => {\r\n        this.couponId = 0;\r\n        let { currentUser } = this.cApp;\r\n        let { salesTask } = this.uqs;\r\n        let validationResult = await salesTask.IsCanUseCoupon.submit({ code: couponCode, webUser: currentUser && currentUser.id });\r\n\r\n        let { result, id, types } = validationResult;\r\n        if (result === 1) {\r\n            this.couponId = id;\r\n            if (types !== 'credits')\r\n                result = 0;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * 领取积分\r\n     */\r\n    receivePoint = async (orderId: string) => {\r\n        let { currentCustomer } = this.cApp.currentUser;\r\n        let { AddPlatformOrderPoint } = this.uqs.积分商城;\r\n        let result = await AddPlatformOrderPoint.submit({ orderId: orderId, couponId: this.couponId, customer: currentCustomer && currentCustomer.id });\r\n        let rtn = result.result;\r\n\r\n        return rtn;\r\n    }\r\n\r\n    private openMeInfoOptions: any;\r\n    /**\r\n     * 检查客户信息是否完善（不完善需补充完善后方可领取积分）\r\n     */\r\n    userInfoCompletedChecking = (options: any): boolean => {\r\n\r\n        if (!this.isLogined) {\r\n            this.openMeInfoOptions = options;\r\n            nav.showLogin(this.loginCallback, true);\r\n            return false;\r\n        } else {\r\n            let { cMe, currentUser } = this.cApp;\r\n            if (!currentUser.allowOrdering) {\r\n                cMe.openMeInfoFirstOrder(options);\r\n                return false;\r\n            }\r\n            return true;\r\n        }\r\n    }\r\n\r\n    private loginCallback = async (user: User): Promise<void> => {\r\n        let { cApp } = this;\r\n        await cApp.currentUser.setUser(user);\r\n        await cApp.loginCallBack(user);\r\n        this.closePage(1);\r\n\r\n        let { cMe, currentUser } = this.cApp;\r\n        if (!currentUser.allowOrdering) {\r\n            cMe.openMeInfoFirstOrder(this.openMeInfoOptions);\r\n        }\r\n    };\r\n\r\n\r\n    /**\r\n     *\r\n     */\r\n    addUsedCoupon = async () => {\r\n        let { AddUsedCoupon } = this.uqs.积分商城;\r\n        let result = await AddUsedCoupon.submit({ couponId: this.couponId });\r\n        let rtn = result.result;\r\n        return rtn;\r\n    }\r\n\r\n    private defaultSetting: any;\r\n    private async getDefaultSetting() {\r\n        if (this.defaultSetting) return this.defaultSetting;\r\n        let { currentUser } = this.cApp;\r\n        return this.defaultSetting = await currentUser.getSetting() || {};\r\n    }\r\n    private contact0: BoxId;\r\n    private async getContact(): Promise<BoxId> {\r\n        if (this.contact0 === null) return;\r\n        if (this.contact0 !== undefined) return this.contact0;\r\n        let { currentUser } = this.cApp;\r\n        let contactArr = await currentUser.getContacts();\r\n        if (contactArr === undefined || contactArr.length === 0) {\r\n            this.contact0 = null;\r\n            return;\r\n        }\r\n        return this.contact0 = contactArr[0].contact;\r\n    }\r\n    private async getDefaultShippingContact() {\r\n        let defaultSetting = await this.getDefaultSetting();\r\n        return defaultSetting.shippingContact || await this.getContact();\r\n    }\r\n\r\n    onSelectShippingContact = async () => {\r\n        let cSelect = this.newC(CSelectShippingContact);\r\n        let contactBox = await cSelect.call<BoxId>(true);\r\n        this.orderData.shippingContact = contactBox;\r\n    }\r\n}","import * as React from 'react';\r\nimport { View, nav, LMR, Image, FA } from 'tonva';\r\nimport { EditMeInfo } from './EditMeInfo';\r\nimport { CMe } from './CMe';\r\n\r\nexport class VLoginState extends View<CMe> {\r\n\r\n    render() {\r\n        let { user } = nav;\r\n        if (!user) {\r\n            return <div className=\"d-flex align-items-center justify-content-end small text-muted\">\r\n                <a className=\"px-2\" href=\"./shop?type=signUp\">注册</a>\r\n                <a className=\"px-2\" href=\"./shop?type=login\">登录</a>\r\n                {this.controller.renderCarLabel()}\r\n            </div>\r\n        }\r\n        let { id, name, nick, icon } = user;\r\n        return <div className=\"d-flex align-items-center justify-content-end\">\r\n            <div>\r\n                {<Image className=\"w-3c h-3c mr-3\" src={icon} />}\r\n            </div>\r\n            <div>\r\n                <div>{userSpan(name, nick)}</div>\r\n                <div className=\"small\"><span className=\"text-muted\">ID:</span> {id > 10000 ? id : String(id + 10000).substr(1)}</div>\r\n            </div>\r\n        </div >;\r\n    }\r\n}\r\n\r\nexport function userSpan(name: string, nick: string): JSX.Element {\r\n    return nick ?\r\n        <><b>{nick} &nbsp; <small className=\"muted\">{name}</small></b></>\r\n        : <b>{name}</b>\r\n}\r\n","import _ from 'lodash';\r\nimport { Context, nav, VPage } from 'tonva';\r\nimport { CUqBase } from '../CBase';\r\nimport { VMe } from './VMe';\r\nimport { CSelectShippingContact } from '../customer/CSelectContact';\r\nimport { EditMeInfoFirstOrder } from './EditMeInfoFirstOrder';\r\nimport { CInvoiceInfo } from '../customer/CInvoiceInfo';\r\nimport { CAddress } from '../customer/CAddress';\r\nimport { CPointProduct } from 'pointMarket/CPointProduct';\r\nimport { VLoginState } from './VLoginState';\r\n\r\nexport class CMe extends CUqBase {\r\n    //    cApp: CApp;\r\n    protected async internalStart(param?: any) {\r\n    }\r\n\r\n    async changeWebUser(webUser: any) {\r\n        let { currentUser } = this.cApp;\r\n        await currentUser.changeWebUser(webUser);\r\n    }\r\n\r\n    async changeWebUserContact(webUserContact: any) {\r\n        let { currentUser } = this.cApp;\r\n        await currentUser.changeWebUserContact(webUserContact);\r\n    }\r\n\r\n    tab = () => this.renderView(VMe);\r\n    tabPage: VMe = new VMe(this);\r\n\r\n    openMyOrders = async (state: string) => {\r\n        let { cOrder } = this.cApp;\r\n        await cOrder.openMyOrders(state);\r\n    }\r\n\r\n    openContactList = async () => {\r\n        let contactList = this.newC(CSelectShippingContact); // new CSelectShippingContact(this.cApp, undefined, false);\r\n        await contactList.start(false);\r\n    }\r\n\r\n    openInvoice = async () => {\r\n        let cInvoiceInfo = this.newC(CInvoiceInfo); // new CInvoiceInfo(this.cApp, undefined, false);\r\n        let { currentUser } = this.cApp;\r\n        let defaultSetting = await currentUser.getSetting();\r\n\r\n        let origInvoice = _.pick(defaultSetting, ['invoiceType', 'invoiceInfo']);\r\n        cInvoiceInfo.start(origInvoice);\r\n    }\r\n\r\n    openMyPoint = async () => {\r\n        let cPointProduct = this.newC(CPointProduct);// new CSelectShippingContact(this.cApp, undefined, false);\r\n        await cPointProduct.start();\r\n    }\r\n\r\n    openMeInfoFirstOrder = async (options?: any) => {\r\n        await this.openVPage(EditMeInfoFirstOrder, options);\r\n    }\r\n\r\n    pickAddress = async (context: Context, name: string, value: number): Promise<number> => {\r\n        let cAddress = this.newC(CAddress); // new CAddress(this.cApp, undefined);\r\n        return await cAddress.call<number>();\r\n    }\r\n\r\n    openPrivacy = () => {\r\n        // this.openVPage(Privacy);\r\n        nav.showPrivacyPage();\r\n    }\r\n\r\n    getCommonText = async (textId: number) => {\r\n        return await this.uqs.order.CommonText.load(textId);\r\n    }\r\n\r\n    renderLoginState() {\r\n        return this.renderView(VLoginState);\r\n    }\r\n\r\n    showLogin = () => {\r\n        nav.showLogin(undefined, true);\r\n    }\r\n\r\n    renderCarLabel = () => {\r\n        let { cCart } = this.cApp;\r\n        return cCart.renderCartLabel();\r\n    }\r\n}","export let browser = {\r\n    versions: function () {\r\n        var u = navigator.userAgent, app = navigator.appVersion;\r\n        return {\r\n            trident: u.indexOf('Trident') > -1,                            //IE内核\r\n            presto: u.indexOf('Presto') > -1,                              //opera内核\r\n            webKit: u.indexOf('AppleWebKit') > -1,                         //苹果、谷歌内核\r\n            gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') === -1,    //火狐内核\r\n            mobile: !!u.match(/AppleWebKit.*Mobile.*/),                    //是否为移动终端\r\n            ios: !!u.match(/\\(i[^;]+;( U;)? CPU.+Mac OS X/),               //ios终端\r\n            android: u.indexOf('Android') > -1, //android终端或者uc浏览器\r\n            uc: u.indexOf('Linux') > -1, //android终端或者uc浏览器\r\n            iPhone: u.indexOf('iPhone') > -1,                              //是否为iPhone或者QQHD浏览器\r\n            iPad: u.indexOf('iPad') > -1,                                  //是否iPad\r\n            webApp: u.indexOf('Safari') === -1,                             //是否web应该程序，没有头部与底部\r\n            html5Plus: u.indexOf('Html5Plus') > -1                      //是否微信 （2015-01-22新增）\r\n        };\r\n    }()\r\n};\r\n","import * as React from 'react';\r\nimport { VPage, TabCaptionComponent, Page, Tabs } from 'tonva';\r\nimport { CApp } from '../CApp';\r\nimport { browser } from 'tools/browser';\r\nimport { GLOABLE } from 'cartenv';\r\n\r\nconst color = (selected: boolean) => selected === true ? 'text-primary' : 'text-muted';\r\n\r\nexport class VMain extends VPage<CApp> {\r\n    async open(param?: any) {\r\n        this.openPage(this.render);\r\n    }\r\n\r\n    downloadApp = () => {\r\n        if (browser.versions.android)\r\n            window.open(GLOABLE.ANDROIDAPPADDRESS);\r\n    }\r\n\r\n    render = (param?: any): JSX.Element => {\r\n        let { cHome, cCart, cMe, cart } = this.controller;\r\n        let faceTabs = [\r\n            { name: 'home', label: '首页', icon: 'home', content: cHome.tab, notify: undefined/*store.homeCount*/ },\r\n            // { name: 'member', label: '会员', icon: 'vcard', content: cMember.tab },\r\n            {\r\n                name: 'cart',\r\n                label: '购物车',\r\n                icon: 'shopping-cart',\r\n                //content: cCart.tab, \r\n                page: cCart.tabPage,\r\n                notify: cart.count\r\n            },\r\n            {\r\n                name: 'me',\r\n                label: '我的',\r\n                icon: 'user',\r\n                //content: cMe.tab \r\n                page: cMe.tabPage\r\n            }\r\n        ].map(v => {\r\n            let { name, label, icon, content, page, notify } = v;\r\n            return {\r\n                name: name,\r\n                caption: (selected: boolean) => TabCaptionComponent(label, icon, color(selected)),\r\n                content: content,\r\n                page: page,\r\n                notify: notify,\r\n            }\r\n        });\r\n\r\n        let header: any = false;\r\n        if (!browser.versions.html5Plus && browser.versions.android) {\r\n            header = <div className=\"w-100 mx-3 d-flex justify-content-between\" onClick={this.downloadApp}>\r\n                <span className=\"pt-2 small text-danger\">\r\n                    APP购物更方便\r\n                </span>\r\n                <button type=\"button\" className=\"btn btn-primary btn-sm\">立即安装</button>\r\n            </div>\r\n        }\r\n        return <Page header={header} headerClassName=\"bg-warning\" tabsProps={{ tabs: faceTabs }} />\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { CCoupon, COUPONBASE } from './CCoupon';\r\nimport { View, FA, EasyDate, LMR, tv } from 'tonva';\r\nimport { VIPCard } from './Coupon';\r\n\r\nfunction getTips(result: number, types: string, code: string) {\r\n    let invalidTip = `${COUPONBASE[types]['name']}【${code}】无效，请与您的专属销售人员联系。`;\r\n    switch (result) {\r\n        case 0:\r\n            invalidTip = `${COUPONBASE[types]['name']}【${code}】不存在，请与您的专属销售人员联系。`;\r\n            break;\r\n        case 2:\r\n            invalidTip = `该${COUPONBASE[types]['name']}【${code}】已失效，请与您的专属销售人员联系。`;\r\n            break;\r\n        case 4:\r\n            invalidTip = `该${COUPONBASE[types]['name']}【${code}】已经使用过，不可重复领用。`;\r\n            break;\r\n        case 6:\r\n            invalidTip = `您不能领用自己发出的${COUPONBASE[types]['name']}【${code}】。`;\r\n            break;\r\n        default:\r\n            break;\r\n    }\r\n    return invalidTip;\r\n}\r\n\r\nexport class VCoupon extends View<CCoupon> {\r\n\r\n    protected coupon: any;\r\n    protected renderRight = (): JSX.Element => {\r\n        return null;\r\n    }\r\n\r\n    protected renderCardDescription = (): JSX.Element => {\r\n        let { discount, vipCardType } = this.coupon;\r\n        let cardDescription: any;\r\n        if (typeof discount === 'number') {\r\n            if (discount !== 0) {\r\n                let discountShow: any;\r\n                discountShow = (1 - discount) * 10;\r\n                cardDescription = <div className=\"mr-3 font-weight-bold text-danger\"><big>{discountShow === 10 ? '无折扣' : <>{discountShow.toFixed(1)} 折</>}</big></div>\r\n            } else {\r\n                if (vipCardType) {\r\n                    cardDescription = <div className=\"mr-3 font-weight-bold text-danger\"><big>{tv(vipCardType, v => v.name)}</big></div>\r\n                }\r\n            }\r\n        }\r\n        return cardDescription;\r\n    }\r\n\r\n    protected getCodeShow = (code: number) => {\r\n        let codeShow = String(code);\r\n        let p1 = codeShow.substr(0, 4);\r\n        let p2 = codeShow.substr(4);\r\n        codeShow = p1 + ' ' + p2;\r\n    }\r\n\r\n    render(param: any): JSX.Element {\r\n        this.coupon = param\r\n        let { result, id, code, discount, preferential, validitydate, isValid, types, vipCardType } = param;\r\n\r\n        let couponUi;\r\n        if (result !== 1 || !isValid) {\r\n            // this.controller.cApp.currentCouponCode = undefined;\r\n            couponUi = <div className=\"alert alert-primary my-1\" role=\"alert\">\r\n                <FA name=\"exclamation-circle\" className=\"text-warning float-left mr-3\" size=\"2x\"></FA>\r\n                {getTips(result, types, code)}\r\n            </div>\r\n        } else {\r\n            // this.controller.cApp.currentCouponCode = code;\r\n            /*\r\n            let bcenter: any;\r\n            if (preferential)\r\n                bcenter = <div className=\"text-muted\"><small>优惠：<span className=\"mx-3\">￥{preferential}</span></small></div>;\r\n            */\r\n\r\n            let content = <div className=\"float-right pr-3\">\r\n                <div className=\"pb-1\">\r\n                    <FA name='th-large' className='mr-1 text-warning' />{this.getCodeShow(code)}\r\n                    <small className=\"ml-3\">有效期：<EasyDate date={validitydate} /></small>\r\n                </div>\r\n                <div><small className=\"text-success\">此{COUPONBASE[types]['name']}全场通用</small></div>\r\n            </div>;\r\n\r\n            let left = <div>\r\n                <span className=\"text-muted\"><small>{COUPONBASE[types]['name']}</small></span>\r\n                {this.renderCardDescription()}\r\n            </div>;\r\n\r\n            couponUi = <div className=\"bg-white py-3 pl-3 pr-2 mb-1\">\r\n                <LMR left={left} right={this.renderRight()}>\r\n                    {content}\r\n                </LMR>\r\n            </div>\r\n        }\r\n        return couponUi;\r\n    }\r\n}\r\n\r\nexport class VVIPCard extends VCoupon {\r\n\r\n    private showDiscountSetting = (vipCardId: VIPCard, event: React.MouseEvent) => {\r\n        event.stopPropagation();\r\n        this.controller.showDiscountSetting(vipCardId);\r\n    }\r\n\r\n    protected renderRight = (): JSX.Element => {\r\n        return <span className=\"ml-3 my-3\" onClick={(event) => this.showDiscountSetting(this.coupon, event)}>\r\n            <FA name=\"chevron-right\" className=\"corsor-pointer\"></FA>\r\n        </span>;\r\n    }\r\n}\r\n\r\nexport class VCredits extends VCoupon {\r\n\r\n\r\n    protected renderCardDescription = (): JSX.Element => {\r\n        return <div className=\"mr-3 font-weight-bold text-danger\"><big>双倍积分</big></div>\r\n    }\r\n\r\n    /*\r\n    render(param: any): JSX.Element {\r\n        let { coupon, onClick } = param;\r\n        this.coupon = coupon;\r\n        let { result, id, code, discount, preferential, validitydate, isValid, types } = param;\r\n\r\n        let couponUi;\r\n        if (result !== 1 || !isValid) {\r\n            // this.controller.cApp.currentCreditCode = undefined;\r\n            couponUi = <div className=\"alert alert-primary my-1\" role=\"alert\">\r\n                <FA name=\"exclamation-circle\" className=\"text-warning float-left mr-3\" size=\"2x\"></FA>\r\n                {getTips(result, types, code)}\r\n            </div>\r\n        } else {\r\n            // this.controller.cApp.currentCreditCode = code;\r\n            let content = <div onClick={() => onClick(code)}>\r\n                <div className=\"pb-1\">\r\n                    <FA name='th-large' className='mr-1 text-warning' />{this.getCodeShow(code)}\r\n                    <small className=\"ml-3\">有效期：<EasyDate date={validitydate} /></small>\r\n                </div>\r\n                <div><small className=\"text-success\">此{cardTypeName[types]}全场通用</small></div>\r\n            </div>;\r\n\r\n            let left = <div onClick={() => onClick(code)}>\r\n                <span className=\"text-muted\"><small>{cardTypeName[types]}</small></span>\r\n                {this.renderCardDescription()}\r\n            </div>;\r\n\r\n            couponUi = <div className=\"bg-white p-3 mb-1\">\r\n                <LMR left={left}>\r\n                    {content}\r\n                </LMR>\r\n            </div>\r\n        }\r\n        return couponUi;\r\n    }\r\n    */\r\n}","import * as React from 'react';\r\nimport { CCoupon } from './CCoupon';\r\nimport { VPage, Page, List } from 'tonva';\r\nimport { observer } from 'mobx-react';\r\nimport { VCoupon, VVIPCard, VCredits } from './VVIPCard';\r\nimport { VCoupleAvailable } from './VCouponAvailable';\r\n\r\nexport class VSharedCoupon extends VPage<CCoupon> {\r\n\r\n    private products: any[] = [];\r\n    async open(param: any) {\r\n        this.products = param.products || [];\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private drawCouponUI = observer(() => {\r\n        let { sharedCouponValidationResult } = this.controller;\r\n        if (sharedCouponValidationResult.result !== 1)\r\n            return null;\r\n        let { couponDrawed, loginWhenDrawCoupon } = this.controller;\r\n        if (couponDrawed)\r\n            return <div className=\"alert alert-info w-100 small text-center\">已领取</div>\r\n        else\r\n            return <button className=\"btn btn-primary w-100\" onClick={() => loginWhenDrawCoupon(sharedCouponValidationResult)}>领取</button>\r\n    })\r\n\r\n    private renderCouponBase = (sharedCouponValidationResult: any) => {\r\n        let { types } = sharedCouponValidationResult;\r\n        switch (types) {\r\n            case 'coupon':\r\n                return <>{this.renderVm(VCoupon, sharedCouponValidationResult)}</>;\r\n                break;\r\n            case 'credits':\r\n                return <>{this.renderVm(VCredits, sharedCouponValidationResult)}</>;\r\n                break;\r\n            case 'vipcard':\r\n                return <>{this.renderVm(VVIPCard, sharedCouponValidationResult)}</>;\r\n                break\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let { renderProduct, cApp, sharedCouponValidationResult } = this.controller;\r\n\r\n        let { cCart } = cApp;\r\n        let cart = cCart.renderCartLabel();\r\n        return <Page header=\"与您分享\" right={cart}>\r\n            {this.renderCouponBase(sharedCouponValidationResult)}\r\n            {React.createElement(this.drawCouponUI)}\r\n            <List items={this.products} item={{ render: renderProduct, className: \"mb-1\" }} none={null} />\r\n        </Page>\r\n    })\r\n}","import * as React from 'react';\r\nimport { VPage, Page, List, FA, LMR } from 'tonva';\r\nimport { CCoupon, COUPONBASE } from './CCoupon';\r\nimport { observable } from 'mobx';\r\nimport { VVIPCard, VCredits, VCoupon } from './VVIPCard';\r\nimport { GLOABLE } from 'cartenv';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VCoupleAvailable extends VPage<CCoupon> {\r\n\r\n    private couponInput: HTMLInputElement;\r\n    private vipCardForWebUser: any;\r\n    private coupons: any[];\r\n\r\n    @observable tips: string;\r\n    async open(param: any) {\r\n        let { vipCardForWebUser, couponsForWebUser } = param;\r\n        this.vipCardForWebUser = vipCardForWebUser;\r\n        this.coupons = couponsForWebUser.map((v: any) => v.coupon).concat(param.creditsForWebUser.map((v: any) => v.coupon));\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private applyCoupon = async () => {\r\n        let coupon = this.couponInput.value;\r\n        await this.applySelectedCoupon(coupon);\r\n    }\r\n\r\n    /**\r\n     * 应用选择的vipcard等 \r\n     */\r\n    private applySelectedCoupon = async (coupon: string) => {\r\n        if (!coupon)\r\n            this.tips = \"请输入您的优惠卡/券号\";\r\n        else {\r\n            let ret = await this.controller.applyCoupon(coupon);\r\n            switch (ret) {\r\n                case -1:\r\n                    this.tips = '对不起，当前服务器繁忙，请稍后再试。';\r\n                    break;\r\n                case 1:\r\n                    this.tips = '有效';\r\n                    break;\r\n                case 0:\r\n                    this.tips = \"无此优惠券，请重新输入或与您的专属销售人员联系确认优惠码是否正确。\";\r\n                    break;\r\n                case 2:\r\n                    this.tips = '优惠券已过期或作废，请重新输入或与您的专属销售人员联系。';\r\n                    break;\r\n                case 3:\r\n                case 5:\r\n                    this.tips = '优惠券无效，请重新输入或与您的专属销售人员联系。';\r\n                    break;\r\n                case 6:\r\n                    this.tips = '不允许使用本人优惠券！';\r\n                    break;\r\n                case 4:\r\n                    this.tips = '该优惠券已经被使用过了，不允许重复使用。';\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n        if (this.tips)\r\n            setTimeout(() => this.tips = undefined, GLOABLE.TIPDISPLAYTIME);\r\n    }\r\n\r\n    private renderCoupon = (coupon: any) => {\r\n        let { result, code, types } = coupon;\r\n        if (result === 1) {\r\n            let content = this.renderVm(COUPONBASE[types]['view'], coupon);\r\n            // let content = types === 'coupon' ? this.renderVm(VCoupon, coupon) : this.renderVm(VCredits, coupon)\r\n            return <div className=\"d-block\">\r\n                <div className=\"px-2 bg-white\" onClick={() => this.applySelectedCoupon(code)}>\r\n                    {content}\r\n                </div>\r\n            </div>\r\n        } else\r\n            return null;\r\n    }\r\n\r\n    private tipsUI = observer(() => {\r\n        let tipsUI = <></>;\r\n        if (this.tips) {\r\n            tipsUI = <div className=\"alert alert-primary\" role=\"alert\">\r\n                <FA name=\"exclamation-circle\" className=\"text-warning float-left mr-3\" size=\"2x\"></FA>\r\n                {this.tips}\r\n            </div>\r\n        }\r\n        return tipsUI;\r\n    })\r\n\r\n    private page = () => {\r\n\r\n        let vipCardUI;\r\n        if (this.vipCardForWebUser) {\r\n            let { coupon } = this.vipCardForWebUser;\r\n            vipCardUI = <div onClick={() => this.applySelectedCoupon(coupon.code)}>{this.renderVm(VVIPCard, coupon)}</div>\r\n        }\r\n\r\n        let left = <div className=\"d-flex align-items-center mr-3\"><div className=\"align-middle\">优惠卡/券:</div></div>\r\n        let right = <button className=\"btn btn-primary w-100\" onClick={this.applyCoupon}>使用</button>\r\n\r\n        return <Page header=\"可用优惠\">\r\n            <div className=\"px-2 py-3\">\r\n                <LMR left={left} right={right}>\r\n                    <input ref={v => this.couponInput = v} type=\"number\" className=\"form-control\"></input>\r\n                </LMR>\r\n                {React.createElement(this.tipsUI)}\r\n            </div >\r\n\r\n            <div className=\"px-2 bg-white\">\r\n                {vipCardUI}\r\n            </div>\r\n            <List items={this.coupons} item={{ render: this.renderCoupon }} none={null}></List>\r\n        </Page >\r\n    }\r\n}\r\n\r\n/*\r\n\r\n            <div className=\"px-2 py-3\">\r\n                <div className=\"row pr-3 my-1\">\r\n                    <div className=\"col-4 col-sm-2 d-flex align-items-center text-muted\"><span className=\"align-middle\">优惠卡券:</span></div>\r\n                    <div className=\"col-8 col-sm-10 d-flex\">\r\n                        <input ref={v => this.couponInput = v} type=\"number\" className=\"form-control\"></input>\r\n                    </div>\r\n                </div>\r\n                <div className=\"row my-1\">\r\n                    <div className=\"col-12\">\r\n                        <button className=\"btn btn-primary w-100\" onClick={this.applyCoupon}>使用填写的卡券</button>\r\n                    </div>\r\n                </div>\r\n                {React.createElement(this.tipsUI)}\r\n            </div>\r\n*/","import * as React from 'react';\r\nimport { VPage, Page, List, tv } from 'tonva';\r\nimport { CCoupon } from './CCoupon';\r\n\r\nexport class VVIPCardDiscount extends VPage<CCoupon>{\r\n\r\n    private vipCard: any;\r\n    async open(vipCard: any) {\r\n        this.vipCard = vipCard;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderVIPCardDiscountSetting(item: any) {\r\n        let { brand, discount } = item;\r\n        return <div className=\"row\">\r\n            <div className=\"col-7\">\r\n                {tv(brand, v => v.name)}\r\n            </div>\r\n            <div className=\"col-5\">\r\n                {100 - discount * 100}%\r\n            </div>\r\n        </div>\r\n    }\r\n\r\n    private page = () => {\r\n        return <Page header=\"VIP卡折扣\">\r\n            <List items={this.vipCard.discountSetting} item={{ render: this.renderVIPCardDiscountSetting, className: \"px-3 py-2\" }}></List>\r\n        </Page>\r\n    }\r\n}","import { CUqBase } from '../CBase';\r\nimport { VSharedCoupon } from './VSharedCoupon';\r\nimport { BoxId, nav, User, QueryPager, Tuid } from 'tonva';\r\nimport { observable } from 'mobx';\r\nimport { VCoupleAvailable } from './VCouponAvailable';\r\nimport { VVIPCardDiscount } from './VVIPCardDiscount';\r\nimport { VCoupon, VCredits, VVIPCard } from './VVIPCard';\r\n\r\nexport const COUPONBASE: any = {\r\n    'coupon': { 'name': '优惠券', 'view': VCoupon },\r\n    'credits': { 'name': '积分券', 'view': VCredits },\r\n    'vipcard': { 'name': 'VIP卡', 'view': VVIPCard }\r\n}\r\n\r\nexport class CCoupon extends CUqBase {\r\n\r\n    @observable couponDrawed: boolean;\r\n    @observable sharedCouponValidationResult: any;\r\n    couponPager: QueryPager<any>;\r\n\r\n    applyCoupon = async (coupon: string) => {\r\n        let validationResult = await this.getCouponValidationResult(coupon);\r\n        let { result: rtn, id, types } = validationResult;\r\n        if (rtn === 1) {\r\n            if (types === 'vipcard' || types === 'coupon') {\r\n                validationResult.discountSetting = await this.getCouponDiscountSetting(types, id);\r\n            }\r\n            this.returnCall(validationResult);\r\n            this.closePage();\r\n        }\r\n        return rtn;\r\n    }\r\n\r\n    getCouponValidationResult = async (coupon: string) => {\r\n        let { currentUser } = this.cApp;\r\n        return await this.uqs.salesTask.IsCanUseCoupon.submit({ code: coupon, webUser: currentUser && currentUser.id });\r\n    }\r\n\r\n    protected async internalStart(param: any) {\r\n        let { currentUser } = this.cApp;\r\n        let { id: currentUserId } = currentUser;\r\n\r\n        let validVIPCardForWebUser = await this.getValidVipCardForWebUser(currentUserId);\r\n        if (validVIPCardForWebUser) {\r\n            validVIPCardForWebUser.coupon = await this.getCouponValidationResult(validVIPCardForWebUser.vipCardCode)\r\n        }\r\n\r\n        let validCouponsForWebUser = await this.getValidCouponsForWebUser(currentUserId);\r\n        if (validCouponsForWebUser.length > 0) {\r\n            for (let i = 0; i < validCouponsForWebUser.length; i++) {\r\n                let e = validCouponsForWebUser[i];\r\n                e.coupon = await this.getCouponValidationResult(e.couponCode);\r\n            }\r\n        }\r\n\r\n        let validCreditsForWebUser = await this.getValidCreditsForWebUser(currentUserId);\r\n        if (validCreditsForWebUser.length > 0) {\r\n            for (let i = 0; i < validCreditsForWebUser.length; i++) {\r\n                let e = validCreditsForWebUser[i];\r\n                e.coupon = await this.getCouponValidationResult(e.creditsCode);\r\n            }\r\n        }\r\n        this.openVPage(VCoupleAvailable, {\r\n            'vipCardForWebUser': validVIPCardForWebUser,\r\n            'couponsForWebUser': validCouponsForWebUser,\r\n            'creditsForWebUser': validCreditsForWebUser\r\n        });\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param currentUserId \r\n     */\r\n    getValidVipCardForWebUser = async (currentUserId: number): Promise<any> => {\r\n        let { uqs } = this.cApp;\r\n        let { webuser } = uqs;\r\n        let { WebUserVIPCard } = webuser;\r\n        let vipCardForWebUser: any = await WebUserVIPCard.obj({ webUser: currentUserId });\r\n        if (vipCardForWebUser) {\r\n            let { expiredDate } = vipCardForWebUser\r\n            if (expiredDate.getTime() > Date.now()) {\r\n                return vipCardForWebUser;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param currentUserId \r\n     */\r\n    getValidCouponsForWebUser = async (currentUserId: number): Promise<any[]> => {\r\n        let { uqs } = this.cApp;\r\n        let { webuser } = uqs;\r\n        let { WebUserCoupon } = webuser;\r\n        let couponsForWebUser: any[] = await WebUserCoupon.table({ webUser: currentUserId });\r\n        let validCouponsForWebUser: any[] = [];\r\n        if (couponsForWebUser) {\r\n            validCouponsForWebUser = couponsForWebUser.filter(v => v.expiredDate.getTime() > Date.now());\r\n        }\r\n        return validCouponsForWebUser;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param currentUserId \r\n     */\r\n    getValidCreditsForWebUser = async (currentUserId: number): Promise<any[]> => {\r\n        let { uqs } = this.cApp;\r\n        let { 积分商城 } = uqs;\r\n        let creditsForWebUser: any[] = await 积分商城.WebUserCredits.table({ webUser: currentUserId });\r\n        let validCreditsForWebUser: any[] = [];\r\n        if (creditsForWebUser) {\r\n            validCreditsForWebUser = creditsForWebUser.filter(v => v.expiredDate.getTime() > Date.now());\r\n        }\r\n        return validCreditsForWebUser;\r\n    }\r\n\r\n    /**\r\n     * 显示VIP卡的品牌折扣明细 \r\n     * @param coupon \r\n     */\r\n    showDiscountSetting = async (vipCard: any) => {\r\n        let { types, id } = vipCard;\r\n        vipCard.discountSetting = await this.getCouponDiscountSetting(types, id);\r\n        this.openVPage(VVIPCardDiscount, vipCard);\r\n    }\r\n\r\n    private getCouponDiscountSetting = async (types: string, couponId: number) => {\r\n        if (types === 'vipcard' || types === 'coupon') {\r\n            return await this.uqs.salesTask.VIPCardDiscount.table({ coupon: couponId });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 领取VIP卡 \r\n     */\r\n    showSharedVIPCard = async (param: any) => {\r\n        let { vipcard: vipCardCode, productids } = param;\r\n        await this.autoDrawCouponBase(vipCardCode);\r\n        let products = this.getProducts(productids);\r\n        this.openVPage(VSharedCoupon, { products });\r\n    }\r\n\r\n    /**\r\n     * 领取优惠券 \r\n     */\r\n    showSharedCoupon = async (param: any) => {\r\n        let { coupon, productids } = param;\r\n        await this.autoDrawCouponBase(coupon);\r\n        let products = this.getProducts(productids);\r\n        this.openVPage(VSharedCoupon, { products });\r\n    }\r\n\r\n    /**\r\n     * 领取积分码 \r\n     */\r\n    showSharedCredits = async (param: any) => {\r\n        let { credits, productids } = param;\r\n        await this.autoDrawCouponBase(credits);\r\n        let products = this.getProducts(productids);\r\n        this.openVPage(VSharedCoupon, { products });\r\n    }\r\n\r\n    private autoDrawCouponBase = async (couponBaseCode: string) => {\r\n\r\n        this.couponDrawed = false;\r\n        this.sharedCouponValidationResult = await this.getCouponValidationResult(couponBaseCode);\r\n        let { result } = this.sharedCouponValidationResult;\r\n\r\n        // 自动领取积分券\r\n        let { currentUser } = this.cApp;\r\n        let { id: currentUserId } = currentUser;\r\n        if (result === 1 && currentUserId) {\r\n            this.drawCoupon(this.sharedCouponValidationResult);\r\n        }\r\n    }\r\n\r\n    private getProducts = (productids: string) => {\r\n        let products: any;\r\n        if (productids) {\r\n            let { ProductX } = this.uqs.product;\r\n            let productidArray = productids.split('-').filter((v: any) => /^\\d{1,10}$/.test(v));\r\n            products = productidArray.map((v: any) => ProductX.boxId(v));\r\n        }\r\n        return products;\r\n    }\r\n\r\n    loginWhenDrawCoupon = async (credits: any) => {\r\n\r\n        let loginCallback = async (user: User) => {\r\n            let { cApp } = this;\r\n            await cApp.currentUser.setUser(user);\r\n            await cApp.loginCallBack(user);\r\n            this.closePage(1);\r\n            let { code } = credits;\r\n            this.sharedCouponValidationResult = await this.getCouponValidationResult(code);\r\n            let { result } = this.sharedCouponValidationResult;\r\n            if (result === 1) {\r\n                await this.drawCoupon(this.sharedCouponValidationResult);\r\n            }\r\n        };\r\n        if (!this.isLogined)\r\n            nav.showLogin(loginCallback, true);\r\n    }\r\n\r\n    private drawCoupon = async (credits: any) => {\r\n        let { uqs, cApp } = this;\r\n        let { currentUser } = cApp;\r\n        let { id: currentUserId } = currentUser;\r\n        let { 积分商城, webuser } = uqs;\r\n        let { result, id: creditsId, code, validitydate, types } = credits;\r\n        if (result !== 1)\r\n            return;\r\n        switch (types) {\r\n            case 'credits':\r\n                let drawedResult = await 积分商城.WebUserCredits.obj({ webUser: currentUserId, credits: creditsId });\r\n                if (!drawedResult) {\r\n                    let now = new Date();\r\n\r\n                    await 积分商城.WebUserCredits.add({\r\n                        webUser: currentUserId,\r\n                        arr1: [{\r\n                            credits: creditsId,\r\n                            creditsCode: code,\r\n                            createDate: `${now.getFullYear()}-${now.getMonth() + 1}-${now.getDate()}`,\r\n                            expiredDate: validitydate\r\n                        }]\r\n                    })\r\n                }\r\n                break;\r\n            case 'coupon':\r\n                let drawedResult3 = await webuser.WebUserCoupon.obj({ webUser: currentUserId, coupon: creditsId });\r\n                if (!drawedResult3) {\r\n                    let now = new Date();\r\n                    await webuser.WebUserCoupon.add({\r\n                        webUser: currentUserId,\r\n                        coupon: creditsId,\r\n                        arr1: [{\r\n                            couponType: 1,\r\n                            couponCode: code,\r\n                            createDate: `${now.getFullYear()}-${now.getMonth() + 1}-${now.getDate()}`,\r\n                            expiredDate: validitydate,\r\n                        }]\r\n                    })\r\n                }\r\n                break;\r\n            case 'vipcard':\r\n                let drawedResult2 = await webuser.WebUserVIPCard.obj({ webUser: currentUserId, vipCard: creditsId });\r\n                if (!drawedResult2) {\r\n                    let now = new Date();\r\n                    await this.uqs.webuser.WebUserVIPCard.add({\r\n                        webUser: currentUserId,\r\n                        vipCard: creditsId,\r\n                        arr1: [{\r\n                            vipCardType: 1,\r\n                            createDate: `${now.getFullYear()}-${now.getMonth() + 1}-${now.getDate()}`,\r\n                            expiredDate: validitydate,\r\n                            vipCardCode: code\r\n                        }]\r\n                    })\r\n                }\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        this.couponDrawed = true;\r\n    }\r\n\r\n    async showProductDetail(product: BoxId) {\r\n        let { cProduct } = this.cApp;\r\n        await cProduct.showProductDetail(product);\r\n    }\r\n\r\n    renderProduct = (product: any) => {\r\n        let { cProduct } = this.cApp;\r\n        return cProduct.renderProductWithPrice(product);\r\n    }\r\n}","import { CAppBase, IConstructor, User, nav, Elements } from \"tonva\";\r\n//import { UQs } from \"./uqs\";\r\nimport { Cart } from \"./cart/Cart\";\r\nimport { WebUser } from \"./CurrentUser\";\r\nimport { CHome } from \"./home\";\r\nimport { CCart } from \"./cart\";\r\nimport { CProduct } from \"./product\";\r\nimport { COrder } from \"./order/COrder\";\r\nimport { CProductCategory } from \"./productCategory/CProductCategory\";\r\nimport { CMember } from \"./member\";\r\nimport { CMe } from \"./me/CMe\";\r\nimport { CUqApp } from \"./CBase\";\r\nimport { VMain } from 'ui/main';\r\nimport * as qs from 'querystringify';\r\nimport { CCoupon } from \"coupon/CCoupon\";\r\nimport { CPointProduct } from \"pointMarket/CPointProduct\";\r\nimport { GLOABLE } from \"cartenv\";\r\n\r\nexport class CApp extends CUqApp {\r\n    //get uqs(): UQs { return this._uqs as UQs };\r\n\r\n    cart: Cart;\r\n    topKey: any;\r\n\r\n    currentSalesRegion: any;\r\n    currentLanguage: any;\r\n    currentUser: WebUser;\r\n    // currentCouponCode: string;\r\n    // currentCreditCode: string;\r\n\r\n    cHome: CHome;\r\n    cCart: CCart;\r\n    cProduct: CProduct;\r\n    cOrder: COrder;\r\n    cCoupon: CCoupon;\r\n    cProductCategory: CProductCategory;\r\n    cMember: CMember;\r\n    cMe: CMe;\r\n    cPointProduct: CPointProduct;\r\n\r\n\t/*\r\n    protected newC<T extends CUqBase>(type: IConstructor<T>): T {\r\n        return new type(this);\r\n\t}\r\n\t*/\r\n\r\n    private setUser() {\r\n        this.currentUser = new WebUser(this.uqs); //this.cUqWebUser, this.cUqCustomer);\r\n        if (this.isLogined) {\r\n            this.currentUser.setUser(this.user);\r\n        }\r\n    }\r\n\r\n    protected async internalStart() {\r\n        let [currentSalesRegion, currentLanguage] = await Promise.all([\r\n            this.uqs.common.SalesRegion.load(GLOABLE.SALESREGION_CN),\r\n            this.uqs.common.Language.load(GLOABLE.CHINESE),\r\n        ]);\r\n        this.setUser();\r\n        //this.currentSalesRegion = await this.uqs.common.SalesRegion.load(GLOABLE.SALESREGION_CN);\r\n        //this.currentLanguage = await this.uqs.common.Language.load(GLOABLE.CHINESE);\r\n        this.currentSalesRegion = currentSalesRegion;\r\n        this.currentLanguage = currentLanguage;\r\n\r\n        this.cart = new Cart(this);\r\n        await this.cart.init();\r\n\r\n        this.cProductCategory = this.newC<CProductCategory>(CProductCategory);\r\n        this.cCart = this.newC(CCart);\r\n        this.cHome = this.newC(CHome);\r\n        this.cProduct = this.newC(CProduct);\r\n        this.cOrder = this.newC(COrder);\r\n        this.cCoupon = this.newC(CCoupon);\r\n        this.cMember = this.newC(CMember);\r\n        this.cMe = this.newC(CMe);\r\n        this.cPointProduct = this.newC(CPointProduct);\r\n\r\n        await this.cHome.getSlideShow();\r\n\r\n        let promises: PromiseLike<void>[] = [];\r\n        promises.push(this.cProductCategory.start());\r\n        await Promise.all(promises);\r\n\r\n        let { location } = document;\r\n        let { search } = location;\r\n        if (search) {\r\n            let query: any = qs.parse(search.toLowerCase());\r\n            switch (query.type) {\r\n                case \"privacy\":\r\n                    this.showMain();\r\n                    this.cMe.openPrivacy();\r\n                    break;\r\n                case \"product\":\r\n                    this.showMain();\r\n                    let prouductBoxId = await this.uqs.product.ProductX.boxId(query.product).assure();\r\n                    await this.cProduct.showProductDetail(prouductBoxId);\r\n                    break;\r\n                case \"coupon\":\r\n                    this.showMain();\r\n                    if (query.coupon)\r\n                        await this.cCoupon.showSharedCoupon(query);\r\n                    break;\r\n                case \"credits\":\r\n                    this.showMain();\r\n                    if (query.credits) {\r\n                        await this.cCoupon.showSharedCredits(query);\r\n                        /*\r\n                        if (query.platform === \"1\")\r\n                            await this.cPointProduct.openPointDrawing(query.credits);\r\n                        else\r\n                            await this.cCoupon.showSharedCredits(query);\r\n                        */\r\n                    }\r\n                    break;\r\n                case \"vipcard\":\r\n                    this.showMain();\r\n                    if (query.vipcard)\r\n                        await this.cCoupon.showSharedVIPCard(query);\r\n                    break;\r\n                case \"login\":\r\n                    this.cMe.showLogin();\r\n                    break;\r\n                default:\r\n                    this.showMain();\r\n                    break;\r\n            }\r\n        } else {\r\n            this.showMain();\r\n        }\r\n        this.topKey = nav.topKey();\r\n    }\r\n\r\n    showMain(initTabName?: string) {\r\n        // let root = document.getElementById('root');\r\n        // if (root)\r\n        this.openVPage(VMain, initTabName);\r\n\r\n        let divLogin = document.getElementById('login');\r\n        if (divLogin) {\r\n            // this.openPage(this.cCart.renderCartLabel());\r\n            this.openPage(this.cMe.renderLoginState());\r\n        }\r\n    }\r\n\r\n    protected afterStart(): Promise<void> {\r\n\r\n        let elements: Elements = {\r\n            aId: aTest,\r\n            bId: bTest,\r\n            cId: cTest,\r\n        }\r\n\r\n        let n = 1;\r\n        let hello = 'hello';\r\n\r\n        function aTest(element: HTMLElement) {\r\n            element.innerText = hello;\r\n        }\r\n\r\n        function bTest(element: HTMLElement) {\r\n            element.innerText = hello + ', world!';\r\n        };\r\n\r\n        function cTest(element: HTMLElement) {\r\n            element.innerText = hello + ', world!';\r\n        };\r\n\r\n        this.hookElements(elements);\r\n\r\n        window.onfocus = () => {\r\n            hello = hello + (++n);\r\n            this.hookElements(elements);\r\n        }\r\n        return;\r\n    }\r\n\r\n    async loginCallBack(user: User) {\r\n        /*\r\n        if (this.cartService.isLocal) {\r\n            let cartLocal = { ...this.cartViewModel } as CartViewModel;\r\n            // this.cartService.clear(this.cartViewModel);\r\n            this.cartService = CartServiceFactory.getCartService(this);\r\n            this.cartViewModel = await this.cartService.load();\r\n            // this.cartViewModel = await this.cartService.merge(cartLocal);\r\n        }\r\n        */\r\n    }\r\n\r\n    protected onDispose() {\r\n        this.cart.dispose();\r\n    }\r\n}","import * as React from 'react';\r\nimport './App.css';\r\nimport { NavView, nav, start } from 'tonva';\r\nimport { CApp } from 'CApp';\r\nimport { appConfig } from 'configuration';\r\n\r\n//const tonvaApp = \"bruce/TestApp\";\r\nnav.setSettings(appConfig);\r\n\r\nclass App extends React.Component {\r\n\r\n  private onLogined = async () => {\r\n    await start(CApp, appConfig);\r\n  }\r\n  public render() {\r\n    return <NavView onLogined={this.onLogined} notLogined={this.onLogined} />\r\n  }\r\n}\r\n\r\nexport default App;","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\ntype Config = {\r\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\r\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\r\n};\r\n\r\nexport function register(config?: Config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(\r\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\r\n      window.location.href\r\n    );\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl: string, config?: Config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport 'bootstrap/dist/css/bootstrap.css';\r\nimport App from './App';\r\nimport * as serviceWorker from './serviceWorker';\r\nimport './index.css';\r\n\r\nlet elRoot = document.getElementById('root');\r\nif (!elRoot) {\r\n\telRoot = document.createElement('div');\r\n\telRoot.style.display = 'none';\r\n\tdocument.body.append(elRoot);\r\n}\r\nReactDOM.render(<App />, elRoot);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAABGCAYAAACQRffVAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAF8mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDUgNzkuMTYzNDk5LCAyMDE4LzA4LzEzLTE2OjQwOjIyICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOSAoTWFjaW50b3NoKSIgeG1wOkNyZWF0ZURhdGU9IjIwMjAtMDUtMjlUMTU6MDY6MzgtMDQ6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDIwLTA1LTI5VDE3OjE4OjM2LTA0OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIwLTA1LTI5VDE3OjE4OjM2LTA0OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9InNSR0IgSUVDNjE5NjYtMi4xIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOmE3ZjJlZGZmLTlkMzUtNDBiNy1hNmRhLTNlNDZjZWMwOWJiZiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo3ZmY0N2IxZC1mZmYwLTQ3ZWMtYjVhNS1hZDZkOGNkY2Y2MzEiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo3ZmY0N2IxZC1mZmYwLTQ3ZWMtYjVhNS1hZDZkOGNkY2Y2MzEiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjdmZjQ3YjFkLWZmZjAtNDdlYy1iNWE1LWFkNmQ4Y2RjZjYzMSIgc3RFdnQ6d2hlbj0iMjAyMC0wNS0yOVQxNTowNjozOC0wNDowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmE3ZjJlZGZmLTlkMzUtNDBiNy1hNmRhLTNlNDZjZWMwOWJiZiIgc3RFdnQ6d2hlbj0iMjAyMC0wNS0yOVQxNzoxODozNi0wNDowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+BVuKlQAACWlJREFUeJzlm32QVlUdxz/Pw8MuLAgIsiAvusKAxC6p1JBoYhKCVtSgGGSWOaKCFjKppJjNOFraCxVaEwUiE5ZCmQahEVC8hLptqEWstpBAA4jBKiDs6i672x/fe3nuc577cu7zXJxl+MzsPPece86553vvefmd3zmbqq6o5OQiVWjGjwK3ZhKsyQdEGwWKXggMTydbmXbLIOA8YMmpIvi7zu8rp4LgjwCTnesXTwXBjzi/e4EtJ6ngNtuEVwAXOdcvAE0nqWBrFnuuVwHEmZY6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\"","module.exports = __webpack_public_path__ + \"static/media/AnalyticalChemistry.f85ff3e0.png\";","module.exports = __webpack_public_path__ + \"static/media/LabSupplies.3f6ce00f.png\";","module.exports = __webpack_public_path__ + \"static/media/LifeScience.5c2e6ff5.png\";","module.exports = __webpack_public_path__ + \"static/media/MaterialScience.f2439aa0.png\";","module.exports = __webpack_public_path__ + \"static/media/OrganicChemistry.6d56971c.png\";","import * as React from 'react';\r\nimport { Render } from './render';\r\n\r\nexport interface MainSubs<M, S> {\r\n    main: M;\r\n    subs: S[];\r\n}\r\n\r\nexport abstract class ViewBase<T> {\r\n    model: T;\r\n    abstract render(): JSX.Element;\r\n}\r\n\r\nexport class ViewMainSubs<M, S> extends ViewBase<MainSubs<M, S>> {\r\n    protected main: Render<M>;\r\n    protected sub: Render<S>;\r\n    constructor(main: Render<M>, sub: Render<S>) {\r\n        super();\r\n        this.main = main;\r\n        this.sub = sub;\r\n    }\r\n    protected subsContainer(subViews: JSX.Element[]): JSX.Element {\r\n        return <div>{subViews}</div>\r\n    }\r\n\r\n    protected renderSubItems(): JSX.Element[] {\r\n        let { subs } = this.model;\r\n        if (!subs) return null;\r\n        let subViews: JSX.Element[] = subs.map((v, index) => {\r\n            return <this.sub key={index} {...v} />;\r\n        });\r\n        return subViews;\r\n    }\r\n\r\n    protected renderSubs = (): JSX.Element => {\r\n        return this.subsContainer(this.renderSubItems());\r\n    }\r\n\r\n    render(): JSX.Element {\r\n        let { main } = this.model;\r\n        return <>\r\n            <this.main {...main} />\r\n            <this.renderSubs />\r\n        </>;\r\n    }\r\n}\r\n\r\nexport class ViewListMainSubs<M, S> extends ViewBase<MainSubs<M, S>[]> {\r\n    private row: new (main: Render<M>, sub: Render<S>) => ViewMainSubs<M, S>;\r\n    private main: Render<M>;\r\n    private sub: Render<S>;\r\n    constructor(\r\n        row: new (main: Render<M>, sub: Render<S>) => ViewMainSubs<M, S>,\r\n        main: Render<M>,\r\n        sub: Render<S>) {\r\n        super();\r\n        this.row = row;\r\n        this.main = main;\r\n        this.sub = sub;\r\n    }\r\n    render(): JSX.Element {\r\n        return <>\r\n            {this.model.map((v, index) => {\r\n                let view = new this.row(this.main, this.sub);\r\n                view.model = v;\r\n                return <React.Fragment key={index}>{view.render()}</React.Fragment>;\r\n            })}\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { MainProduct, SubPack } from './model';\r\n\r\nexport type Render<T> = (model: T) => JSX.Element;\r\n\r\nexport function renderMainProduct(model: MainProduct): JSX.Element {\r\n    return <div>\r\n        {model.description}\r\n    </div>\r\n}\r\n\r\nexport function renderSubPack(model: SubPack): JSX.Element {\r\n    let { pack, vipPrice, price, quantity, amount } = model;\r\n    return <div>\r\n        {pack.unit}, {vipPrice}, {price}, {quantity}, {amount}\r\n    </div>\r\n}\r\n","export * from './mainSubs';\r\nexport * from './model';\r\nexport * from './render';\r\n","module.exports = __webpack_public_path__ + \"static/media/pig.772a31a6.png\";"],"sourceRoot":""}