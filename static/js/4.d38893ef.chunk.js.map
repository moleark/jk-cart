{"version":3,"sources":["tonva/entry/tools.tsx","tonva/img/logo.svg","tonva/entry/login.tsx"],"names":["logo","require","tonvaTop","nav","loginTop","className","src","alt","senders","type","caption","regex","mobileRegex","emailRegex","getSender","un","find","v","test","module","exports","schema","name","required","maxLength","Login","res","resLang","loginRes","uiSchema","items","username","placeholder","label","password","widget","login","onSubmit","context","a","values","form","data","undefined","pwd","userApi","user","guest","sender","console","log","token","userLogined","props","callback","onEnter","footer","href","style","margin","privacyEntry","header","this","withBack","onButtonClick","requiredFlag","React"],"mappings":"0GAAA,uFAGMA,EAAOC,EAAQ,KAEd,SAASC,IACZ,OAAOC,MAAIC,SAAS,uBAAKC,UAAU,+CAC/B,uBAAKA,UAAU,kCAAkCC,IAAKN,EAAMO,IAAI,QAChE,uBAAKF,UAAU,4BAA2B,wBAAMA,UAAU,qBAAhB,UACtC,wBAAMA,UAAU,eAAhB,aAWZ,IAAMG,EAAmB,CACrB,CAACC,KAAK,SAAUC,QAAQ,qBAAOC,MAAOC,eACtC,CAACH,KAAK,QAASC,QAAQ,eAAMC,MAAOE,eAGjC,SAASC,EAAUC,GAEtB,OADaP,EAAQQ,MAAK,SAAAC,GAAC,OAAyB,IAArBA,EAAEN,MAAMO,KAAKH,Q,oBC1BhDI,EAAOC,QAAU,IAA0B,kC,gLCOrCC,EAAiB,CACnB,CAACC,KAAM,WAAYb,KAAM,SAAUc,UAAU,EAAMC,UAAW,KAC9D,CAACF,KAAM,WAAYb,KAAM,SAAUc,UAAU,EAAMC,UAAW,KAC9D,CAACF,KAAM,QAASb,KAAM,WASLgB,E,4MACTC,IAAgBC,kBAAQC,K,EACxBC,SAAqB,CACzBC,MAAO,CACHC,SAAU,CAACC,YAAa,+CAAaC,MAAO,4BAC5CC,SAAU,CAACC,OAAQ,WAAYH,YAAa,eAAMC,MAAO,gBACzDG,MAAO,CAACD,OAAQ,SAAU9B,UAAW,iCAAkC4B,MAAO,kB,EAI9EI,S,uCAAW,WAAOf,EAAagB,GAApB,yBAAAC,EAAA,yDACXC,EAASF,EAAQG,KAAKC,KACtB3B,EAAKyB,EAAM,cAEHG,KADRC,EAAMJ,EAAM,UAHD,yCAKJ,qCALI,uBAOEK,IAAQT,MAAM,CAC3BU,KAAM/B,EACN6B,IAAKA,EACLG,MAAO5C,MAAI4C,QAVA,eAaFJ,KANTG,EAPW,gCAcPE,EAASlC,YAAUC,GACnBN,OAAyBkC,IAAXK,EAAsBA,EAAOtC,QAAU,qBAf9C,kBAgBJD,EAAO,kCAhBH,eAkBrBwC,QAAQC,IAAI,gCAAiCJ,EAAKxB,KAAMwB,EAAKK,OAlBxC,UAmBThD,MAAIiD,YAAYN,EAAM,EAAKO,MAAMC,UAnBxB,4C,0DAqBXC,Q,uCAAU,WAAOjC,EAAagB,GAApB,SAAAC,EAAA,yDACD,aAATjB,EADU,gCAEG,EAAKe,SAAS,QAASC,GAF1B,mF,+GAiBd,IAAIkB,EAAS,2BAAK,uBAAKnD,UAAU,WAC7B,uBAAKA,UAAU,eACX,gBAAC,KAAD,CAAIoD,KAAK,YAAYpD,UAAU,eAAeqD,MAAO,CAACC,OAAO,aAA7D,6BAIHxD,MAAIyD,iBAGLC,GAAoC,EAIxC,OAH4B,IAAxBC,KAAKT,MAAMU,WACXF,EAAS,gBAEN,gBAAC,OAAD,CAAMA,OAAQA,EAAQL,OAAQA,GACjC,uBAAKnD,UAAU,oEACX,uBAAKA,UAAU,cACf,uBAAKA,UAAU,SACVH,cACD,uBAAKG,UAAU,SACf,gBAAC,OAAD,CAAMgB,OAAQA,EAAQQ,SAAUiC,KAAKjC,SACjCmC,cAAeF,KAAKzB,SACpBkB,QAASO,KAAKP,QACdU,cAAc,IAElB,gBAAC,KAAD,CAAI5D,UAAU,yBAAyBoD,KAAK,WAA5C,6BAIJ,uBAAKpD,UAAU,cACf,uBAAKA,UAAU,oB,GA7EI6D","file":"static/js/4.d38893ef.chunk.js","sourcesContent":["import * as React from 'react';\r\nimport { nav, mobileRegex, emailRegex } from '../components';\r\n\r\nconst logo = require('../img/logo.svg');\r\n\r\nexport function tonvaTop() {\r\n    return nav.loginTop(<div className=\"d-flex align-items-center position-relative\">\r\n        <img className=\"App-logo h-3c position-absolute\" src={logo} alt=\"img\" />\r\n        <div className=\"h3 flex-fill text-center\"><span className=\"text-primary mr-3\">同</span>\r\n            <span className=\"text-danger\">花</span>\r\n        </div>\r\n    </div>);\r\n}\r\n\r\ninterface Sender {\r\n    type: string;\r\n    caption: string;\r\n    regex: RegExp;\r\n}\r\n\r\nconst senders:Sender[] = [\r\n    {type:'mobile', caption:'手机号', regex: mobileRegex},\r\n    {type:'email', caption:'邮箱', regex: emailRegex}\r\n];\r\n\r\nexport function getSender(un: string):Sender {\r\n    let sender = senders.find(v => v.regex.test(un) === true);\r\n    return sender;\r\n}","module.exports = __webpack_public_path__ + \"static/media/logo.ee7cd8ed.svg\";","import * as React from 'react';\r\nimport {nav, Page, Form, Schema, UiSchema, UiTextItem, UiPasswordItem, Context, UiButton, resLang, StringSchema, Ax} from '../components';\r\nimport { userApi } from '../net';\r\nimport { LoginRes, loginRes } from '../res';\r\nimport { tonvaTop, getSender } from './tools';\r\nimport { User } from '../tool/user';\r\n\r\nconst schema: Schema = [\r\n    {name: 'username', type: 'string', required: true, maxLength: 100} as StringSchema,\r\n    {name: 'password', type: 'string', required: true, maxLength: 100} as StringSchema,\r\n    {name: 'login', type: 'submit'},\r\n];\r\n\r\nexport interface LoginProps {\r\n    withBack?: boolean;\r\n    callback?: (user:User) => Promise<void>;\r\n    //top?: any;\r\n}\r\n\r\nexport default class Login extends React.Component<LoginProps> {\r\n    private res: LoginRes = resLang(loginRes);\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            username: {placeholder: '手机/邮箱/用户名', label: '登录账号'} as UiTextItem,\r\n            password: {widget: 'password', placeholder: '密码', label: '密码'} as UiPasswordItem,\r\n            login: {widget: 'button', className: 'btn btn-primary btn-block mt-3', label: '登录'} as UiButton,\r\n        }\r\n    }\r\n\r\n    private onSubmit = async (name:string, context:Context):Promise<string> => {\r\n        let values = context.form.data;\r\n        let un = values['username'];\r\n        let pwd = values['password'];\r\n        if (pwd === undefined) {\r\n            return 'something wrong, pwd is undefined';\r\n        }\r\n        let user = await userApi.login({\r\n            user: un,\r\n            pwd: pwd,\r\n            guest: nav.guest,\r\n        });\r\n\r\n        if (user === undefined) {\r\n            let sender = getSender(un);\r\n            let type:string = sender !== undefined? sender.caption : '用户名';\r\n            return type + '或密码错！';\r\n        }\r\n\t\tconsole.log(\"onLoginSubmit: user=%s pwd:%s\", user.name, user.token);\r\n        await nav.userLogined(user, this.props.callback);\r\n    }\r\n    private onEnter = async (name:string, context:Context):Promise<string> => {\r\n        if (name === 'password') {\r\n            return await this.onSubmit('login', context);\r\n        }\r\n\t}\r\n\t/*\r\n    private clickReg = () => {\r\n        //nav.replace(<RegisterView />);\r\n        let register = new RegisterController(undefined);\r\n        register.start();\r\n    }\r\n    private clickForget = () => {\r\n        let forget = new ForgetController(undefined);\r\n        forget.start();\r\n\t}\r\n\t*/\r\n    render() {\r\n        let footer = <div><div className=\"d-block\">\r\n            <div className='text-center'>\r\n                <Ax href=\"/register\" className=\"btn btn-link\" style={{margin:'0px auto'}}>\r\n                    注册账号\r\n                </Ax>\r\n            </div>\r\n            {nav.privacyEntry()}\r\n        </div>\r\n        </div>;\r\n        let header:string|boolean|JSX.Element = false;\r\n        if (this.props.withBack === true) {\r\n            header = '登录';\r\n        }\r\n        return <Page header={header} footer={footer}>\r\n            <div className=\"d-flex p-5 flex-column justify-content-center align-items-center\">\r\n                <div className=\"flex-fill\" />\r\n                <div className=\"w-20c\">\r\n                    {tonvaTop()}\r\n                    <div className=\"h-2c\" />\r\n                    <Form schema={schema} uiSchema={this.uiSchema} \r\n                        onButtonClick={this.onSubmit} \r\n                        onEnter={this.onEnter}\r\n                        requiredFlag={false} />\r\n\t\t\t\t\t{/*onClick={() => this.clickForget()}*/}\r\n                    <Ax className=\"btn btn-link btn-block\" href=\"/forget\">\r\n                        忘记密码\r\n                    </Ax>\r\n                </div>\r\n                <div className=\"flex-fill\" />\r\n                <div className=\"flex-fill\" />\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n"],"sourceRoot":""}